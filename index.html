<!DOCTYPE html>
<html lang="en-GB">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>WFM Scheduling Tool | Rule-Based Scheduling</title>
  <style>
    :root {
      --primary-color: #63AB8F;
      --secondary-color: #4A8C7D;
      --border-color: #DEE2E6;
      --light-bg: #F8F9FA;
      --card-bg: #FFFFFF;
      --text-color: #2C3E50;
      --text-light: #6C757D;
      --warn: #f59e0b;
      --bad: #dc2626;
      --good: #16a34a;
      --schedule-available: #63AB8F;
      --schedule-assigned: #4A8C7D;
      --schedule-unavailable: #9CA3AF;
      --schedule-overtime: #F59E0B;
      --chart-1: #4A8C7D;
      --chart-2: #63AB8F;
      --chart-3: #A8D5BA;
      --chart-4: #C7E8D3;
      --modified: #8b5cf6;
      --overstaffed: #3b82f6;
      --understaffed: #ef4444;
      --shortfall: #dc2626;
      --overtime-opp: #f59e0b;
    }
    
    body, h1, h2, h3, h4, h5, h6, p, div, span, label, button, input, select, textarea, th, td, li, ul, ol {
      font-family: 'Aptos', 'Segoe UI', system-ui, -apple-system, Arial, sans-serif;
    }
    
    body {
      margin: 0;
      padding: 20px;
      background: var(--light-bg);
      color: var(--text-color);
      min-height: 100vh;
    }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
    }

    /* Header */
    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 2px solid var(--border-color);
    }
    
    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .brand h1 {
      margin: 0;
      font-size: 28px;
      color: var(--secondary-color);
      font-weight: 800;
    }
    
    .brand .subtitle {
      color: var(--text-light);
      font-weight: 600;
      font-size: 14px;
      margin-left: 8px;
    }
    
    .schedule-status {
      background: white;
      padding: 10px 16px;
      border-radius: 8px;
      border: 1px solid var(--border-color);
      font-size: 14px;
      min-width: 200px;
      text-align: center;
    }

    /* Main Layout */
    .main-layout {
      display: grid;
      grid-template-columns: 1fr;
      gap: 24px;
    }
    
    .cards-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 24px;
    }
    
    @media (max-width: 768px) {
      .cards-row {
        grid-template-columns: 1fr;
      }
    }

    /* Card Styling */
    .card {
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 24px;
      box-shadow: 0 1px 3px rgba(0,0,0,.08);
    }
    
    .card:hover {
      box-shadow: 0 2px 8px rgba(0,0,0,.1);
    }
    
    .card-title {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
      padding-bottom: 16px;
      border-bottom: 2px solid var(--border-color);
    }
    
    .card-title h2 {
      margin: 0;
      font-size: 18px;
      font-weight: 700;
      color: var(--secondary-color);
    }
    
    .badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 900;
      background: rgba(99, 171, 143, 0.1);
      color: var(--secondary-color);
      border: 1px solid rgba(99, 171, 143, 0.3);
    }

    /* Form Controls */
    .form-group {
      margin-bottom: 20px;
    }
    
    label {
      display: block;
      font-weight: 600;
      margin-bottom: 8px;
      font-size: 14px;
      color: var(--text-color);
    }
    
    select, input, textarea, button {
      padding: 12px 14px;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      background: var(--card-bg);
      font-size: 14px;
      width: 100%;
      box-sizing: border-box;
      transition: all 0.2s ease;
    }
    
    select:focus, input:focus, textarea:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(99, 171, 143, 0.1);
    }
    
    button {
      background: var(--primary-color);
      color: #fff;
      font-weight: 600;
      cursor: pointer;
      transition: background .2s;
      border: none;
    }
    
    button:hover {
      background: var(--secondary-color);
      transform: translateY(-1px);
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    
    button.secondary {
      background: #fff;
      color: var(--primary-color);
      border: 2px solid var(--primary-color);
    }
    
    button.secondary:hover {
      background: rgba(99, 171, 143, 0.1);
      border-color: var(--secondary-color);
      color: var(--secondary-color);
    }
    
    button:disabled {
      background: var(--text-light);
      cursor: not-allowed;
      transform: none !important;
      box-shadow: none !important;
    }

    /* Row layouts */
    .row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }
    
    .row-3 {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 16px;
    }
    
    @media (max-width: 768px) {
      .row, .row-3 {
        grid-template-columns: 1fr;
      }
    }

    /* Button Groups */
    .btn-group {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px solid var(--border-color);
    }
    
    .btn-group button {
      flex: 1;
      min-width: 140px;
    }

    /* Rule Toggles */
    .rule-group {
      margin-bottom: 24px;
    }
    
    .rule-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      background: rgba(99, 171, 143, 0.05);
      border-radius: 8px;
      margin-bottom: 8px;
      border: 1px solid transparent;
      transition: all 0.2s ease;
    }
    
    .rule-item:hover {
      border-color: var(--primary-color);
      background: rgba(99, 171, 143, 0.1);
    }
    
    .rule-item input[type="checkbox"] {
      width: 18px;
      height: 18px;
      margin: 0;
    }
    
    .rule-label {
      flex: 1;
      font-weight: 600;
      color: var(--text-color);
    }
    
    .rule-description {
      font-size: 12px;
      color: var(--text-light);
      margin-top: 2px;
    }
    
    .rule-settings {
      margin-top: 12px;
      padding: 12px;
      background: white;
      border-radius: 6px;
      border: 1px solid var(--border-color);
      display: none;
    }
    
    .rule-item.active .rule-settings {
      display: block;
    }

    /* Schedule View */
    .schedule-view-container {
      margin-top: 32px;
      border-top: 2px solid var(--border-color);
      padding-top: 24px;
    }
    
    .schedule-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }
    
    .schedule-header h2 {
      margin: 0;
      font-size: 24px;
      color: var(--secondary-color);
    }
    
    .schedule-controls {
      display: flex;
      gap: 12px;
      align-items: center;
      flex-wrap: wrap;
    }
    
    .date-navigation {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .date-navigation button {
      padding: 8px 12px;
      min-width: auto;
    }

    /* Publish Controls */
    .publish-controls {
      display: flex;
      gap: 12px;
      align-items: center;
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px solid var(--border-color);
    }
    
    .publish-controls button {
      min-width: 150px;
    }

    /* Net Staffing Ribbon */
    .net-staffing-ribbon {
      background: white;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 24px;
      box-shadow: 0 1px 3px rgba(0,0,0,.08);
    }
    
    .ribbon-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }
    
    .ribbon-header h3 {
      margin: 0;
      font-size: 16px;
      color: var(--secondary-color);
    }
    
    .ribbon-stats {
      display: flex;
      gap: 20px;
    }
    
    .stat-item {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    
    .stat-value {
      font-size: 20px;
      font-weight: 700;
    }
    
    .stat-label {
      font-size: 12px;
      color: var(--text-light);
    }
    
    .net-overstaffed {
      color: var(--overstaffed);
    }
    
    .net-understaffed {
      color: var(--understaffed);
    }
    
    .net-balanced {
      color: var(--good);
    }
    
    .net-overtime {
      color: var(--overtime-opp);
    }
    
    .ribbon-visual {
      display: flex;
      height: 40px;
      border-radius: 4px;
      overflow: hidden;
      border: 1px solid var(--border-color);
    }
    
    .ribbon-segment {
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 600;
      font-size: 12px;
      transition: all 0.2s;
      position: relative;
    }
    
    .ribbon-segment:hover {
      filter: brightness(1.1);
      z-index: 10;
    }
    
    .ribbon-tooltip {
      position: absolute;
      top: -40px;
      background: var(--text-color);
      color: white;
      padding: 6px 12px;
      border-radius: 4px;
      font-size: 11px;
      white-space: nowrap;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s;
    }
    
    .ribbon-segment:hover .ribbon-tooltip {
      opacity: 1;
    }

    /* Daily Schedule Grid */
    .daily-schedule-container {
      margin-top: 20px;
    }
    
    .daily-grid {
      border: 1px solid var(--border-color);
      border-radius: 8px;
      overflow: hidden;
      background: white;
      position: relative;
    }
    
    .daily-grid-header {
      display: grid;
      grid-template-columns: 80px repeat(auto-fit, minmax(40px, 1fr));
      background: var(--light-bg);
      border-bottom: 1px solid var(--border-color);
      position: sticky;
      top: 0;
      z-index: 20;
    }
    
    .time-header-cell {
      padding: 12px 8px;
      text-align: center;
      font-weight: 600;
      font-size: 12px;
      color: var(--secondary-color);
      border-right: 1px solid var(--border-color);
      background: var(--light-bg);
    }
    
    .daily-grid-body {
      display: grid;
      grid-template-columns: 80px repeat(auto-fit, minmax(40px, 1fr));
      max-height: 600px;
      overflow-y: auto;
    }
    
    .staff-row {
      display: contents;
    }
    
    .staff-name-cell {
      padding: 12px 8px;
      font-weight: 600;
      font-size: 13px;
      border-right: 1px solid var(--border-color);
      border-bottom: 1px solid var(--border-color);
      background: white;
      position: sticky;
      left: 0;
      z-index: 10;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .time-cell {
      padding: 12px 4px;
      text-align: center;
      border-right: 1px solid var(--border-color);
      border-bottom: 1px solid var(--border-color);
      font-size: 12px;
      min-height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      transition: all 0.2s;
    }
    
    .time-cell:hover {
      transform: scale(1.05);
      z-index: 5;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .activity-block {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
      font-weight: 600;
      font-size: 11px;
      text-align: center;
      padding: 2px;
      cursor: pointer;
      transition: all 0.2s;
      border: 1px solid transparent;
    }
    
    .activity-block:hover {
      filter: brightness(1.1);
    }
    
    .activity-inbound {
      background: var(--schedule-assigned);
      color: white;
    }
    
    .activity-break {
      background: linear-gradient(45deg, #f59e0b, #fbbf24);
      color: white;
    }
    
    .activity-lunch {
      background: linear-gradient(45deg, #dc2626, #ef4444);
      color: white;
    }
    
    .activity-meeting {
      background: linear-gradient(45deg, #3b82f6, #60a5fa);
      color: white;
    }
    
    .activity-coaching {
      background: linear-gradient(45deg, #8b5cf6, #a78bfa);
      color: white;
    }
    
    .activity-training {
      background: linear-gradient(45deg, #10b981, #34d399);
      color: white;
    }
    
    .activity-overtime {
      background: repeating-linear-gradient(
        45deg,
        var(--overtime-opp),
        var(--overtime-opp) 10px,
        #fbbf24 10px,
        #fbbf24 20px
      );
      color: white;
      border: 2px solid var(--warn);
    }
    
    .activity-shortfall {
      background: repeating-linear-gradient(
        -45deg,
        var(--shortfall),
        var(--shortfall) 10px,
        #fca5a5 10px,
        #fca5a5 20px
      );
      color: white;
      border: 2px solid var(--bad);
    }
    
    .activity-empty {
      background: rgba(156, 163, 175, 0.1);
      color: var(--text-light);
    }
    
    .time-slot-header {
      font-weight: 600;
      color: var(--text-color);
    }
    
    .overtime-opportunities {
      margin-top: 24px;
      padding: 16px;
      background: rgba(245, 158, 11, 0.1);
      border: 1px solid rgba(245, 158, 11, 0.3);
      border-radius: 8px;
    }
    
    .overtime-opportunities h4 {
      margin: 0 0 12px 0;
      color: var(--warn);
      font-size: 16px;
    }
    
    .opportunities-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 12px;
    }
    
    .opportunity-item {
      padding: 12px;
      background: white;
      border-radius: 6px;
      border: 1px solid rgba(245, 158, 11, 0.3);
    }
    
    .opportunity-time {
      font-weight: 600;
      color: var(--text-color);
      margin-bottom: 4px;
    }
    
    .opportunity-details {
      font-size: 12px;
      color: var(--text-light);
    }

    /* Results Summary */
    .summary-tiles {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin: 24px 0;
    }
    
    .tile {
      border: 1px solid var(--border-color);
      border-radius: 10px;
      padding: 20px;
      background: #fff;
      text-align: center;
    }
    
    .tile .label {
      color: var(--text-light);
      font-weight: 800;
      font-size: 13px;
      letter-spacing: .3px;
      text-transform: uppercase;
      margin-bottom: 8px;
    }
    
    .tile .value {
      font-size: 28px;
      font-weight: 900;
      margin-top: 4px;
      color: var(--secondary-color);
      line-height: 1.2;
    }
    
    .tile .subtext {
      margin-top: 8px;
      font-size: 12px;
      color: var(--text-light);
      line-height: 1.4;
    }

    /* Staff Assignments Table */
    .assignments-table {
      max-height: 400px;
      overflow: auto;
      border: 1px solid var(--border-color);
      border-radius: 12px;
      margin-top: 24px;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
      background: white;
    }
    
    thead th {
      background: var(--primary-color);
      color: white;
      text-align: left;
      padding: 16px 12px;
      border-bottom: 1px solid var(--border-color);
      position: sticky;
      top: 0;
      z-index: 10;
      font-weight: 700;
      font-size: 13px;
      letter-spacing: .3px;
    }
    
    tbody td {
      padding: 12px;
      border-bottom: 1px solid var(--border-color);
      vertical-align: middle;
    }
    
    tbody tr:hover {
      background: rgba(99, 171, 143, 0.05);
    }
    
    tbody tr:last-child td {
      border-bottom: none;
    }
    
    .center {
      text-align: center;
    }
    
    .right {
      text-align: right;
    }

    /* Optimization Results */
    .optimization-results {
      background: rgba(99, 171, 143, 0.05);
      border: 1px solid var(--primary-color);
      border-radius: 8px;
      padding: 20px;
      margin-top: 20px;
    }
    
    .optimization-metrics {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 16px;
      margin-top: 16px;
    }
    
    .metric {
      text-align: center;
      padding: 12px;
      background: white;
      border-radius: 6px;
      border: 1px solid var(--border-color);
    }
    
    .metric .value {
      font-size: 20px;
      font-weight: 700;
      color: var(--secondary-color);
    }
    
    .metric .label {
      font-size: 12px;
      color: var(--text-light);
      margin-top: 4px;
    }

    /* Help Text */
    .help-text {
      font-size: 12px;
      color: var(--text-light);
      margin-top: 6px;
      line-height: 1.4;
    }
    
    .note {
      background: rgba(99, 171, 143, 0.05);
      border-left: 4px solid var(--primary-color);
      border-radius: 8px;
      padding: 14px;
      margin-top: 20px;
      font-size: 13px;
      color: var(--text-color);
      line-height: 1.5;
    }

    /* Progress Bar */
    .progress-bar {
      height: 8px;
      background: var(--border-color);
      border-radius: 4px;
      overflow: hidden;
      margin: 20px 0;
    }
    
    .progress-fill {
      height: 100%;
      background: var(--primary-color);
      transition: width 0.3s ease;
    }

    /* Footer */
    .footer {
      margin-top: 40px;
      padding-top: 20px;
      border-top: 1px solid var(--border-color);
      text-align: center;
      color: var(--text-light);
      font-size: 12px;
    }

    /* Tabs */
    .tabs {
      display: flex;
      border-bottom: 2px solid var(--border-color);
      margin-bottom: 24px;
    }
    
    .tab {
      padding: 12px 24px;
      background: none;
      border: none;
      font-size: 16px;
      font-weight: 600;
      color: var(--text-light);
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
    }
    
    .tab:hover {
      color: var(--primary-color);
    }
    
    .tab.active {
      color: var(--primary-color);
    }
    
    .tab.active::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      right: 0;
      height: 2px;
      background: var(--primary-color);
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }

    /* Agent Profiles Table */
    .table-container {
      max-height: 400px;
      overflow: auto;
      border: 1px solid var(--border-color);
      border-radius: 12px;
      margin-top: 24px;
    }
    
    /* Search and Filter Bar */
    .search-filter-bar {
      display: flex;
      gap: 15px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    
    .search-box {
      flex: 1;
      min-width: 250px;
    }
    
    .filter-select {
      min-width: 150px;
    }
    
    /* Agent Summary */
    .agent-summary {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .summary-card {
      background: white;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 15px;
      text-align: center;
    }
    
    .summary-card .value {
      font-size: 24px;
      font-weight: 900;
      color: var(--secondary-color);
      margin-bottom: 5px;
    }
    
    .summary-card .label {
      font-size: 12px;
      color: var(--text-light);
      font-weight: 600;
      text-transform: uppercase;
    }
    
    /* Badge lists */
    .badge-list {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin: 0;
      padding: 0;
    }
    
    .badge-item {
      display: inline-block;
      padding: 2px 8px;
      background: rgba(99, 171, 143, 0.1);
      border: 1px solid rgba(99, 171, 143, 0.3);
      border-radius: 12px;
      font-size: 11px;
      color: var(--secondary-color);
      white-space: nowrap;
    }
    
    /* Status indicators */
    .status-active {
      color: var(--good);
      font-weight: 600;
    }
    
    .status-inactive {
      color: var(--bad);
      font-weight: 600;
    }
    
    /* Modal */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }
    
    .modal {
      background: white;
      border-radius: 12px;
      width: 90%;
      max-width: 800px;
      max-height: 90vh;
      overflow-y: auto;
    }
    
    .modal-header {
      padding: 20px 24px;
      border-bottom: 1px solid var(--border-color);
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: var(--primary-color);
      color: white;
      border-radius: 12px 12px 0 0;
    }
    
    .modal-header h2 {
      margin: 0;
      font-size: 20px;
    }
    
    .modal-close {
      background: none;
      border: none;
      color: white;
      font-size: 24px;
      cursor: pointer;
      padding: 0;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
    }
    
    .modal-body {
      padding: 24px;
    }
    
    /* Interval Selector */
    .interval-selector {
      display: flex;
      gap: 12px;
      align-items: center;
      margin-bottom: 16px;
    }
    
    .interval-selector label {
      margin-bottom: 0;
      font-weight: 600;
    }
    
    .interval-buttons {
      display: flex;
      gap: 8px;
    }
    
    .interval-btn {
      padding: 8px 16px;
      border: 1px solid var(--border-color);
      background: white;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.2s;
    }
    
    .interval-btn:hover {
      background: rgba(99, 171, 143, 0.1);
    }
    
    .interval-btn.active {
      background: var(--primary-color);
      color: white;
      border-color: var(--primary-color);
    }
    
    /* Responsive */
    @media (max-width: 1024px) {
      .daily-grid-header,
      .daily-grid-body {
        grid-template-columns: 100px repeat(12, 1fr);
      }
    }
    
    @media (max-width: 768px) {
      body {
        padding: 10px;
      }
      
      .card {
        padding: 16px;
      }
      
      .header {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
      }
      
      .schedule-status {
        width: 100%;
        min-width: unset;
      }
      
      .daily-grid-header,
      .daily-grid-body {
        grid-template-columns: 80px repeat(8, 1fr);
        font-size: 10px;
      }
      
      .time-cell {
        padding: 4px;
        min-height: 40px;
      }
      
      .schedule-controls {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .publish-controls {
        flex-direction: column;
        align-items: stretch;
      }
      
      .publish-controls button {
        width: 100%;
      }
    }
    
    @media (max-width: 480px) {
      .daily-grid-header,
      .daily-grid-body {
        grid-template-columns: 70px repeat(6, 1fr);
      }
      
      .btn-group {
        flex-direction: column;
      }
      
      .btn-group button {
        width: 100%;
      }
      
      .ribbon-stats {
        flex-direction: column;
        gap: 10px;
      }
    }

    /* Custom scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb {
      background: var(--primary-color);
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: var(--secondary-color);
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <div class="brand">
        <h1>WFM Scheduling Tool</h1>
        <span class="subtitle">Rule-Based Scheduling</span>
      </div>
      <div class="schedule-status" id="scheduleStatus">
        Ready to create schedule
      </div>
    </div>

    <!-- Tabs -->
    <div class="tabs">
      <button class="tab active" data-tab="scheduling">Scheduling</button>
      <button class="tab" data-tab="agents">Agent Management</button>
      <button class="tab" data-tab="scheduleView">Schedule View</button>
    </div>

    <!-- Scheduling Tab -->
    <div id="schedulingTab" class="tab-content active">
      <!-- Main Content -->
      <div class="main-layout">
        <!-- Schedule Configuration Card -->
        <div class="card">
          <div class="card-title">
            <h2>Schedule Configuration</h2>
            <span class="badge">Setup</span>
          </div>
          
          <div class="row">
            <div class="form-group">
              <label for="schedulePeriod">Schedule Period</label>
              <select id="schedulePeriod">
                <option value="7">7 days (1 week)</option>
                <option value="14" selected>14 days (2 weeks)</option>
                <option value="28">28 days (4 weeks)</option>
                <option value="30">30 days (1 month)</option>
              </select>
            </div>

            <div class="form-group">
              <label for="startDate">Start Date</label>
              <input type="date" id="startDate" value="">
              <div class="help-text">First day of the schedule</div>
            </div>
          </div>

          <div class="row">
            <div class="form-group">
              <label for="intervalLength">Interval Length</label>
              <select id="intervalLength">
                <option value="15">15 minutes</option>
                <option value="30">30 minutes</option>
                <option value="45">45 minutes</option>
                <option value="60" selected>60 minutes</option>
              </select>
            </div>

            <div class="form-group">
              <label for="businessHours">Business Hours</label>
              <select id="businessHours">
                <option value="8_18">8:00 - 18:00 (10 hours)</option>
                <option value="9_17" selected>9:00 - 17:00 (8 hours)</option>
                <option value="8_20">8:00 - 20:00 (12 hours)</option>
                <option value="24">24/7 Operation</option>
                <option value="custom">Custom Hours</option>
              </select>
            </div>
          </div>

          <div id="customHoursSection" class="form-group" style="display: none;">
            <label>Custom Business Hours</label>
            <div class="row">
              <input type="time" id="customStart" value="08:00">
              <input type="time" id="customEnd" value="18:00">
            </div>
          </div>
        </div>

        <!-- Staff Pool Card -->
        <div class="cards-row">
          <div class="card">
            <div class="card-title">
              <h2>Staff Pool</h2>
              <span class="badge">Resources</span>
            </div>
            
            <div class="agent-summary" style="margin-bottom: 20px;">
              <div class="summary-card">
                <div class="value" id="totalAgentsCount">0</div>
                <div class="label">Total Agents</div>
              </div>
              <div class="summary-card">
                <div class="value" id="fullTimeCount">0</div>
                <div class="label">Full Time</div>
              </div>
              <div class="summary-card">
                <div class="value" id="partTimeCount">0</div>
                <div class="label">Part Time</div>
              </div>
              <div class="summary-card">
                <div class="value" id="activeCount">0</div>
                <div class="label">Active</div>
              </div>
            </div>

            <div class="form-group">
              <label for="skillLevel">Average Skill Level</label>
              <select id="skillLevel">
                <option value="0.8">Level 1 (Trainee)</option>
                <option value="1.0" selected>Level 2 (Standard)</option>
                <option value="1.2">Level 3 (Experienced)</option>
                <option value="1.5">Level 4 (Expert)</option>
              </select>
              <div class="help-text">Productivity multiplier</div>
            </div>

            <button id="manageStaffBtn" class="secondary">ðŸ‘¥ Go to Agent Management</button>
          </div>

          <div class="card">
            <div class="card-title">
              <h2>Shift Patterns</h2>
              <span class="badge">Work Hours</span>
            </div>
            
            <div class="form-group">
              <label for="shiftPattern">Primary Shift Pattern</label>
              <select id="shiftPattern">
                <option value="8x5">8x5 (8hrs, 5 days/week)</option>
                <option value="9x5" selected>9x5 (9hrs, 5 days/week)</option>
                <option value="10x4">10x4 (10hrs, 4 days/week)</option>
                <option value="12x3">12x3 (12hrs, 3 days/week)</option>
                <option value="custom">Custom Pattern</option>
              </select>
            </div>

            <div class="form-group">
              <label for="lunchDuration">Lunch Duration (minutes)</label>
              <input type="number" id="lunchDuration" min="15" max="120" value="60" step="15">
              <div class="help-text">Duration of lunch break for each agent</div>
            </div>

            <div class="form-group">
              <label for="breakFrequency">Break Frequency (hours)</label>
              <input type="number" id="breakFrequency" min="1" max="4" value="2" step="0.5">
              <div class="help-text">Breaks scheduled every X hours</div>
            </div>
          </div>
        </div>

        <!-- Scheduling Rules Card -->
        <div class="card">
          <div class="card-title">
            <h2>Scheduling Rules</h2>
            <span class="badge">Optimization</span>
          </div>
          
          <div class="rule-group">
            <div class="rule-item">
              <input type="checkbox" id="ruleBestFit" checked>
              <div>
                <div class="rule-label">Best Fit to Requirements</div>
                <div class="rule-description">Match staff as closely as possible to forecasted requirements</div>
              </div>
            </div>
            
            <div class="rule-item active">
              <input type="checkbox" id="ruleEvenSpread" checked>
              <div>
                <div class="rule-label">Even Workload Spread</div>
                <div class="rule-description">Distribute workload evenly across staff and time periods</div>
              </div>
            </div>
            
            <div class="rule-item">
              <input type="checkbox" id="ruleMinGaps">
              <div>
                <div class="rule-label">Minimize Schedule Gaps</div>
                <div class="rule-description">Reduce idle time between shifts</div>
              </div>
            </div>
            
            <div class="rule-item">
              <input type="checkbox" id="ruleRespectPreferences">
              <div>
                <div class="rule-label">Respect Staff Preferences</div>
                <div class="rule-description">Consider staff availability and shift preferences</div>
              </div>
            </div>
            
            <div class="rule-item">
              <input type="checkbox" id="ruleAvoidOvertime">
              <div>
                <div class="rule-label">Minimize Overtime</div>
                <div class="rule-description">Avoid overtime hours when possible</div>
              </div>
            </div>
          </div>

          <div class="row-3">
            <div class="form-group">
              <label for="maxConsecutiveDays">Max Consecutive Days</label>
              <input type="number" id="maxConsecutiveDays" min="1" max="7" value="5">
              <div class="help-text">Maximum days without a day off</div>
            </div>

            <div class="form-group">
              <label for="minHoursBetweenShifts">Min Hours Between Shifts</label>
              <input type="number" id="minHoursBetweenShifts" min="8" max="24" value="10">
              <div class="help-text">Minimum rest between shifts</div>
            </div>

            <div class="form-group">
              <label for="maxWeeklyHours">Max Weekly Hours</label>
              <input type="number" id="maxWeeklyHours" min="20" max="60" value="40">
              <div class="help-text">Maximum hours per week per staff</div>
            </div>
          </div>
        </div>

        <!-- Forecast Import Card -->
        <div class="card">
          <div class="card-title">
            <h2>Forecast Requirements</h2>
            <span class="badge">Demand</span>
          </div>
          
          <div class="form-group">
            <label for="forecastSource">Forecast Source</label>
            <select id="forecastSource">
              <option value="manual">Manual Input</option>
              <option value="import" selected>Import from Forecast Tool</option>
              <option value="historical">Historical Patterns</option>
            </select>
          </div>

          <div id="manualForecastSection" class="form-group" style="display: none;">
            <label>Daily Requirements</label>
            <div class="row-3">
              <input type="number" placeholder="Mon" value="15">
              <input type="number" placeholder="Tue" value="18">
              <input type="number" placeholder="Wed" value="20">
              <input type="number" placeholder="Thu" value="22">
              <input type="number" placeholder="Fri" value="25">
              <input type="number" placeholder="Sat" value="12">
              <input type="number" placeholder="Sun" value="8">
            </div>
          </div>

          <div id="importForecastSection">
            <div class="form-group">
              <label for="forecastFile">Upload Forecast CSV</label>
              <input type="file" id="forecastFile" accept=".csv">
              <div class="help-text">Format: date, time, queue, required_staff</div>
            </div>
          </div>

          <div class="note">
            <strong>Note:</strong> Schedule will be generated based on forecast requirements and configured rules.
          </div>
        </div>

        <!-- Generate Schedule Card -->
        <div class="card">
          <div class="card-title">
            <h2>Generate Schedule</h2>
            <span class="badge">Calculate</span>
          </div>
          
          <div class="btn-group">
            <button id="generateScheduleBtn" class="primary">ðŸ“… Generate Schedule</button>
            <button id="optimizeScheduleBtn" class="secondary">âš¡ Optimize Schedule</button>
            <button id="clearScheduleBtn" class="secondary">Clear Schedule</button>
          </div>

          <div class="progress-bar" id="progressBar" style="display: none;">
            <div class="progress-fill" id="progressFill" style="width: 0%;"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Agent Management Tab -->
    <div id="agentsTab" class="tab-content">
      <div class="card">
        <div class="card-title">
          <h2>Agent Management</h2>
          <span class="badge">Profiles</span>
        </div>
        
        <!-- Search and Filter Bar -->
        <div class="search-filter-bar">
          <div class="search-box">
            <label for="searchInput">Search Agents</label>
            <input type="text" id="searchInput" placeholder="Search by name, department, skills...">
          </div>
          <div class="filter-select">
            <label for="departmentFilter">Department</label>
            <select id="departmentFilter">
              <option value="all">All Departments</option>
              <option value="Customer Service">Customer Service</option>
              <option value="Technical Support">Technical Support</option>
              <option value="Sales">Sales</option>
              <option value="Billing">Billing</option>
            </select>
          </div>
          <div class="filter-select">
            <label for="statusFilter">Status</label>
            <select id="statusFilter">
              <option value="all">All Status</option>
              <option value="active">Active</option>
              <option value="inactive">Inactive</option>
            </select>
          </div>
          <div style="align-self: flex-end;">
            <button id="addAgentBtn" class="primary icon-btn">
              <i class="fas fa-user-plus"></i> Add New Agent
            </button>
          </div>
        </div>

        <!-- Agent Profiles Table -->
        <div class="table-container">
          <table id="agentsTable">
            <thead>
              <tr>
                <th>Name</th>
                <th>Department</th>
                <th>Skills</th>
                <th>Queues</th>
                <th>Full/Part Time</th>
                <th>Contracted Hours</th>
                <th>Start Date</th>
                <th>End Date</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="agentsTableBody">
              <!-- Agent rows will be populated by JavaScript -->
            </tbody>
          </table>
        </div>
        
        <div class="note">
          <strong><i class="fas fa-info-circle"></i> How to use:</strong> 
          Click the edit icon <i class="fas fa-edit" style="color: #3b82f6;"></i> to modify an agent's profile. 
          Click the delete icon <i class="fas fa-trash" style="color: #ef4444;"></i> to remove an agent. 
          Use the search and filters above to find specific agents.
        </div>
      </div>
    </div>

    <!-- Schedule View Tab -->
    <div id="scheduleViewTab" class="tab-content">
      <div class="schedule-view-container">
        <div class="schedule-header">
          <h2>Daily Schedule View</h2>
          <div class="schedule-controls">
            <div class="date-navigation">
              <button id="prevDayBtn" class="secondary">â—€ Previous Day</button>
              <span id="currentDateDisplay">Monday, 1 Jan 2024</span>
              <button id="nextDayBtn" class="secondary">Next Day â–¶</button>
            </div>
            <div class="interval-selector">
              <label>Interval View:</label>
              <div class="interval-buttons">
                <button class="interval-btn" data-interval="15">15min</button>
                <button class="interval-btn" data-interval="30">30min</button>
                <button class="interval-btn" data-interval="45">45min</button>
                <button class="interval-btn active" data-interval="60">60min</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Net Staffing Ribbon -->
        <div class="net-staffing-ribbon" id="netStaffingRibbon" style="display: none;">
          <div class="ribbon-header">
            <h3>Net Staffing Overview</h3>
            <div class="ribbon-stats">
              <div class="stat-item">
                <div class="stat-value net-balanced" id="ribbonBalanced">0</div>
                <div class="stat-label">Balanced</div>
              </div>
              <div class="stat-item">
                <div class="stat-value net-overstaffed" id="ribbonOverstaffed">0</div>
                <div class="stat-label">Overstaffed</div>
              </div>
              <div class="stat-item">
                <div class="stat-value net-understaffed" id="ribbonUnderstaffed">0</div>
                <div class="stat-label">Understaffed</div>
              </div>
              <div class="stat-item">
                <div class="stat-value net-overtime" id="ribbonOvertimeOpp">0</div>
                <div class="stat-label">Overtime Opps</div>
              </div>
            </div>
          </div>
          <div class="ribbon-visual" id="ribbonVisual">
            <!-- Ribbon segments will be generated here -->
          </div>
        </div>

        <div class="summary-tiles">
          <div class="tile">
            <div class="label">Scheduled Hours</div>
            <div class="value" id="resultScheduledHours">â€”</div>
            <div class="subtext">Total staff hours</div>
          </div>
          <div class="tile">
            <div class="label">Utilization</div>
            <div class="value" id="resultUtilization">â€”</div>
            <div class="subtext">Effectiveness rate</div>
          </div>
          <div class="tile">
            <div class="label">Coverage Gaps</div>
            <div class="value" id="resultCoverageGaps">â€”</div>
            <div class="subtext">Hours understaffed</div>
          </div>
          <div class="tile">
            <div class="label">Overtime Hours</div>
            <div class="value" id="resultOvertime">â€”</div>
            <div class="subtext">Additional hours</div>
          </div>
        </div>

        <!-- Schedule Legend -->
        <div style="display: flex; gap: 20px; margin: 20px 0; flex-wrap: wrap;">
          <div style="display: flex; align-items: center; gap: 8px;">
            <div class="activity-block activity-inbound">Inbound</div>
            <span style="font-size: 12px;">Inbound Calls</span>
          </div>
          <div style="display: flex; align-items: center; gap: 8px;">
            <div class="activity-block activity-break">Break</div>
            <span style="font-size: 12px;">Break</span>
          </div>
          <div style="display: flex; align-items: center; gap: 8px;">
            <div class="activity-block activity-lunch">Lunch</div>
            <span style="font-size: 12px;">Lunch</span>
          </div>
          <div style="display: flex; align-items: center; gap: 8px;">
            <div class="activity-block activity-meeting">Meeting</div>
            <span style="font-size: 12px;">Meeting</span>
          </div>
          <div style="display: flex; align-items: center; gap: 8px;">
            <div class="activity-block activity-overtime">OT</div>
            <span style="font-size: 12px;">Overtime Opp</span>
          </div>
          <div style="display: flex; align-items: center; gap: 8px;">
            <div class="activity-block activity-shortfall">Short</div>
            <span style="font-size: 12px;">Shortfall</span>
          </div>
        </div>

        <!-- Daily Schedule Grid -->
        <div class="daily-schedule-container">
          <div class="daily-grid" id="dailyGrid">
            <!-- Daily grid will be generated by JavaScript -->
          </div>
        </div>

        <!-- Overtime Opportunities Section -->
        <div class="overtime-opportunities" id="overtimeOpportunities" style="display: none;">
          <h4>ðŸ“Š Overtime Opportunities Identified</h4>
          <div class="opportunities-list" id="opportunitiesList">
            <!-- Overtime opportunities will be listed here -->
          </div>
        </div>

        <!-- Publish Controls -->
        <div class="publish-controls">
          <button id="saveChangesBtn" class="secondary" style="display: none;">ðŸ’¾ Save Changes</button>
          <button id="publishScheduleBtn" class="primary">ðŸ“¤ Publish Schedule</button>
        </div>

        <!-- Staff Assignments Table -->
        <div class="assignments-table">
          <table id="assignmentsTable">
            <thead>
              <tr>
                <th>Staff ID</th>
                <th>Name</th>
                <th class="center">Department</th>
                <th class="center">Skills</th>
                <th class="center">Scheduled Hours</th>
                <th class="center">Shift Pattern</th>
                <th class="center">Days Working</th>
                <th class="center">Status</th>
              </tr>
            </thead>
            <tbody id="assignmentsTableBody">
              <tr>
                <td colspan="8" class="center" style="padding: 40px; color: var(--text-light);">
                  No schedule generated yet. Click "Generate Schedule" to create assignments.
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="note" style="margin-top: 20px;">
          <strong>Schedule Health:</strong> Green indicates adequate coverage, yellow shows minor gaps, red indicates significant understaffing. Overtime opportunities are highlighted in striped orange.
        </div>
      </div>
    </div>

    <!-- Footer -->
    <div class="footer">
      <p>WFM Scheduling Tool v1.0 | Rule-based scheduling with optimization algorithms</p>
      <p>For support or questions, contact your WFM administrator</p>
    </div>
  </div>

  <!-- Modal for Add/Edit Agent -->
  <div id="agentModal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <h2><i class="fas fa-user-edit"></i> <span id="modalTitle">Add New Agent</span></h2>
        <button class="modal-close" id="modalCloseBtn">&times;</button>
      </div>
      <div class="modal-body">
        <form id="agentForm">
          <div class="row">
            <div class="form-group">
              <label for="agentName">Full Name *</label>
              <input type="text" id="agentName" required>
            </div>
            <div class="form-group">
              <label for="agentDepartment">Department *</label>
              <select id="agentDepartment" required>
                <option value="">Select Department</option>
                <option value="Customer Service">Customer Service</option>
                <option value="Technical Support">Technical Support</option>
                <option value="Sales">Sales</option>
                <option value="Billing">Billing</option>
                <option value="Retention">Retention</option>
                <option value="Social Media">Social Media</option>
              </select>
            </div>
          </div>
          
          <div class="row">
            <div class="form-group">
              <label for="agentEmployment">Employment Type *</label>
              <select id="agentEmployment" required>
                <option value="">Select Type</option>
                <option value="Full Time">Full Time</option>
                <option value="Part Time">Part Time</option>
                <option value="Contractor">Contractor</option>
              </select>
            </div>
            <div class="form-group">
              <label for="agentHours">Contracted Hours (per week) *</label>
              <input type="number" id="agentHours" min="10" max="50" step="0.5" required>
            </div>
          </div>
          
          <div class="row">
            <div class="form-group">
              <label for="agentStartDate">Start Date *</label>
              <input type="date" id="agentStartDate" required>
            </div>
            <div class="form-group">
              <label for="agentEndDate">End Date (if applicable)</label>
              <input type="date" id="agentEndDate">
            </div>
          </div>
          
          <div class="form-group">
            <label>Skills *</label>
            <div class="multi-select-container" style="grid-template-columns: 1fr 1fr; gap: 20px; display: grid;">
              <div class="select-group">
                <h4>Technical Skills</h4>
                <div class="checkbox-group" style="max-height: 150px; overflow-y: auto;">
                  <div class="checkbox-item">
                    <input type="checkbox" id="skillChat" value="Chat Support">
                    <label for="skillChat">Chat Support</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="skillEmail" value="Email Support">
                    <label for="skillEmail">Email Support</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="skillPhone" value="Phone Support">
                    <label for="skillPhone">Phone Support</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="skillSocial" value="Social Media">
                    <label for="skillSocial">Social Media</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="skillTechnical" value="Technical Troubleshooting">
                    <label for="skillTechnical">Technical Troubleshooting</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="skillBilling" value="Billing Support">
                    <label for="skillBilling">Billing Support</label>
                  </div>
                </div>
              </div>
              
              <div class="select-group">
                <h4>Soft Skills</h4>
                <div class="checkbox-group" style="max-height: 150px; overflow-y: auto;">
                  <div class="checkbox-item">
                    <input type="checkbox" id="skillSales" value="Sales">
                    <label for="skillSales">Sales</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="skillRetention" value="Retention">
                    <label for="skillRetention">Retention</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="skillEscalation" value="Escalation Handling">
                    <label for="skillEscalation">Escalation Handling</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="skillMultilingual" value="Multilingual">
                    <label for="skillMultilingual">Multilingual</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="skillTraining" value="Training">
                    <label for="skillTraining">Training</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="skillQuality" value="Quality Assurance">
                    <label for="skillQuality">Quality Assurance</label>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="form-group">
            <label>Queues *</label>
            <div class="multi-select-container" style="grid-template-columns: 1fr 1fr; gap: 20px; display: grid;">
              <div class="select-group">
                <h4>Primary Queues</h4>
                <div class="checkbox-group" style="max-height: 150px; overflow-y: auto;">
                  <div class="checkbox-item">
                    <input type="checkbox" id="queueGeneral" value="General Inquiries">
                    <label for="queueGeneral">General Inquiries</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="queueTechnical" value="Technical Support">
                    <label for="queueTechnical">Technical Support</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="queueSales" value="Sales">
                    <label for="queueSales">Sales</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="queueBilling" value="Billing">
                    <label for="queueBilling">Billing</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="queueRetention" value="Retention">
                    <label for="queueRetention">Retention</label>
                  </div>
                </div>
              </div>
              
              <div class="select-group">
                <h4>Specialty Queues</h4>
                <div class="checkbox-group" style="max-height: 150px; overflow-y: auto;">
                  <div class="checkbox-item">
                    <input type="checkbox" id="queueEscalation" value="Escalations">
                    <label for="queueEscalation">Escalations</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="queueSocial" value="Social Media">
                    <label for="queueSocial">Social Media</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="queueVIP" value="VIP Support">
                    <label for="queueVIP">VIP Support</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="queueBackoffice" value="Back Office">
                    <label for="queueBackoffice">Back Office</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="queueChat" value="Chat Only">
                    <label for="queueChat">Chat Only</label>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="btn-group">
            <button type="submit" class="primary icon-btn">
              <i class="fas fa-save"></i> Save Agent
            </button>
            <button type="button" class="secondary" id="cancelModalBtn">
              Cancel
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Modal for Publish Schedule -->
  <div id="publishModal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <h2><i class="fas fa-paper-plane"></i> Publish Schedule</h2>
        <button class="modal-close" id="publishModalCloseBtn">&times;</button>
      </div>
      <div class="modal-body">
        <form id="publishForm">
          <div class="form-group">
            <label for="publishOption">Publish Option</label>
            <select id="publishOption" required>
              <option value="current">Current Day Only</option>
              <option value="range" selected>Date Range</option>
              <option value="all">All Days</option>
            </select>
          </div>
          
          <div id="dateRangeSection">
            <div class="row">
              <div class="form-group">
                <label for="publishStartDate">Start Date</label>
                <input type="date" id="publishStartDate" required>
              </div>
              <div class="form-group">
                <label for="publishEndDate">End Date</label>
                <input type="date" id="publishEndDate" required>
              </div>
            </div>
          </div>
          
          <div class="form-group">
            <label for="publishNotes">Notes (Optional)</label>
            <textarea id="publishNotes" rows="3" placeholder="Add any notes about this schedule publication..."></textarea>
          </div>
          
          <div class="note">
            <strong>Note:</strong> Publishing will make this schedule visible to all team members and lock it for editing.
          </div>
          
          <div class="btn-group">
            <button type="submit" class="primary icon-btn">
              <i class="fas fa-paper-plane"></i> Publish Now
            </button>
            <button type="button" class="secondary" id="cancelPublishBtn">
              Cancel
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <script>
    // DOM Elements
    const scheduleStatus = document.getElementById('scheduleStatus');
    const generateScheduleBtn = document.getElementById('generateScheduleBtn');
    const optimizeScheduleBtn = document.getElementById('optimizeScheduleBtn');
    const clearScheduleBtn = document.getElementById('clearScheduleBtn');
    const exportScheduleBtn = document.getElementById('exportScheduleBtn');
    const progressBar = document.getElementById('progressBar');
    const progressFill = document.getElementById('progressFill');
    const businessHoursSelect = document.getElementById('businessHours');
    const customHoursSection = document.getElementById('customHoursSection');
    const forecastSourceSelect = document.getElementById('forecastSource');
    const manualForecastSection = document.getElementById('manualForecastSection');
    const importForecastSection = document.getElementById('importForecastSection');
    const dailyGrid = document.getElementById('dailyGrid');
    const prevDayBtn = document.getElementById('prevDayBtn');
    const nextDayBtn = document.getElementById('nextDayBtn');
    const currentDateDisplay = document.getElementById('currentDateDisplay');
    const assignmentsTableBody = document.getElementById('assignmentsTableBody');
    const optimizationResults = document.getElementById('optimizationResults');
    const optimizationMessage = document.getElementById('optimizationMessage');
    const optimizationMetrics = document.getElementById('optimizationMetrics');
    const manageStaffBtn = document.getElementById('manageStaffBtn');
    const saveChangesBtn = document.getElementById('saveChangesBtn');
    const publishScheduleBtn = document.getElementById('publishScheduleBtn');
    const netStaffingRibbon = document.getElementById('netStaffingRibbon');
    const ribbonVisual = document.getElementById('ribbonVisual');
    const overtimeOpportunities = document.getElementById('overtimeOpportunities');
    const opportunitiesList = document.getElementById('opportunitiesList');

    // Tabs
    const tabs = document.querySelectorAll('.tab');
    const tabContents = document.querySelectorAll('.tab-content');

    // Agent Management Elements
    const searchInput = document.getElementById('searchInput');
    const departmentFilter = document.getElementById('departmentFilter');
    const statusFilter = document.getElementById('statusFilter');
    const addAgentBtn = document.getElementById('addAgentBtn');
    const agentsTableBody = document.getElementById('agentsTableBody');
    const agentModal = document.getElementById('agentModal');
    const modalCloseBtn = document.getElementById('modalCloseBtn');
    const cancelModalBtn = document.getElementById('cancelModalBtn');
    const modalTitle = document.getElementById('modalTitle');
    const agentForm = document.getElementById('agentForm');
    const totalAgentsCount = document.getElementById('totalAgentsCount');
    const fullTimeCount = document.getElementById('fullTimeCount');
    const partTimeCount = document.getElementById('partTimeCount');
    const activeCount = document.getElementById('activeCount');

    // Publish Modal Elements
    const publishModal = document.getElementById('publishModal');
    const publishModalCloseBtn = document.getElementById('publishModalCloseBtn');
    const cancelPublishBtn = document.getElementById('cancelPublishBtn');
    const publishForm = document.getElementById('publishForm');
    const publishOption = document.getElementById('publishOption');
    const dateRangeSection = document.getElementById('dateRangeSection');
    const publishStartDate = document.getElementById('publishStartDate');
    const publishEndDate = document.getElementById('publishEndDate');

    // Interval buttons
    const intervalButtons = document.querySelectorAll('.interval-btn');

    // Agent data storage
    let agents = [];
    let currentEditId = null;

    // Schedule data storage
    let scheduleData = {
      requirements: [],
      staff: [],
      assignments: [],
      generatedSchedule: null,
      currentDay: 0,
      totalDays: 1,
      optimizationResults: null,
      agentSchedules: [],
      netStaffing: [],
      overtimeOpportunities: [],
      intervalLength: 60,
      modified: false
    };

    // Available skills and queues
    const allSkills = [
      'Chat Support', 'Email Support', 'Phone Support', 'Social Media',
      'Technical Troubleshooting', 'Billing Support', 'Sales', 'Retention',
      'Escalation Handling', 'Multilingual', 'Training', 'Quality Assurance'
    ];

    const allQueues = [
      'General Inquiries', 'Technical Support', 'Sales', 'Billing', 'Retention',
      'Escalations', 'Social Media', 'VIP Support', 'Back Office', 'Chat Only'
    ];

    // Initialize with hardcoded agents
    function initializeAgents() {
      const today = new Date();
      const oneYearAgo = new Date();
      oneYearAgo.setFullYear(today.getFullYear() - 1);
      
      const sixMonthsFromNow = new Date();
      sixMonthsFromNow.setMonth(today.getMonth() + 6);
      
      agents = [
        {
          id: 1,
          name: 'John Thompson',
          department: 'Customer Service',
          skills: ['Phone Support', 'Email Support', 'Chat Support', 'Multilingual'],
          queues: ['General Inquiries', 'Technical Support', 'Escalations'],
          employmentType: 'Full Time',
          contractedHours: 40,
          startDate: formatDate(oneYearAgo),
          endDate: '',
          status: 'active'
        },
        {
          id: 2,
          name: 'Sasha Smith',
          department: 'Technical Support',
          skills: ['Technical Troubleshooting', 'Chat Support', 'Email Support', 'Escalation Handling'],
          queues: ['Technical Support', 'Escalations', 'VIP Support'],
          employmentType: 'Full Time',
          contractedHours: 40,
          startDate: formatDate(new Date(oneYearAgo.getFullYear(), oneYearAgo.getMonth() - 3, 15)),
          endDate: '',
          status: 'active'
        },
        {
          id: 3,
          name: 'Liam Cooper',
          department: 'Sales',
          skills: ['Sales', 'Phone Support', 'Retention', 'Chat Support'],
          queues: ['Sales', 'Retention', 'VIP Support'],
          employmentType: 'Full Time',
          contractedHours: 37.5,
          startDate: formatDate(new Date(oneYearAgo.getFullYear(), oneYearAgo.getMonth() - 8, 1)),
          endDate: '',
          status: 'active'
        },
        {
          id: 4,
          name: 'Ethan Reynolds',
          department: 'Billing',
          skills: ['Billing Support', 'Email Support', 'Phone Support', 'Technical Troubleshooting'],
          queues: ['Billing', 'Technical Support', 'General Inquiries'],
          employmentType: 'Part Time',
          contractedHours: 25,
          startDate: formatDate(new Date(oneYearAgo.getFullYear(), oneYearAgo.getMonth() - 5, 20)),
          endDate: formatDate(sixMonthsFromNow),
          status: 'active'
        },
        {
          id: 5,
          name: 'Ava Mitchell',
          department: 'Social Media',
          skills: ['Social Media', 'Chat Support', 'Email Support', 'Multilingual'],
          queues: ['Social Media', 'Chat Only', 'General Inquiries'],
          employmentType: 'Full Time',
          contractedHours: 40,
          startDate: formatDate(new Date(today.getFullYear(), today.getMonth() - 2, 10)),
          endDate: '',
          status: 'active'
        }
      ];
      
      updateAgentDisplay();
      updateSummaryCards();
      updateStatus('Agent profiles loaded successfully');
    }

    // Format date as YYYY-MM-DD
    function formatDate(date) {
      if (!date) return '';
      return date.toISOString().split('T')[0];
    }

    // Format date for display (DD/MM/YYYY)
    function formatDisplayDate(dateString) {
      if (!dateString) return 'â€”';
      const date = new Date(dateString);
      return date.toLocaleDateString('en-GB');
    }

    // Update agent display
    function updateAgentDisplay() {
      const searchTerm = searchInput.value.toLowerCase();
      const department = departmentFilter.value;
      const status = statusFilter.value;
      
      let filteredAgents = agents.filter(agent => {
        const matchesSearch = 
          agent.name.toLowerCase().includes(searchTerm) ||
          agent.department.toLowerCase().includes(searchTerm) ||
          agent.skills.some(skill => skill.toLowerCase().includes(searchTerm)) ||
          agent.queues.some(queue => queue.toLowerCase().includes(searchTerm));
        
        const matchesDepartment = department === 'all' || agent.department === department;
        const matchesStatus = status === 'all' || agent.status === status;
        
        return matchesSearch && matchesDepartment && matchesStatus;
      });
      
      agentsTableBody.innerHTML = '';
      
      filteredAgents.forEach(agent => {
        const row = document.createElement('tr');
        const isActive = agent.status === 'active' && (!agent.endDate || new Date(agent.endDate) > new Date());
        const statusText = isActive ? 'Active' : 'Inactive';
        const statusClass = isActive ? 'status-active' : 'status-inactive';
        
        row.innerHTML = `
          <td><strong>${agent.name}</strong></td>
          <td>${agent.department}</td>
          <td>
            <div class="badge-list">
              ${agent.skills.map(skill => `<span class="badge-item">${skill}</span>`).join('')}
            </div>
          </td>
          <td>
            <div class="badge-list">
              ${agent.queues.map(queue => `<span class="badge-item">${queue}</span>`).join('')}
            </div>
          </td>
          <td>${agent.employmentType}</td>
          <td class="right">${agent.contractedHours.toFixed(1)}</td>
          <td>${formatDisplayDate(agent.startDate)}</td>
          <td>${formatDisplayDate(agent.endDate)}</td>
          <td class="${statusClass}">${statusText}</td>
          <td class="center">
            <button class="action-btn edit" data-id="${agent.id}" title="Edit agent" style="background: none; border: none; cursor: pointer; padding: 4px 8px; border-radius: 4px; color: var(--text-light);">
              <i class="fas fa-edit"></i>
            </button>
            <button class="action-btn delete" data-id="${agent.id}" title="Delete agent" style="background: none; border: none; cursor: pointer; padding: 4px 8px; border-radius: 4px; color: var(--text-light);">
              <i class="fas fa-trash"></i>
            </button>
          </td>
        `;
        agentsTableBody.appendChild(row);
      });
    }

    // Update summary cards
    function updateSummaryCards() {
      totalAgentsCount.textContent = agents.length;
      fullTimeCount.textContent = agents.filter(a => a.employmentType === 'Full Time').length;
      partTimeCount.textContent = agents.filter(a => a.employmentType === 'Part Time' || a.employmentType === 'Contractor').length;
      activeCount.textContent = agents.filter(a => a.status === 'active' && (!a.endDate || new Date(a.endDate) > new Date())).length;
    }

    // Show modal for adding/editing agent
    function showAgentModal(agentId = null) {
      currentEditId = agentId;
      
      if (agentId) {
        modalTitle.textContent = 'Edit Agent Profile';
        const agent = agents.find(a => a.id === agentId);
        
        if (agent) {
          document.getElementById('agentName').value = agent.name;
          document.getElementById('agentDepartment').value = agent.department;
          document.getElementById('agentEmployment').value = agent.employmentType;
          document.getElementById('agentHours').value = agent.contractedHours;
          document.getElementById('agentStartDate').value = agent.startDate;
          document.getElementById('agentEndDate').value = agent.endDate;
          
          allSkills.forEach(skill => {
            const checkbox = document.querySelector(`input[value="${skill}"]`);
            if (checkbox) checkbox.checked = agent.skills.includes(skill);
          });
          
          allQueues.forEach(queue => {
            const checkbox = document.querySelector(`input[value="${queue}"]`);
            if (checkbox) checkbox.checked = agent.queues.includes(queue);
          });
        }
      } else {
        modalTitle.textContent = 'Add New Agent';
        agentForm.reset();
        document.getElementById('agentStartDate').value = formatDate(new Date());
      }
      
      agentModal.style.display = 'flex';
    }

    // Hide modal
    function hideAgentModal() {
      agentModal.style.display = 'none';
      currentEditId = null;
    }

    // Save agent
    function saveAgent(event) {
      event.preventDefault();
      
      const name = document.getElementById('agentName').value.trim();
      const department = document.getElementById('agentDepartment').value;
      const employmentType = document.getElementById('agentEmployment').value;
      const contractedHours = parseFloat(document.getElementById('agentHours').value);
      const startDate = document.getElementById('agentStartDate').value;
      const endDate = document.getElementById('agentEndDate').value;
      
      const selectedSkills = [];
      allSkills.forEach(skill => {
        const checkbox = document.querySelector(`input[value="${skill}"]`);
        if (checkbox && checkbox.checked) selectedSkills.push(skill);
      });
      
      const selectedQueues = [];
      allQueues.forEach(queue => {
        const checkbox = document.querySelector(`input[value="${queue}"]`);
        if (checkbox && checkbox.checked) selectedQueues.push(queue);
      });
      
      if (!name || !department || !employmentType || !contractedHours || !startDate) {
        updateStatus('Please fill in all required fields', true);
        return;
      }
      
      if (selectedSkills.length === 0 || selectedQueues.length === 0) {
        updateStatus('Please select at least one skill and one queue', true);
        return;
      }
      
      if (currentEditId) {
        const agentIndex = agents.findIndex(a => a.id === currentEditId);
        if (agentIndex !== -1) {
          agents[agentIndex] = {
            ...agents[agentIndex],
            name,
            department,
            skills: selectedSkills,
            queues: selectedQueues,
            employmentType,
            contractedHours,
            startDate,
            endDate
          };
          updateStatus(`Agent "${name}" updated successfully`);
        }
      } else {
        const newId = agents.length > 0 ? Math.max(...agents.map(a => a.id)) + 1 : 1;
        const newAgent = {
          id: newId,
          name,
          department,
          skills: selectedSkills,
          queues: selectedQueues,
          employmentType,
          contractedHours,
          startDate,
          endDate,
          status: 'active'
        };
        agents.push(newAgent);
        updateStatus(`Agent "${name}" added successfully`);
      }
      
      updateAgentDisplay();
      updateSummaryCards();
      hideAgentModal();
    }

    // Delete agent
    function deleteAgent(agentId) {
      if (confirm('Are you sure you want to delete this agent?')) {
        const agentIndex = agents.findIndex(a => a.id === agentId);
        if (agentIndex !== -1) {
          const agentName = agents[agentIndex].name;
          agents.splice(agentIndex, 1);
          updateAgentDisplay();
          updateSummaryCards();
          updateStatus(`Agent "${agentName}" deleted successfully`);
        }
      }
    }

    // Initialize date picker
    function initializeDatePicker() {
      const today = new Date();
      const nextMonday = new Date(today);
      const daysUntilMonday = (1 - today.getDay() + 7) % 7;
      nextMonday.setDate(today.getDate() + daysUntilMonday);
      
      document.getElementById('startDate').value = formatDate(nextMonday);
      
      // Initialize publish dates
      publishStartDate.value = formatDate(nextMonday);
      const endDate = new Date(nextMonday);
      endDate.setDate(endDate.getDate() + 13); // 14 days total
      publishEndDate.value = formatDate(endDate);
    }

    // Tab switching
    tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        const tabId = tab.dataset.tab;
        
        tabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        
        tabContents.forEach(content => {
          content.classList.remove('active');
          if (content.id === `${tabId}Tab`) {
            content.classList.add('active');
          }
        });
        
        if (tabId === 'scheduleView' && scheduleData.generatedSchedule) {
          generateDailyGrid();
          updateNetStaffingRibbon();
          updateOvertimeOpportunities();
          updateDateDisplay();
        }
      });
    });

    // Enhanced Scheduling Engine
    class SchedulingEngine {
      constructor() {
        this.rules = {};
        this.staffPool = [];
        this.requirements = [];
        this.intervalLength = 60;
      }

      generateSchedule(requirements, staffPool, rules) {
        this.requirements = requirements;
        this.staffPool = staffPool;
        this.rules = rules;
        this.intervalLength = scheduleData.intervalLength;
        
        const schedule = this.createInitialSchedule();
        const agentSchedules = this.generateAgentSchedules(staffPool, schedule);
        
        // Apply rules
        if (rules.bestFit) {
          this.applyBestFit(schedule, agentSchedules);
        }
        
        if (rules.evenSpread) {
          this.applyEvenSpread(schedule, agentSchedules);
        }
        
        if (rules.respectPreferences) {
          this.applyStaffPreferences(agentSchedules);
        }
        
        if (rules.avoidOvertime) {
          this.minimizeOvertime(agentSchedules);
        }
        
        this.applyConstraints(agentSchedules);
        
        schedule.agentSchedules = agentSchedules;
        schedule.metrics = this.calculateMetrics(schedule, agentSchedules);
        schedule.netStaffing = this.calculateNetStaffing(schedule, requirements);
        schedule.overtimeOpportunities = this.identifyOvertimeOpportunities(schedule, requirements);
        
        return schedule;
      }

      createInitialSchedule() {
        const schedule = {
          days: [],
          assignments: [],
          metrics: {
            totalHours: 0,
            utilization: 0,
            coverageGaps: 0,
            overtime: 0,
            satisfaction: 0
          }
        };

        const period = parseInt(document.getElementById('schedulePeriod').value);
        for (let i = 0; i < period; i++) {
          schedule.days.push({
            date: new Date(),
            assignments: []
          });
        }

        return schedule;
      }

      generateAgentSchedules(staffPool, schedule) {
        const agentSchedules = [];
        const lunchDuration = parseInt(document.getElementById('lunchDuration').value) / 60; // in hours
        const breakFrequency = parseFloat(document.getElementById('breakFrequency').value);
        
        staffPool.forEach(agent => {
          const agentSchedule = {
            agentId: agent.id,
            agentName: agent.name,
            schedule: [],
            totalHours: 0,
            daysWorking: 0
          };
          
          const period = parseInt(document.getElementById('schedulePeriod').value);
          const shiftPattern = document.getElementById('shiftPattern').value;
          const isFullTime = agent.employmentType === 'Full Time';
          
          // Determine shift hours based on pattern
          let shiftHours = 8;
          let daysPerWeek = 5;
          
          if (shiftPattern === '9x5') {
            shiftHours = 9;
            daysPerWeek = 5;
          } else if (shiftPattern === '10x4') {
            shiftHours = 10;
            daysPerWeek = 4;
          } else if (shiftPattern === '12x3') {
            shiftHours = 12;
            daysPerWeek = 3;
          }
          
          // Adjust for part-time
          if (!isFullTime) {
            shiftHours = Math.min(shiftHours, 6);
            daysPerWeek = Math.min(daysPerWeek, 4);
          }
          
          // Generate schedule for each day
          for (let day = 0; day < period; day++) {
            const daySchedule = {
              dayIndex: day,
              activities: [],
              working: false
            };
            
            // Determine if agent works this day
            const dayOfWeek = day % 7;
            const shouldWork = day % Math.ceil(7 / daysPerWeek) < daysPerWeek;
            
            if (shouldWork) {
              daySchedule.working = true;
              agentSchedule.daysWorking++;
              
              // Generate shift with breaks and lunch
              const startHour = 8; // Default start time
              const endHour = startHour + shiftHours;
              
              // Add Inbound activities with breaks
              let currentHour = startHour;
              let hoursSinceBreak = 0;
              
              while (currentHour < endHour) {
                if (hoursSinceBreak >= breakFrequency && currentHour < endHour - lunchDuration) {
                  // Add break
                  daySchedule.activities.push({
                    start: currentHour,
                    end: currentHour + 0.25, // 15 minute break
                    type: 'break',
                    activity: 'Break'
                  });
                  currentHour += 0.25;
                  hoursSinceBreak = 0;
                } else if (currentHour >= startHour + shiftHours/2 - lunchDuration/2 && 
                          currentHour < startHour + shiftHours/2 + lunchDuration/2) {
                  // Add lunch
                  daySchedule.activities.push({
                    start: currentHour,
                    end: currentHour + lunchDuration,
                    type: 'lunch',
                    activity: 'Lunch'
                  });
                  currentHour += lunchDuration;
                  hoursSinceBreak = 0;
                } else {
                  // Add Inbound work
                  const activityDuration = Math.min(1, endHour - currentHour);
                  daySchedule.activities.push({
                    start: currentHour,
                    end: currentHour + activityDuration,
                    type: 'inbound',
                    activity: 'Inbound'
                  });
                  currentHour += activityDuration;
                  hoursSinceBreak += activityDuration;
                  agentSchedule.totalHours += activityDuration;
                }
              }
            }
            
            agentSchedule.schedule.push(daySchedule);
          }
          
          agentSchedules.push(agentSchedule);
        });
        
        return agentSchedules;
      }

      applyBestFit(schedule, agentSchedules) {
        schedule.days.forEach((day, dayIndex) => {
          const dayRequirements = this.requirements[dayIndex] || [];
          
          dayRequirements.forEach((requirement, hourIndex) => {
            const required = requirement;
            const availableAgents = this.getAvailableAgentsAtHour(agentSchedules, dayIndex, hourIndex);
            const assigned = Math.min(availableAgents.length, required);
            
            if (!day.assignments[hourIndex]) {
              day.assignments[hourIndex] = [];
            }
            
            for (let i = 0; i < assigned; i++) {
              day.assignments[hourIndex].push(availableAgents[i].agentId);
            }
            
            if (assigned < required) {
              schedule.metrics.coverageGaps += (required - assigned);
            }
            
            schedule.metrics.totalHours += assigned;
          });
        });
      }

      applyEvenSpread(schedule, agentSchedules) {
        // Balance workload across agents
        const agentWorkload = {};
        agentSchedules.forEach(agent => {
          agentWorkload[agent.agentId] = agent.totalHours;
        });
        
        // Simple balancing: redistribute some activities
        schedule.days.forEach((day, dayIndex) => {
          day.assignments.forEach((hourAssignments, hourIndex) => {
            if (hourAssignments && hourAssignments.length > 0) {
              // Find agent with least workload
              let minWorkload = Infinity;
              let bestAgent = null;
              
              hourAssignments.forEach(agentId => {
                if (agentWorkload[agentId] < minWorkload) {
                  minWorkload = agentWorkload[agentId];
                  bestAgent = agentId;
                }
              });
              
              // Reassign to balance
              if (bestAgent) {
                hourAssignments.forEach((agentId, idx) => {
                  if (agentId !== bestAgent) {
                    hourAssignments[idx] = bestAgent;
                    agentWorkload[bestAgent]++;
                    agentWorkload[agentId]--;
                  }
                });
              }
            }
          });
        });
      }

      applyStaffPreferences(agentSchedules) {
        // This would consider agent preferences from the agent profiles
        // For now, we'll respect contracted hours
        agentSchedules.forEach(agentSchedule => {
          const agent = this.staffPool.find(a => a.id === agentSchedule.agentId);
          if (agent && agentSchedule.totalHours > agent.contractedHours * (parseInt(document.getElementById('schedulePeriod').value) / 7)) {
            // Reduce hours to contracted limit
            this.reduceAgentHours(agentSchedule, agent.contractedHours);
          }
        });
      }

      minimizeOvertime(agentSchedules) {
        const maxWeeklyHours = parseInt(document.getElementById('maxWeeklyHours').value);
        const periodWeeks = parseInt(document.getElementById('schedulePeriod').value) / 7;
        
        agentSchedules.forEach(agentSchedule => {
          const weeklyHours = agentSchedule.totalHours / periodWeeks;
          if (weeklyHours > maxWeeklyHours) {
            const excess = weeklyHours - maxWeeklyHours;
            schedule.metrics.overtime += excess * periodWeeks;
            this.reduceAgentHours(agentSchedule, maxWeeklyHours * periodWeeks);
          }
        });
      }

      applyConstraints(agentSchedules) {
        const maxConsecutiveDays = parseInt(document.getElementById('maxConsecutiveDays').value);
        
        agentSchedules.forEach(agentSchedule => {
          let consecutiveDays = 0;
          let maxConsecutive = 0;
          
          agentSchedule.schedule.forEach(day => {
            if (day.working) {
              consecutiveDays++;
              maxConsecutive = Math.max(maxConsecutive, consecutiveDays);
            } else {
              consecutiveDays = 0;
            }
          });
          
          if (maxConsecutive > maxConsecutiveDays) {
            this.adjustForConsecutiveDays(agentSchedule, maxConsecutiveDays);
          }
        });
      }

      calculateNetStaffing(schedule, requirements) {
        const netStaffing = [];
        const period = parseInt(document.getElementById('schedulePeriod').value);
        
        for (let day = 0; day < period; day++) {
          const dayNetStaffing = [];
          const dayRequirements = requirements[day] || [];
          const dayAssignments = schedule.days[day]?.assignments || [];
          
          for (let interval = 0; interval < dayRequirements.length; interval++) {
            const required = Math.round(dayRequirements[interval] || 0);
            const assigned = dayAssignments[interval]?.length || 0;
            const net = assigned - required;
            
            dayNetStaffing.push({
              interval,
              required,
              assigned,
              net,
              status: net === 0 ? 'balanced' : net > 0 ? 'overstaffed' : 'understaffed'
            });
          }
          
          netStaffing.push(dayNetStaffing);
        }
        
        return netStaffing;
      }

      identifyOvertimeOpportunities(schedule, requirements) {
        const opportunities = [];
        const period = parseInt(document.getElementById('schedulePeriod').value);
        
        for (let day = 0; day < period; day++) {
          const dayRequirements = requirements[day] || [];
          const dayAssignments = schedule.days[day]?.assignments || [];
          
          for (let interval = 0; interval < dayRequirements.length; interval++) {
            const required = Math.round(dayRequirements[interval] || 0);
            const assigned = dayAssignments[interval]?.length || 0;
            const shortfall = required - assigned;
            
            if (shortfall > 0) {
              // Calculate time for this interval
              const intervalMinutes = scheduleData.intervalLength;
              const totalMinutes = interval * intervalMinutes;
              const hours = Math.floor(totalMinutes / 60);
              const minutes = totalMinutes % 60;
              const timeString = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
              
              opportunities.push({
                day,
                interval,
                time: timeString,
                required,
                assigned,
                shortfall,
                potentialOvertime: shortfall
              });
            }
          }
        }
        
        return opportunities;
      }

      // Helper methods
      getAvailableAgentsAtHour(agentSchedules, dayIndex, hourIndex) {
        return agentSchedules
          .filter(agentSchedule => {
            const daySchedule = agentSchedule.schedule[dayIndex];
            if (!daySchedule || !daySchedule.working) return false;
            
            return daySchedule.activities.some(activity => 
              activity.start <= hourIndex && activity.end > hourIndex && activity.type === 'inbound'
            );
          })
          .sort((a, b) => a.totalHours - b.totalHours); // Prefer agents with fewer hours
      }

      reduceAgentHours(agentSchedule, targetHours) {
        // Simple reduction: remove some Inbound activities
        let currentHours = agentSchedule.totalHours;
        
        for (let day = agentSchedule.schedule.length - 1; day >= 0 && currentHours > targetHours; day--) {
          const daySchedule = agentSchedule.schedule[day];
          if (daySchedule.working) {
            // Remove last Inbound activity of the day
            for (let i = daySchedule.activities.length - 1; i >= 0; i--) {
              if (daySchedule.activities[i].type === 'inbound') {
                const duration = daySchedule.activities[i].end - daySchedule.activities[i].start;
                daySchedule.activities.splice(i, 1);
                currentHours -= duration;
                agentSchedule.totalHours -= duration;
                break;
              }
            }
          }
        }
      }

      adjustForConsecutiveDays(agentSchedule, maxDays) {
        // Add days off to break up long stretches
        let consecutiveDays = 0;
        
        for (let i = 0; i < agentSchedule.schedule.length; i++) {
          if (agentSchedule.schedule[i].working) {
            consecutiveDays++;
            if (consecutiveDays > maxDays) {
              // Make this day a day off
              agentSchedule.schedule[i].working = false;
              agentSchedule.schedule[i].activities = [];
              agentSchedule.daysWorking--;
              
              // Update hours
              const dayHours = agentSchedule.schedule[i].activities.reduce((sum, act) => 
                sum + (act.end - act.start), 0
              );
              agentSchedule.totalHours -= dayHours;
              
              consecutiveDays = 0;
            }
          } else {
            consecutiveDays = 0;
          }
        }
      }

      calculateMetrics(schedule, agentSchedules) {
        const totalPossibleHours = this.requirements.reduce((sum, day) => 
          sum + day.reduce((daySum, hour) => daySum + hour, 0), 0
        );
        
        const utilization = schedule.metrics.totalHours > 0 ? 
          (schedule.metrics.totalHours / totalPossibleHours) * 100 : 0;
        
        return {
          totalHours: Math.round(schedule.metrics.totalHours),
          utilization: Math.min(100, Math.round(utilization)),
          coverageGaps: Math.round(schedule.metrics.coverageGaps),
          overtime: Math.round(schedule.metrics.overtime),
          satisfaction: Math.round(schedule.metrics.satisfaction)
        };
      }
    }

    const schedulingEngine = new SchedulingEngine();

    // Generate requirements function
    async function generateRequirements(config) {
      const forecastSource = document.getElementById('forecastSource').value;
      const requirements = [];
      const period = config.period;
      
      if (forecastSource === 'manual') {
        // Use manual inputs
        const dailyInputs = document.querySelectorAll('#manualForecastSection input');
        const dailyRequirements = Array.from(dailyInputs).map(input => parseInt(input.value) || 0);
        
        for (let day = 0; day < period; day++) {
          const dayRequirements = [];
          const dayIndex = day % 7;
          const baseRequirement = dailyRequirements[dayIndex];
          
          // Create hourly pattern (peak in middle of business hours)
          const businessHours = config.businessHours.end - config.businessHours.start;
          const peakHour = Math.floor(businessHours / 2);
          
          // Calculate intervals per day based on interval length
          const intervalsPerHour = 60 / config.intervalLength;
          const totalIntervals = 24 * intervalsPerHour;
          
          for (let interval = 0; interval < totalIntervals; interval++) {
            const hour = Math.floor(interval / intervalsPerHour);
            if (hour >= config.businessHours.start && hour < config.businessHours.end) {
              // Calculate requirement for this interval
              const hourOffset = hour - config.businessHours.start;
              const distanceFromPeak = Math.abs(hourOffset - peakHour);
              const reduction = distanceFromPeak / businessHours;
              const requirement = Math.max(1, Math.round(baseRequirement * (1 - reduction * 0.5)));
              
              dayRequirements.push(requirement / intervalsPerHour);
            } else {
              // Outside business hours
              dayRequirements.push(0);
            }
          }
          
          requirements.push(dayRequirements);
        }
      } else if (forecastSource === 'import') {
        // Import from file
        const fileInput = document.getElementById('forecastFile');
        if (fileInput.files && fileInput.files[0]) {
          const file = fileInput.files[0];
          const text = await file.text();
          return parseForecastCSV(text, config);
        } else {
          // Fallback to generated requirements
          return generateRequirements({ ...config, forecastSource: 'manual' });
        }
      } else {
        // Use historical patterns (simplified)
        return generateRequirements({ ...config, forecastSource: 'manual' });
      }
      
      return requirements;
    }

    // Parse forecast CSV
    function parseForecastCSV(text, config) {
      const lines = text.split(/\r?\n/).filter(line => line.trim());
      if (lines.length === 0) return [];
      
      const headers = lines[0].split(',').map(h => h.trim().toLowerCase());
      const requirements = [];
      
      // Group by date
      const dateMap = new Map();
      
      for (let i = 1; i < lines.length; i++) {
        const values = lines[i].split(',');
        const row = {};
        headers.forEach((header, index) => {
          row[header] = values[index] ? values[index].trim() : '';
        });
        
        if (row.date && row.time && row.required_staff) {
          const dateKey = row.date;
          const intervalsPerHour = 60 / config.intervalLength;
          const totalIntervals = 24 * intervalsPerHour;
          
          if (!dateMap.has(dateKey)) {
            dateMap.set(dateKey, Array(totalIntervals).fill(0));
          }
          
          const timeParts = row.time.split(':');
          const hour = parseInt(timeParts[0]);
          const minute = timeParts[1] ? parseInt(timeParts[1]) : 0;
          const intervalIndex = hour * intervalsPerHour + Math.floor(minute / config.intervalLength);
          
          if (intervalIndex < dateMap.get(dateKey).length) {
            // Sum requirements across all queues
            const currentValue = dateMap.get(dateKey)[intervalIndex] || 0;
            const newValue = parseFloat(row.required_staff) || 0;
            dateMap.get(dateKey)[intervalIndex] = currentValue + newValue;
          }
        }
      }
      
      // Convert to array format (only take as many days as needed)
      const period = parseInt(document.getElementById('schedulePeriod').value);
      const sortedDates = Array.from(dateMap.keys()).sort();
      
      for (let i = 0; i < Math.min(period, sortedDates.length); i++) {
        const dateKey = sortedDates[i];
        requirements.push(dateMap.get(dateKey));
      }
      
      // If we have fewer days than period, duplicate the last day
      while (requirements.length < period) {
        const lastDay = requirements[requirements.length - 1] || Array(24 * (60 / config.intervalLength)).fill(0);
        requirements.push([...lastDay]);
      }
      
      return requirements;
    }

    // Collect rules
    function collectRules() {
      return {
        bestFit: document.getElementById('ruleBestFit').checked,
        evenSpread: document.getElementById('ruleEvenSpread').checked,
        minGaps: document.getElementById('ruleMinGaps').checked,
        respectPreferences: document.getElementById('ruleRespectPreferences').checked,
        avoidOvertime: document.getElementById('ruleAvoidOvertime').checked
      };
    }

    // Generate schedule
    async function generateSchedule() {
      const activeAgents = agents.filter(agent => 
        agent.status === 'active' && (!agent.endDate || new Date(agent.endDate) > new Date())
      );
      
      if (activeAgents.length === 0) {
        alert('No active agents found. Please add agents in the Agent Management tab.');
        return;
      }

      progressBar.style.display = 'block';
      updateProgress(10);
      updateStatus('Generating schedule...');

      try {
        const config = collectConfiguration();
        const staffPool = activeAgents.map(agent => ({
          id: agent.id,
          name: agent.name,
          department: agent.department,
          skills: agent.skills,
          queues: agent.queues,
          employmentType: agent.employmentType,
          contractedHours: agent.contractedHours,
          startDate: agent.startDate,
          endDate: agent.endDate,
          status: agent.status
        }));
        
        scheduleData.staff = staffPool;
        
        const requirements = await generateRequirements(config);
        scheduleData.requirements = requirements;
        
        updateProgress(40);
        
        const rules = collectRules();
        const schedule = schedulingEngine.generateSchedule(requirements, staffPool, rules);
        scheduleData.generatedSchedule = schedule;
        scheduleData.agentSchedules = schedule.agentSchedules;
        scheduleData.netStaffing = schedule.netStaffing;
        scheduleData.overtimeOpportunities = schedule.overtimeOpportunities;
        scheduleData.totalDays = schedule.days.length;
        scheduleData.currentDay = 0;
        scheduleData.modified = false;
        
        updateProgress(70);
        
        displayScheduleResults(schedule, schedule.metrics);
        displayAssignments(staffPool, schedule);
        generateDailyGrid();
        updateNetStaffingRibbon();
        updateOvertimeOpportunities();
        updateDateDisplay();
        
        updateProgress(100);
        
        setTimeout(() => {
          progressBar.style.display = 'none';
          progressFill.style.width = '0%';
        }, 1000);
        
        updateStatus('Schedule generated successfully');
        document.querySelector('[data-tab="scheduleView"]').click();
        saveChangesBtn.style.display = 'block';
        
      } catch (error) {
        console.error('Schedule generation error:', error);
        updateStatus('Error generating schedule: ' + error.message, true);
        progressBar.style.display = 'none';
      }
    }

    // Generate daily grid
    function generateDailyGrid() {
      if (!scheduleData.generatedSchedule || !scheduleData.agentSchedules) {
        dailyGrid.innerHTML = '<div class="note" style="margin: 20px; text-align: center;">No schedule generated yet. Click "Generate Schedule" to create a schedule.</div>';
        return;
      }

      dailyGrid.innerHTML = '';
      
      // Calculate intervals per day based on interval length
      const intervalsPerHour = 60 / scheduleData.intervalLength;
      const totalIntervals = 24 * intervalsPerHour;
      
      // Create header row
      const headerRow = document.createElement('div');
      headerRow.className = 'daily-grid-header';
      
      // Add staff name header
      const staffHeader = document.createElement('div');
      staffHeader.className = 'time-header-cell';
      staffHeader.textContent = 'Staff / Time';
      headerRow.appendChild(staffHeader);
      
      // Add time headers based on interval
      for (let interval = 0; interval < totalIntervals; interval++) {
        const hour = Math.floor(interval / intervalsPerHour);
        const minute = (interval % intervalsPerHour) * scheduleData.intervalLength;
        
        // Only show every 2nd interval label to avoid clutter
        if (interval % (intervalsPerHour * 2) === 0 || interval === totalIntervals - 1) {
          const timeHeader = document.createElement('div');
          timeHeader.className = 'time-header-cell';
          timeHeader.textContent = `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
          timeHeader.style.gridColumn = `span ${Math.min(intervalsPerHour * 2, totalIntervals - interval)}`;
          headerRow.appendChild(timeHeader);
        }
      }
      
      dailyGrid.appendChild(headerRow);
      
      // Create body
      const body = document.createElement('div');
      body.className = 'daily-grid-body';
      
      // Add staff rows
      scheduleData.agentSchedules.forEach(agentSchedule => {
        const dayIndex = scheduleData.currentDay;
        if (dayIndex >= agentSchedule.schedule.length) return;
        
        const daySchedule = agentSchedule.schedule[dayIndex];
        
        // Create staff row
        const staffRow = document.createElement('div');
        staffRow.className = 'staff-row';
        
        // Staff name cell
        const staffNameCell = document.createElement('div');
        staffNameCell.className = 'staff-name-cell';
        staffNameCell.textContent = agentSchedule.agentName;
        staffNameCell.title = agentSchedule.agentName;
        staffRow.appendChild(staffNameCell);
        
        // Time cells for each interval
        for (let interval = 0; interval < totalIntervals; interval++) {
          const hour = interval / intervalsPerHour;
          const cell = document.createElement('div');
          cell.className = 'time-cell';
          
          // Check if agent has activity at this interval
          let activityFound = null;
          if (daySchedule.working) {
            for (const activity of daySchedule.activities) {
              if (hour >= activity.start && hour < activity.end) {
                activityFound = activity;
                break;
              }
            }
          }
          
          if (activityFound) {
            let activityClass = 'activity-inbound';
            if (activityFound.type === 'break') activityClass = 'activity-break';
            if (activityFound.type === 'lunch') activityClass = 'activity-lunch';
            if (activityFound.type === 'meeting') activityClass = 'activity-meeting';
            if (activityFound.type === 'coaching') activityClass = 'activity-coaching';
            if (activityFound.type === 'training') activityClass = 'activity-training';
            
            const activityBlock = document.createElement('div');
            activityBlock.className = `activity-block ${activityClass}`;
            activityBlock.textContent = activityFound.activity.substring(0, 3);
            activityBlock.title = `${activityFound.activity} (${formatTime(hour)} - ${formatTime(activityFound.end)})`;
            cell.appendChild(activityBlock);
          } else {
            const emptyBlock = document.createElement('div');
            emptyBlock.className = 'activity-block activity-empty';
            cell.appendChild(emptyBlock);
          }
          
          staffRow.appendChild(cell);
        }
        
        body.appendChild(staffRow);
      });
      
      // Add requirements row at the bottom
      if (scheduleData.requirements && scheduleData.requirements[scheduleData.currentDay]) {
        const reqRow = document.createElement('div');
        reqRow.className = 'staff-row';
        
        const reqLabelCell = document.createElement('div');
        reqLabelCell.className = 'staff-name-cell';
        reqLabelCell.textContent = 'Requirements';
        reqLabelCell.style.fontWeight = '700';
        reqLabelCell.style.background = 'var(--light-bg)';
        reqRow.appendChild(reqLabelCell);
        
        const dayRequirements = scheduleData.requirements[scheduleData.currentDay];
        const dayAssignments = scheduleData.generatedSchedule.days[scheduleData.currentDay]?.assignments || [];
        
        for (let interval = 0; interval < totalIntervals; interval++) {
          const cell = document.createElement('div');
          cell.className = 'time-cell';
          cell.style.background = 'var(--light-bg)';
          
          const required = Math.round(dayRequirements[interval] || 0);
          const assigned = dayAssignments[interval]?.length || 0;
          const shortfall = required - assigned;
          
          if (required > 0) {
            const reqBlock = document.createElement('div');
            
            if (shortfall > 0) {
              reqBlock.className = 'activity-block activity-shortfall';
              reqBlock.textContent = `-${shortfall}`;
              reqBlock.title = `Shortfall: ${shortfall} staff needed\nRequired: ${required}\nAssigned: ${assigned}`;
            } else if (assigned > required) {
              reqBlock.className = 'activity-block activity-overtime';
              reqBlock.textContent = `+${assigned - required}`;
              reqBlock.title = `Overtime opportunity\nRequired: ${required}\nAssigned: ${assigned}`;
            } else {
              reqBlock.className = 'activity-block activity-inbound';
              reqBlock.textContent = required;
              reqBlock.title = `Required: ${required}\nAssigned: ${assigned}`;
            }
            
            cell.appendChild(reqBlock);
          }
          
          reqRow.appendChild(cell);
        }
        
        body.appendChild(reqRow);
      }
      
      dailyGrid.appendChild(body);
    }

    // Update net staffing ribbon
    function updateNetStaffingRibbon() {
      if (!scheduleData.netStaffing || scheduleData.netStaffing.length === 0) {
        netStaffingRibbon.style.display = 'none';
        return;
      }
      
      netStaffingRibbon.style.display = 'block';
      ribbonVisual.innerHTML = '';
      
      const dayNetStaffing = scheduleData.netStaffing[scheduleData.currentDay] || [];
      const intervalsPerHour = 60 / scheduleData.intervalLength;
      const totalIntervals = 24 * intervalsPerHour;
      
      let balancedCount = 0;
      let overstaffedCount = 0;
      let understaffedCount = 0;
      let overtimeOppCount = 0;
      
      // Group intervals for better visualization (e.g., show 2-hour blocks)
      const groupSize = intervalsPerHour * 2; // 2-hour blocks
      const groups = Math.ceil(totalIntervals / groupSize);
      
      for (let group = 0; group < groups; group++) {
        const startInterval = group * groupSize;
        const endInterval = Math.min(startInterval + groupSize, totalIntervals);
        
        let groupBalanced = 0;
        let groupOverstaffed = 0;
        let groupUnderstaffed = 0;
        let groupOvertimeOpp = 0;
        
        for (let i = startInterval; i < endInterval; i++) {
          if (i < dayNetStaffing.length) {
            const staffing = dayNetStaffing[i];
            if (staffing.net === 0) groupBalanced++;
            else if (staffing.net > 0) groupOverstaffed++;
            else if (staffing.net < 0) {
              groupUnderstaffed++;
              if (staffing.required > 0) groupOvertimeOpp++;
            }
          }
        }
        
        // Determine dominant status for this group
        let status = 'balanced';
        let count = groupBalanced;
        let color = '#10b981'; // green
        
        if (groupUnderstaffed > groupBalanced && groupUnderstaffed > groupOverstaffed) {
          status = 'understaffed';
          count = groupUnderstaffed;
          color = '#ef4444'; // red
        } else if (groupOverstaffed > groupBalanced && groupOverstaffed > groupUnderstaffed) {
          status = 'overstaffed';
          count = groupOverstaffed;
          color = '#3b82f6'; // blue
        } else if (groupOvertimeOpp > 0) {
          status = 'overtime-opp';
          count = groupOvertimeOpp;
          color = '#f59e0b'; // orange
        }
        
        // Update counts
        balancedCount += groupBalanced;
        overstaffedCount += groupOverstaffed;
        understaffedCount += groupUnderstaffed;
        overtimeOppCount += groupOvertimeOpp;
        
        // Create ribbon segment
        const segment = document.createElement('div');
        segment.className = 'ribbon-segment';
        segment.style.background = color;
        segment.style.width = `${(100 / groups)}%`;
        
        // Calculate time range for this segment
        const startHour = Math.floor(startInterval / intervalsPerHour);
        const startMinute = (startInterval % intervalsPerHour) * scheduleData.intervalLength;
        const endHour = Math.floor(endInterval / intervalsPerHour);
        const endMinute = (endInterval % intervalsPerHour) * scheduleData.intervalLength;
        
        const timeRange = `${startHour.toString().padStart(2, '0')}:${startMinute.toString().padStart(2, '0')} - ${endHour.toString().padStart(2, '0')}:${endMinute.toString().padStart(2, '0')}`;
        
        const tooltip = document.createElement('div');
        tooltip.className = 'ribbon-tooltip';
        tooltip.textContent = `${timeRange}: ${status}`;
        segment.appendChild(tooltip);
        
        ribbonVisual.appendChild(segment);
      }
      
      // Update ribbon stats
      document.getElementById('ribbonBalanced').textContent = balancedCount;
      document.getElementById('ribbonOverstaffed').textContent = overstaffedCount;
      document.getElementById('ribbonUnderstaffed').textContent = understaffedCount;
      document.getElementById('ribbonOvertimeOpp').textContent = overtimeOppCount;
    }

    // Update overtime opportunities
    function updateOvertimeOpportunities() {
      if (!scheduleData.overtimeOpportunities || scheduleData.overtimeOpportunities.length === 0) {
        overtimeOpportunities.style.display = 'none';
        return;
      }
      
      // Filter opportunities for current day
      const dayOpportunities = scheduleData.overtimeOpportunities.filter(
        opp => opp.day === scheduleData.currentDay
      );
      
      if (dayOpportunities.length === 0) {
        overtimeOpportunities.style.display = 'none';
        return;
      }
      
      overtimeOpportunities.style.display = 'block';
      opportunitiesList.innerHTML = '';
      
      // Group opportunities by time (2-hour windows)
      const groupedOpportunities = {};
      dayOpportunities.forEach(opp => {
        const hourGroup = Math.floor(opp.interval / (60 / scheduleData.intervalLength));
        const groupKey = `${Math.floor(hourGroup / 2) * 2}-${Math.floor(hourGroup / 2) * 2 + 2}`;
        
        if (!groupedOpportunities[groupKey]) {
          groupedOpportunities[groupKey] = {
            totalShortfall: 0,
            opportunities: []
          };
        }
        
        groupedOpportunities[groupKey].totalShortfall += opp.shortfall;
        groupedOpportunities[groupKey].opportunities.push(opp);
      });
      
      // Create opportunity items
      Object.entries(groupedOpportunities).forEach(([timeRange, data]) => {
        if (data.totalShortfall > 0) {
          const [startHour, endHour] = timeRange.split('-').map(Number);
          const opportunityItem = document.createElement('div');
          opportunityItem.className = 'opportunity-item';
          
          opportunityItem.innerHTML = `
            <div class="opportunity-time">
              ${startHour.toString().padStart(2, '0')}:00 - ${endHour.toString().padStart(2, '0')}:00
            </div>
            <div class="opportunity-details">
              <strong>${data.totalShortfall} staff shortfall</strong><br>
              ${data.opportunities.length} intervals affected
            </div>
          `;
          
          opportunitiesList.appendChild(opportunityItem);
        }
      });
    }

    // Format time for display
    function formatTime(hour) {
      const hours = Math.floor(hour);
      const minutes = Math.round((hour - hours) * 60);
      return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
    }

    // Collect configuration
    function collectConfiguration() {
      const period = parseInt(document.getElementById('schedulePeriod').value);
      const startDate = new Date(document.getElementById('startDate').value);
      const intervalLength = parseInt(document.getElementById('intervalLength').value);
      const businessHours = document.getElementById('businessHours').value;
      
      let customHours = { start: 8, end: 18 };
      if (businessHours === 'custom') {
        const start = document.getElementById('customStart').value;
        const end = document.getElementById('customEnd').value;
        customHours.start = parseInt(start.split(':')[0]);
        customHours.end = parseInt(end.split(':')[0]);
      } else if (businessHours !== '24') {
        const [start, end] = businessHours.split('_');
        customHours.start = parseInt(start);
        customHours.end = parseInt(end);
      } else {
        customHours = { start: 0, end: 24 };
      }
      
      return {
        period,
        startDate,
        intervalLength,
        businessHours: customHours
      };
    }

    // Display schedule results
    function displayScheduleResults(schedule, metrics) {
      // Update metrics display
      updateResultsDisplay(metrics);
      
      // Update interval length
      scheduleData.intervalLength = parseInt(document.getElementById('intervalLength').value);
      
      // Update date display
      updateDateDisplay();
    }

    // Update results display
    function updateResultsDisplay(metrics) {
      document.getElementById('resultScheduledHours').textContent = metrics.totalHours;
      document.getElementById('resultUtilization').textContent = metrics.utilization + '%';
      document.getElementById('resultCoverageGaps').textContent = metrics.coverageGaps;
      document.getElementById('resultOvertime').textContent = metrics.overtime;
    }

    // Update date display
    function updateDateDisplay() {
      if (!scheduleData.generatedSchedule || scheduleData.totalDays === 0) {
        currentDateDisplay.textContent = 'No schedule generated';
        return;
      }
      
      const startDate = new Date(document.getElementById('startDate').value);
      const currentDate = new Date(startDate);
      currentDate.setDate(currentDate.getDate() + scheduleData.currentDay);
      
      const dayNames = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
      const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
      
      const dayName = dayNames[currentDate.getDay()];
      const monthName = monthNames[currentDate.getMonth()];
      const day = currentDate.getDate();
      const year = currentDate.getFullYear();
      
      currentDateDisplay.textContent = `${dayName}, ${day} ${monthName} ${year} (Day ${scheduleData.currentDay + 1} of ${scheduleData.totalDays})`;
    }

    // Display assignments
    function displayAssignments(staffPool, schedule) {
      assignmentsTableBody.innerHTML = '';
      
      const staffHours = {};
      const staffDays = {};
      
      schedule.agentSchedules.forEach(agentSchedule => {
        staffHours[agentSchedule.agentId] = Math.round(agentSchedule.totalHours);
        staffDays[agentSchedule.agentId] = agentSchedule.daysWorking;
      });
      
      staffPool.forEach(agent => {
        const row = document.createElement('tr');
        const hours = staffHours[agent.id] || 0;
        const days = staffDays[agent.id] || 0;
        
        let status = 'âœ…';
        if (hours > agent.contractedHours * (parseInt(document.getElementById('schedulePeriod').value) / 7)) {
          status = 'âš ï¸ Overtime';
        } else if (hours < agent.contractedHours * (parseInt(document.getElementById('schedulePeriod').value) / 7) * 0.5) {
          status = 'ðŸ“‰ Underutilized';
        }
        
        row.innerHTML = `
          <td>${agent.id}</td>
          <td>${agent.name}</td>
          <td class="center">${agent.department}</td>
          <td class="center">
            <div class="badge-list">
              ${agent.skills.slice(0, 2).map(skill => `<span class="badge-item">${skill}</span>`).join('')}
            </div>
          </td>
          <td class="center">${hours}</td>
          <td class="center">${agent.employmentType}</td>
          <td class="center">${days}</td>
          <td class="center">${status}</td>
        `;
        
        assignmentsTableBody.appendChild(row);
      });
    }

    // Update progress
    function updateProgress(percent) {
      progressFill.style.width = `${percent}%`;
    }
    
    // Update status
    function updateStatus(message, isError = false) {
      scheduleStatus.textContent = message;
      scheduleStatus.style.color = isError ? 'var(--bad)' : 'var(--text-color)';
    }

    // Save changes
    function saveChanges() {
      if (!scheduleData.modified) {
        updateStatus('No changes to save');
        return;
      }
      
      // In a real application, this would save to a backend
      // For now, we'll just update local storage
      try {
        localStorage.setItem('wfmScheduleData', JSON.stringify(scheduleData));
        scheduleData.modified = false;
        updateStatus('Changes saved successfully');
        saveChangesBtn.textContent = 'ðŸ’¾ Save Changes';
      } catch (error) {
        updateStatus('Error saving changes: ' + error.message, true);
      }
    }

    // Show publish modal
    function showPublishModal() {
      // Set default dates
      const startDate = new Date(document.getElementById('startDate').value);
      publishStartDate.value = formatDate(startDate);
      
      const endDate = new Date(startDate);
      endDate.setDate(endDate.getDate() + scheduleData.totalDays - 1);
      publishEndDate.value = formatDate(endDate);
      
      publishModal.style.display = 'flex';
    }

    // Hide publish modal
    function hidePublishModal() {
      publishModal.style.display = 'none';
    }

    // Publish schedule
    function publishSchedule(event) {
      event.preventDefault();
      
      const option = publishOption.value;
      const startDate = publishStartDate.value;
      const endDate = publishEndDate.value;
      const notes = document.getElementById('publishNotes').value;
      
      let publishRange = '';
      if (option === 'current') {
        publishRange = 'Current day only';
      } else if (option === 'range') {
        publishRange = `${startDate} to ${endDate}`;
      } else {
        publishRange = 'All days';
      }
      
      // In a real application, this would send to a backend
      // For now, we'll just show a confirmation
      updateStatus(`Schedule published for: ${publishRange}`);
      
      if (notes) {
        console.log('Publish notes:', notes);
      }
      
      hidePublishModal();
      
      // Show success message
      alert(`Schedule published successfully!\n\nRange: ${publishRange}\n\nThe schedule is now visible to all team members.`);
    }

    // Change interval
    function changeInterval(interval) {
      // Update interval buttons
      intervalButtons.forEach(btn => {
        btn.classList.remove('active');
        if (parseInt(btn.dataset.interval) === interval) {
          btn.classList.add('active');
        }
      });
      
      // Update select
      document.getElementById('intervalLength').value = interval;
      
      // Update schedule data
      scheduleData.intervalLength = interval;
      
      // Regenerate grid if schedule exists
      if (scheduleData.generatedSchedule) {
        generateDailyGrid();
        updateNetStaffingRibbon();
        updateOvertimeOpportunities();
      }
    }

    // Navigate days
    function navigateDay(direction) {
      if (!scheduleData.generatedSchedule) return;
      
      const newDay = scheduleData.currentDay + direction;
      if (newDay >= 0 && newDay < scheduleData.totalDays) {
        scheduleData.currentDay = newDay;
        generateDailyGrid();
        updateNetStaffingRibbon();
        updateOvertimeOpportunities();
        updateDateDisplay();
      }
    }

    // Event Listeners
    initializeDatePicker();
    initializeAgents();
    
    // Business hours toggle
    businessHoursSelect.addEventListener('change', function() {
      customHoursSection.style.display = this.value === 'custom' ? 'block' : 'none';
    });

    // Forecast source toggle
    forecastSourceSelect.addEventListener('change', function() {
      manualForecastSection.style.display = this.value === 'manual' ? 'block' : 'none';
      importForecastSection.style.display = this.value === 'import' ? 'block' : 'none';
    });

    // Rule toggles
    document.querySelectorAll('.rule-item input[type="checkbox"]').forEach(checkbox => {
      checkbox.addEventListener('change', function() {
        const ruleItem = this.closest('.rule-item');
        if (this.checked) {
          ruleItem.classList.add('active');
        } else {
          ruleItem.classList.remove('active');
        }
      });
    });

    // Interval buttons
    intervalButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        changeInterval(parseInt(btn.dataset.interval));
      });
    });

    // Interval select
    document.getElementById('intervalLength').addEventListener('change', function() {
      changeInterval(parseInt(this.value));
    });

    // Day navigation
    prevDayBtn.addEventListener('click', () => navigateDay(-1));
    nextDayBtn.addEventListener('click', () => navigateDay(1));

    // Main button event listeners
    generateScheduleBtn.addEventListener('click', generateSchedule);
    manageStaffBtn.addEventListener('click', () => {
      document.querySelector('[data-tab="agents"]').click();
    });
    saveChangesBtn.addEventListener('click', saveChanges);
    publishScheduleBtn.addEventListener('click', showPublishModal);

    // Agent management event listeners
    searchInput.addEventListener('input', updateAgentDisplay);
    departmentFilter.addEventListener('change', updateAgentDisplay);
    statusFilter.addEventListener('change', updateAgentDisplay);
    addAgentBtn.addEventListener('click', () => showAgentModal());
    modalCloseBtn.addEventListener('click', hideAgentModal);
    cancelModalBtn.addEventListener('click', hideAgentModal);
    agentForm.addEventListener('submit', saveAgent);

    // Publish modal event listeners
    publishModalCloseBtn.addEventListener('click', hidePublishModal);
    cancelPublishBtn.addEventListener('click', hidePublishModal);
    publishForm.addEventListener('submit', publishSchedule);
    
    publishOption.addEventListener('change', function() {
      dateRangeSection.style.display = this.value === 'range' ? 'block' : 'none';
    });

    // Handle edit/delete clicks
    agentsTableBody.addEventListener('click', (event) => {
      const target = event.target;
      const button = target.closest('button');
      
      if (!button) return;
      
      const agentId = parseInt(button.getAttribute('data-id'));
      
      if (button.classList.contains('edit')) {
        showAgentModal(agentId);
      } else if (button.classList.contains('delete')) {
        deleteAgent(agentId);
      }
    });

    // Close modals when clicking outside
    agentModal.addEventListener('click', (e) => {
      if (e.target === agentModal) {
        hideAgentModal();
      }
    });
    
    publishModal.addEventListener('click', (e) => {
      if (e.target === publishModal) {
        hidePublishModal();
      }
    });

    // Initialize with default status
    updateStatus('Ready to create schedule');
    
    // Try to load saved schedule
    try {
      const savedData = localStorage.getItem('wfmScheduleData');
      if (savedData) {
        const parsed = JSON.parse(savedData);
        if (parsed.generatedSchedule) {
          scheduleData = parsed;
          updateStatus('Loaded saved schedule');
          if (scheduleData.modified) {
            saveChangesBtn.style.display = 'block';
            saveChangesBtn.textContent = 'ðŸ’¾ Save Changes*';
          }
        }
      }
    } catch (error) {
      console.log('No saved schedule found');
    }
  </script>
</body>
</html>
