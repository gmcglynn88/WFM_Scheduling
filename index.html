<!DOCTYPE html>
<html lang="en-GB">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>WFM Scheduling Tool | Rule-Based Scheduling</title>
  <style>
    :root {
      --primary-color: #63AB8F;
      --secondary-color: #4A8C7D;
      --border-color: #DEE2E6;
      --light-bg: #F8F9FA;
      --card-bg: #FFFFFF;
      --text-color: #2C3E50;
      --text-light: #6C757D;
      --warn: #f59e0b;
      --bad: #dc2626;
      --good: #16a34a;
      --schedule-available: #63AB8F;
      --schedule-assigned: #4A8C7D;
      --schedule-unavailable: #9CA3AF;
      --schedule-overtime: #F59E0B;
      --chart-1: #4A8C7D;
      --chart-2: #63AB8F;
      --chart-3: #A8D5BA;
      --chart-4: #C7E8D3;
      --modified: #8b5cf6;
      --overstaffed: #3b82f6;
      --understaffed: #ef4444;
      --shortfall: #dc2626;
      --overtime-opp: #f59e0b;
      --on-queue: #3b82f6;
      --break-color: #f59e0b;
      --lunch-color: #dc2626;
      --meeting-color: #8b5cf6;
    }
    
    body, h1, h2, h3, h4, h5, h6, p, div, span, label, button, input, select, textarea, th, td, li, ul, ol {
      font-family: 'Aptos', 'Segoe UI', system-ui, -apple-system, Arial, sans-serif;
    }
    
    body {
      margin: 0;
      padding: 20px;
      background: var(--light-bg);
      color: var(--text-color);
      min-height: 100vh;
    }
    
    .container {
      max-width: 1800px;
      margin: 0 auto;
    }

    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 2px solid var(--border-color);
    }
    
    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .brand h1 {
      margin: 0;
      font-size: 28px;
      color: var(--secondary-color);
      font-weight: 800;
    }
    
    .brand .subtitle {
      color: var(--text-light);
      font-weight: 600;
      font-size: 14px;
      margin-left: 8px;
    }
    
    .schedule-status {
      background: white;
      padding: 10px 16px;
      border-radius: 8px;
      border: 1px solid var(--border-color);
      font-size: 14px;
      min-width: 200px;
      text-align: center;
    }

    .main-layout {
      display: grid;
      grid-template-columns: 1fr;
      gap: 24px;
    }
    
    .cards-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 24px;
    }
    
    @media (max-width: 768px) {
      .cards-row {
        grid-template-columns: 1fr;
      }
    }

    .card {
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 24px;
      box-shadow: 0 1px 3px rgba(0,0,0,.08);
    }
    
    .card:hover {
      box-shadow: 0 2px 8px rgba(0,0,0,.1);
    }
    
    .card-title {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
      padding-bottom: 16px;
      border-bottom: 2px solid var(--border-color);
    }
    
    .card-title h2 {
      margin: 0;
      font-size: 18px;
      font-weight: 700;
      color: var(--secondary-color);
    }
    
    .badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 900;
      background: rgba(99, 171, 143, 0.1);
      color: var(--secondary-color);
      border: 1px solid rgba(99, 171, 143, 0.3);
    }

    .form-group {
      margin-bottom: 20px;
    }
    
    label {
      display: block;
      font-weight: 600;
      margin-bottom: 8px;
      font-size: 14px;
      color: var(--text-color);
    }
    
    select, input, textarea, button {
      padding: 12px 14px;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      background: var(--card-bg);
      font-size: 14px;
      width: 100%;
      box-sizing: border-box;
      transition: all 0.2s ease;
    }
    
    select:focus, input:focus, textarea:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(99, 171, 143, 0.1);
    }
    
    button {
      background: var(--primary-color);
      color: #fff;
      font-weight: 600;
      cursor: pointer;
      transition: background .2s;
      border: none;
    }
    
    button:hover {
      background: var(--secondary-color);
      transform: translateY(-1px);
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    
    button.secondary {
      background: #fff;
      color: var(--primary-color);
      border: 2px solid var(--primary-color);
    }
    
    button.secondary:hover {
      background: rgba(99, 171, 143, 0.1);
      border-color: var(--secondary-color);
      color: var(--secondary-color);
    }
    
    button:disabled {
      background: var(--text-light);
      cursor: not-allowed;
      transform: none !important;
      box-shadow: none !important;
    }

    .row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }
    
    .row-3 {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 16px;
    }
    
    @media (max-width: 768px) {
      .row, .row-3 {
        grid-template-columns: 1fr;
      }
    }

    .btn-group {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px solid var(--border-color);
    }
    
    .btn-group button {
      flex: 1;
      min-width: 140px;
    }

    .rule-group {
      margin-bottom: 24px;
    }
    
    .rule-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      background: rgba(99, 171, 143, 0.05);
      border-radius: 8px;
      margin-bottom: 8px;
      border: 1px solid transparent;
      transition: all 0.2s ease;
    }
    
    .rule-item:hover {
      border-color: var(--primary-color);
      background: rgba(99, 171, 143, 0.1);
    }
    
    .rule-item input[type="checkbox"] {
      width: 18px;
      height: 18px;
      margin: 0;
    }
    
    .rule-label {
      flex: 1;
      font-weight: 600;
      color: var(--text-color);
    }
    
    .rule-description {
      font-size: 12px;
      color: var(--text-light);
      margin-top: 2px;
    }
    
    .rule-settings {
      margin-top: 12px;
      padding: 12px;
      background: white;
      border-radius: 6px;
      border: 1px solid var(--border-color);
      display: none;
    }
    
    .rule-item.active .rule-settings {
      display: block;
    }

    .schedule-view-container {
      margin-top: 32px;
      border-top: 2px solid var(--border-color);
      padding-top: 24px;
    }
    
    .schedule-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }
    
    .schedule-header h2 {
      margin: 0;
      font-size: 24px;
      color: var(--secondary-color);
    }
    
    .schedule-controls {
      display: flex;
      gap: 12px;
      align-items: center;
      flex-wrap: wrap;
    }
    
    .date-navigation {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .date-navigation button {
      padding: 8px 12px;
      min-width: auto;
    }

    .net-staffing-ribbon {
      background: white;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 24px;
      box-shadow: 0 1px 3px rgba(0,0,0,.08);
      overflow-x: auto;
    }
    
    .ribbon-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }
    
    .ribbon-header h3 {
      margin: 0;
      font-size: 16px;
      color: var(--secondary-color);
    }
    
    .ribbon-stats {
      display: flex;
      gap: 20px;
    }
    
    .stat-item {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    
    .stat-value {
      font-size: 20px;
      font-weight: 700;
    }
    
    .stat-label {
      font-size: 12px;
      color: var(--text-light);
    }
    
    .net-overstaffed {
      color: var(--overstaffed);
    }
    
    .net-understaffed {
      color: var(--understaffed);
    }
    
    .net-balanced {
      color: var(--good);
    }
    
    .net-overtime {
      color: var(--overtime-opp);
    }
    
    .ribbon-visual {
      display: flex;
      height: 60px;
      border-radius: 4px;
      overflow: hidden;
      border: 1px solid var(--border-color);
      min-width: 1200px;
    }
    
    .ribbon-segment {
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 600;
      font-size: 11px;
      transition: all 0.2s;
      position: relative;
      flex: 1;
      min-width: 40px;
      border-right: 1px solid rgba(255,255,255,0.3);
    }
    
    .ribbon-segment:hover {
      filter: brightness(1.1);
      z-index: 10;
      transform: scale(1.05);
    }
    
    .ribbon-tooltip {
      position: absolute;
      top: -40px;
      background: var(--text-color);
      color: white;
      padding: 6px 12px;
      border-radius: 4px;
      font-size: 11px;
      white-space: nowrap;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s;
      z-index: 100;
    }
    
    .ribbon-segment:hover .ribbon-tooltip {
      opacity: 1;
    }
    
    .ribbon-time-labels {
      display: flex;
      margin-top: 4px;
      min-width: 1200px;
    }
    
    .ribbon-time-label {
      flex: 1;
      text-align: center;
      font-size: 10px;
      color: var(--text-light);
      padding: 2px;
      border-top: 1px solid var(--border-color);
    }

    .horizontal-schedule-container {
      background: white;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      overflow: hidden;
      margin-bottom: 24px;
    }
    
    .schedule-grid-wrapper {
      overflow-x: auto;
      max-height: 700px;
      position: relative;
    }
    
    .horizontal-schedule-grid {
      display: grid;
      min-width: 1600px;
      border-collapse: collapse;
    }
    
    .schedule-time-header {
      display: contents;
      position: sticky;
      top: 0;
      z-index: 20;
      background: white;
    }
    
    .agent-name-header {
      padding: 12px;
      background: var(--light-bg);
      border-right: 1px solid var(--border-color);
      border-bottom: 2px solid var(--border-color);
      font-weight: 600;
      color: var(--secondary-color);
      position: sticky;
      left: 0;
      z-index: 25;
      min-width: 150px;
      white-space: nowrap;
      text-align: left;
    }
    
    .time-interval-header {
      padding: 12px 4px;
      background: var(--light-bg);
      border-right: 1px solid var(--border-color);
      border-bottom: 2px solid var(--border-color);
      text-align: center;
      font-weight: 600;
      color: var(--secondary-color);
      position: sticky;
      top: 0;
      z-index: 15;
      min-width: 40px;
    }
    
    .hour-marker-header {
      padding: 8px 2px;
      background: white;
      border-right: 1px solid var(--border-color);
      border-bottom: 1px solid var(--border-color);
      text-align: center;
      font-size: 11px;
      color: var(--text-light);
      position: sticky;
      top: 48px;
      z-index: 10;
      min-width: 40px;
    }
    
    .agent-schedule-row {
      display: contents;
    }
    
    .agent-name-cell {
      padding: 12px;
      border-right: 1px solid var(--border-color);
      border-bottom: 1px solid var(--border-color);
      font-weight: 600;
      color: var(--text-color);
      position: sticky;
      left: 0;
      z-index: 5;
      background: white;
      min-width: 150px;
      white-space: nowrap;
    }
    
    .time-interval-cell {
      padding: 2px;
      border-right: 1px solid var(--border-color);
      border-bottom: 1px solid var(--border-color);
      min-height: 48px;
      min-width: 40px;
      position: relative;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .time-interval-cell:hover {
      background: rgba(99, 171, 143, 0.05);
      z-index: 5;
    }
    
    .activity-block {
      height: 100%;
      border-radius: 4px;
      padding: 8px 2px;
      font-size: 11px;
      font-weight: 600;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      border: 1px solid transparent;
      transition: all 0.2s;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    
    .activity-block:hover {
      filter: brightness(1.1);
      transform: scale(1.02);
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .activity-onqueue {
      background: linear-gradient(135deg, var(--on-queue), #2563eb);
      border-color: #2563eb;
    }
    
    .activity-break {
      background: linear-gradient(135deg, var(--break-color), #d97706);
      border-color: #d97706;
    }
    
    .activity-lunch {
      background: linear-gradient(135deg, var(--lunch-color), #b91c1c);
      border-color: #b91c1c;
    }
    
    .activity-meeting {
      background: linear-gradient(135deg, var(--meeting-color), #7c3aed);
      border-color: #7c3aed;
    }
    
    .activity-coaching {
      background: linear-gradient(135deg, #10b981, #0d9488);
      border-color: #0d9488;
    }
    
    .activity-overtime {
      background: repeating-linear-gradient(
        45deg,
        var(--overtime-opp),
        var(--overtime-opp) 10px,
        #fbbf24 10px,
        #fbbf24 20px
      );
      color: white;
      border: 1px solid var(--warn);
    }
    
    .activity-unavailable {
      background: rgba(156, 163, 175, 0.1);
      color: var(--text-light);
    }
    
    .overtime-row {
      background: rgba(245, 158, 11, 0.1);
      border-top: 2px solid var(--overtime-opp);
    }
    
    .overtime-cell {
      padding: 8px 4px;
      text-align: center;
      font-size: 11px;
      font-weight: 600;
      color: var(--text-color);
      border-right: 1px solid var(--border-color);
      border-bottom: 1px solid var(--border-color);
    }
    
    .overtime-opportunity {
      background: rgba(245, 158, 11, 0.3);
      border-radius: 3px;
      padding: 4px;
      color: var(--warn);
      cursor: pointer;
    }
    
    .overtime-opportunity:hover {
      background: rgba(245, 158, 11, 0.5);
    }

    .interval-selector {
      display: flex;
      gap: 12px;
      align-items: center;
      margin-bottom: 16px;
    }
    
    .interval-buttons {
      display: flex;
      gap: 8px;
    }
    
    .interval-btn {
      padding: 8px 16px;
      border: 1px solid var(--border-color);
      background: white;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.2s;
    }
    
    .interval-btn:hover {
      background: rgba(99, 171, 143, 0.1);
    }
    
    .interval-btn.active {
      background: var(--primary-color);
      color: white;
      border-color: var(--primary-color);
    }
    
    .sort-controls {
      display: flex;
      gap: 12px;
      align-items: center;
      margin-bottom: 16px;
    }
    
    .sort-select {
      min-width: 200px;
    }

    .publish-controls {
      display: flex;
      gap: 12px;
      align-items: center;
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px solid var(--border-color);
    }
    
    .publish-controls button {
      min-width: 150px;
    }

    .summary-tiles {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin: 24px 0;
    }
    
    .tile {
      border: 1px solid var(--border-color);
      border-radius: 10px;
      padding: 20px;
      background: #fff;
      text-align: center;
    }
    
    .tile .label {
      color: var(--text-light);
      font-weight: 800;
      font-size: 13px;
      letter-spacing: .3px;
      text-transform: uppercase;
      margin-bottom: 8px;
    }
    
    .tile .value {
      font-size: 28px;
      font-weight: 900;
      margin-top: 4px;
      color: var(--secondary-color);
      line-height: 1.2;
    }
    
    .tile .subtext {
      margin-top: 8px;
      font-size: 12px;
      color: var(--text-light);
      line-height: 1.4;
    }

    .optimization-results {
      background: rgba(99, 171, 143, 0.05);
      border: 1px solid var(--primary-color);
      border-radius: 8px;
      padding: 20px;
      margin-top: 20px;
    }
    
    .optimization-metrics {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 16px;
      margin-top: 16px;
    }
    
    .metric {
      text-align: center;
      padding: 12px;
      background: white;
      border-radius: 6px;
      border: 1px solid var(--border-color);
    }
    
    .metric .value {
      font-size: 20px;
      font-weight: 700;
      color: var(--secondary-color);
    }
    
    .metric .label {
      font-size: 12px;
      color: var(--text-light);
      margin-top: 4px;
    }

    .note {
      background: rgba(99, 171, 143, 0.05);
      border-left: 4px solid var(--primary-color);
      border-radius: 8px;
      padding: 14px;
      margin-top: 20px;
      font-size: 13px;
      color: var(--text-color);
      line-height: 1.5;
    }

    .progress-bar {
      height: 8px;
      background: var(--border-color);
      border-radius: 4px;
      overflow: hidden;
      margin: 20px 0;
    }
    
    .progress-fill {
      height: 100%;
      background: var(--primary-color);
      transition: width 0.3s ease;
    }

    .footer {
      margin-top: 40px;
      padding-top: 20px;
      border-top: 1px solid var(--border-color);
      text-align: center;
      color: var(--text-light);
      font-size: 12px;
    }

    .tabs {
      display: flex;
      border-bottom: 2px solid var(--border-color);
      margin-bottom: 24px;
    }
    
    .tab {
      padding: 12px 24px;
      background: none;
      border: none;
      font-size: 16px;
      font-weight: 600;
      color: var(--text-light);
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
    }
    
    .tab:hover {
      color: var(--primary-color);
    }
    
    .tab.active {
      color: var(--primary-color);
    }
    
    .tab.active::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      right: 0;
      height: 2px;
      background: var(--primary-color);
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }

    .table-container {
      max-height: 400px;
      overflow: auto;
      border: 1px solid var(--border-color);
      border-radius: 12px;
      margin-top: 24px;
    }
    
    .search-filter-bar {
      display: flex;
      gap: 15px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    
    .search-box {
      flex: 1;
      min-width: 250px;
    }
    
    .filter-select {
      min-width: 150px;
    }
    
    .agent-summary {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .summary-card {
      background: white;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 15px;
      text-align: center;
    }
    
    .summary-card .value {
      font-size: 24px;
      font-weight: 900;
      color: var(--secondary-color);
      margin-bottom: 5px;
    }
    
    .summary-card .label {
      font-size: 12px;
      color: var(--text-light);
      font-weight: 600;
      text-transform: uppercase;
    }
    
    .badge-list {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin: 0;
      padding: 0;
    }
    
    .badge-item {
      display: inline-block;
      padding: 2px 8px;
      background: rgba(99, 171, 143, 0.1);
      border: 1px solid rgba(99, 171, 143, 0.3);
      border-radius: 12px;
      font-size: 11px;
      color: var(--secondary-color);
      white-space: nowrap;
    }
    
    .status-active {
      color: var(--good);
      font-weight: 600;
    }
    
    .status-inactive {
      color: var(--bad);
      font-weight: 600;
    }
    
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }
    
    .modal {
      background: white;
      border-radius: 12px;
      width: 90%;
      max-width: 800px;
      max-height: 90vh;
      overflow-y: auto;
    }
    
    .modal-header {
      padding: 20px 24px;
      border-bottom: 1px solid var(--border-color);
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: var(--primary-color);
      color: white;
      border-radius: 12px 12px 0 0;
    }
    
    .modal-header h2 {
      margin: 0;
      font-size: 20px;
    }
    
    .modal-close {
      background: none;
      border: none;
      color: white;
      font-size: 24px;
      cursor: pointer;
      padding: 0;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
    }
    
    .modal-body {
      padding: 24px;
    }
    
    .activity-block-simple {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 600;
      margin: 1px;
      min-width: 60px;
      text-align: center;
    }
    
    .activity-inbound {
      background: rgba(99, 171, 143, 0.3);
      border: 1px solid rgba(99, 171, 143, 0.5);
      color: var(--secondary-color);
    }
    
    .activity-break-simple {
      background: rgba(245, 158, 11, 0.3);
      border: 1px solid rgba(245, 158, 11, 0.5);
      color: var(--warn);
    }
    
    .activity-lunch-simple {
      background: rgba(220, 38, 38, 0.3);
      border: 1px solid rgba(220, 38, 38, 0.5);
      color: var(--bad);
    }
    
    .activity-meeting-simple {
      background: rgba(37, 99, 235, 0.3);
      border: 1px solid rgba(37, 99, 235, 0.5);
      color: #2563eb;
    }
    
    .activity-coaching-simple {
      background: rgba(147, 51, 234, 0.3);
      border: 1px solid rgba(147, 51, 234, 0.5);
      color: #9333ea;
    }

    .schedule-legend {
      padding: 16px;
      background: var(--light-bg);
      border-top: 1px solid var(--border-color);
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
    }
    
    .legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 12px;
    }
    
    .legend-color {
      width: 16px;
      height: 16px;
      border-radius: 4px;
    }

    @media (max-width: 768px) {
      body {
        padding: 10px;
      }
      
      .card {
        padding: 16px;
      }
      
      .header {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
      }
      
      .schedule-status {
        width: 100%;
        min-width: unset;
      }
      
      .schedule-controls {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .publish-controls {
        flex-direction: column;
        align-items: stretch;
      }
      
      .publish-controls button {
        width: 100%;
      }
      
      .ribbon-stats {
        flex-direction: column;
        gap: 10px;
      }
    }

    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb {
      background: var(--primary-color);
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: var(--secondary-color);
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="brand">
        <h1>WFM Scheduling Tool</h1>
        <span class="subtitle">Rule-Based Scheduling</span>
      </div>
      <div class="schedule-status" id="scheduleStatus">
        Ready to create schedule
      </div>
    </div>

    <div class="tabs">
      <button class="tab active" data-tab="scheduling">Scheduling</button>
      <button class="tab" data-tab="agents">Agent Management</button>
      <button class="tab" data-tab="scheduleView">Schedule View</button>
    </div>

    <div id="schedulingTab" class="tab-content active">
      <div class="main-layout">
        <div class="card">
          <div class="card-title">
            <h2>Schedule Configuration</h2>
            <span class="badge">Setup</span>
          </div>
          
          <div class="row">
            <div class="form-group">
              <label for="schedulePeriod">Schedule Period</label>
              <select id="schedulePeriod">
                <option value="7">7 days (1 week)</option>
                <option value="14" selected>14 days (2 weeks)</option>
                <option value="28">28 days (4 weeks)</option>
                <option value="30">30 days (1 month)</option>
              </select>
            </div>

            <div class="form-group">
              <label for="startDate">Start Date</label>
              <input type="date" id="startDate" value="">
            </div>
          </div>

          <div class="row">
            <div class="form-group">
              <label for="intervalLength">Interval Length</label>
              <select id="intervalLength">
                <option value="15">15 minutes</option>
                <option value="30">30 minutes</option>
                <option value="45">45 minutes</option>
                <option value="60" selected>60 minutes</option>
              </select>
            </div>

            <div class="form-group">
              <label for="businessHours">Business Hours</label>
              <select id="businessHours">
                <option value="8_18">8:00 - 18:00 (10 hours)</option>
                <option value="9_17" selected>9:00 - 17:00 (8 hours)</option>
                <option value="8_20">8:00 - 20:00 (12 hours)</option>
                <option value="24">24/7 Operation</option>
                <option value="custom">Custom Hours</option>
              </select>
            </div>
          </div>

          <div id="customHoursSection" class="form-group" style="display: none;">
            <label>Custom Business Hours</label>
            <div class="row">
              <input type="time" id="customStart" value="08:00">
              <input type="time" id="customEnd" value="18:00">
            </div>
          </div>
        </div>

        <div class="cards-row">
          <div class="card">
            <div class="card-title">
              <h2>Staff Pool</h2>
              <span class="badge">Resources</span>
            </div>
            
            <div class="agent-summary" style="margin-bottom: 20px;">
              <div class="summary-card">
                <div class="value" id="totalAgentsCount">0</div>
                <div class="label">Total Agents</div>
              </div>
              <div class="summary-card">
                <div class="value" id="fullTimeCount">0</div>
                <div class="label">Full Time</div>
              </div>
              <div class="summary-card">
                <div class="value" id="partTimeCount">0</div>
                <div class="label">Part Time</div>
              </div>
              <div class="summary-card">
                <div class="value" id="activeCount">0</div>
                <div class="label">Active</div>
              </div>
            </div>

            <div class="form-group">
              <label for="skillLevel">Average Skill Level</label>
              <select id="skillLevel">
                <option value="0.8">Level 1 (Trainee)</option>
                <option value="1.0" selected>Level 2 (Standard)</option>
                <option value="1.2">Level 3 (Experienced)</option>
                <option value="1.5">Level 4 (Expert)</option>
              </select>
            </div>

            <button id="manageStaffBtn" class="secondary">ðŸ‘¥ Go to Agent Management</button>
          </div>

          <div class="card">
            <div class="card-title">
              <h2>Shift Patterns</h2>
              <span class="badge">Work Hours</span>
            </div>
            
            <div class="form-group">
              <label for="shiftPattern">Primary Shift Pattern</label>
              <select id="shiftPattern">
                <option value="8x5">8x5 (8hrs, 5 days/week)</option>
                <option value="9x5" selected>9x5 (9hrs, 5 days/week)</option>
                <option value="10x4">10x4 (10hrs, 4 days/week)</option>
                <option value="12x3">12x3 (12hrs, 3 days/week)</option>
                <option value="custom">Custom Pattern</option>
              </select>
            </div>

            <div class="form-group">
              <label for="lunchDuration">Lunch Duration (minutes)</label>
              <input type="number" id="lunchDuration" min="15" max="120" value="60" step="15">
            </div>

            <div class="form-group">
              <label for="breakFrequency">Break Frequency (hours)</label>
              <input type="number" id="breakFrequency" min="1" max="4" value="2" step="0.5">
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-title">
            <h2>Scheduling Rules</h2>
            <span class="badge">Optimization</span>
          </div>
          
          <div class="rule-group">
            <div class="rule-item">
              <input type="checkbox" id="ruleBestFit" checked>
              <div>
                <div class="rule-label">Best Fit to Requirements</div>
                <div class="rule-description">Match staff as closely as possible to forecasted requirements</div>
              </div>
            </div>
            
            <div class="rule-item active">
              <input type="checkbox" id="ruleEvenSpread" checked>
              <div>
                <div class="rule-label">Even Workload Spread</div>
                <div class="rule-description">Distribute workload evenly across staff and time periods</div>
              </div>
            </div>
            
            <div class="rule-item">
              <input type="checkbox" id="ruleMinGaps">
              <div>
                <div class="rule-label">Minimize Schedule Gaps</div>
                <div class="rule-description">Reduce idle time between shifts</div>
              </div>
            </div>
            
            <div class="rule-item">
              <input type="checkbox" id="ruleRespectPreferences">
              <div>
                <div class="rule-label">Respect Staff Preferences</div>
                <div class="rule-description">Consider staff availability and shift preferences</div>
              </div>
            </div>
            
            <div class="rule-item">
              <input type="checkbox" id="ruleAvoidOvertime">
              <div>
                <div class="rule-label">Minimize Overtime</div>
                <div class="rule-description">Avoid overtime hours when possible</div>
              </div>
            </div>
          </div>

          <div class="row-3">
            <div class="form-group">
              <label for="maxConsecutiveDays">Max Consecutive Days</label>
              <input type="number" id="maxConsecutiveDays" min="1" max="7" value="5">
            </div>

            <div class="form-group">
              <label for="minHoursBetweenShifts">Min Hours Between Shifts</label>
              <input type="number" id="minHoursBetweenShifts" min="8" max="24" value="10">
            </div>

            <div class="form-group">
              <label for="maxWeeklyHours">Max Weekly Hours</label>
              <input type="number" id="maxWeeklyHours" min="20" max="60" value="40">
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-title">
            <h2>Forecast Requirements</h2>
            <span class="badge">Demand</span>
          </div>
          
          <div class="form-group">
            <label for="forecastSource">Forecast Source</label>
            <select id="forecastSource">
              <option value="manual">Manual Input</option>
              <option value="import" selected>Import from Forecast Tool</option>
              <option value="historical">Historical Patterns</option>
            </select>
          </div>

          <div id="manualForecastSection" class="form-group" style="display: none;">
            <label>Daily Requirements</label>
            <div class="row-3">
              <input type="number" placeholder="Mon" value="15">
              <input type="number" placeholder="Tue" value="18">
              <input type="number" placeholder="Wed" value="20">
              <input type="number" placeholder="Thu" value="22">
              <input type="number" placeholder="Fri" value="25">
              <input type="number" placeholder="Sat" value="12">
              <input type="number" placeholder="Sun" value="8">
            </div>
          </div>

          <div id="importForecastSection">
            <div class="form-group">
              <label for="forecastFile">Upload Forecast CSV</label>
              <input type="file" id="forecastFile" accept=".csv">
            </div>
          </div>

          <div class="note">
            <strong>Note:</strong> Schedule will be generated based on forecast requirements and configured rules.
          </div>
        </div>

        <div class="card">
          <div class="card-title">
            <h2>Generate Schedule</h2>
            <span class="badge">Calculate</span>
          </div>
          
          <div class="btn-group">
            <button id="generateScheduleBtn" class="primary">ðŸ“… Generate Schedule</button>
            <button id="optimizeScheduleBtn" class="secondary">âš¡ Optimize Schedule</button>
            <button id="clearScheduleBtn" class="secondary">Clear Schedule</button>
          </div>

          <div class="progress-bar" id="progressBar" style="display: none;">
            <div class="progress-fill" id="progressFill" style="width: 0%;"></div>
          </div>
        </div>
      </div>
    </div>

    <div id="agentsTab" class="tab-content">
      <div class="card">
        <div class="card-title">
          <h2>Agent Management</h2>
          <span class="badge">Profiles</span>
        </div>
        
        <div class="search-filter-bar">
          <div class="search-box">
            <label for="searchInput">Search Agents</label>
            <input type="text" id="searchInput" placeholder="Search by name, department, skills...">
          </div>
          <div class="filter-select">
            <label for="departmentFilter">Department</label>
            <select id="departmentFilter">
              <option value="all">All Departments</option>
              <option value="Customer Service">Customer Service</option>
              <option value="Technical Support">Technical Support</option>
              <option value="Sales">Sales</option>
              <option value="Billing">Billing</option>
            </select>
          </div>
          <div class="filter-select">
            <label for="statusFilter">Status</label>
            <select id="statusFilter">
              <option value="all">All Status</option>
              <option value="active">Active</option>
              <option value="inactive">Inactive</option>
            </select>
          </div>
          <div style="align-self: flex-end;">
            <button id="addAgentBtn" class="primary icon-btn">
              <i class="fas fa-user-plus"></i> Add New Agent
            </button>
          </div>
        </div>

        <div class="table-container">
          <table id="agentsTable">
            <thead>
              <tr>
                <th>Name</th>
                <th>Department</th>
                <th>Skills</th>
                <th>Queues</th>
                <th>Full/Part Time</th>
                <th>Contracted Hours</th>
                <th>Start Date</th>
                <th>End Date</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="agentsTableBody">
            </tbody>
          </table>
        </div>
        
        <div class="note">
          <strong><i class="fas fa-info-circle"></i> How to use:</strong> 
          Click the edit icon <i class="fas fa-edit" style="color: #3b82f6;"></i> to modify an agent's profile. 
          Click the delete icon <i class="fas fa-trash" style="color: #ef4444;"></i> to remove an agent. 
          Use the search and filters above to find specific agents.
        </div>
      </div>
    </div>

    <div id="scheduleViewTab" class="tab-content">
      <div class="schedule-view-container">
        <div class="schedule-header">
          <h2>Schedule View</h2>
          <div class="schedule-controls">
            <div class="date-navigation">
              <button id="prevDayBtn" class="secondary">â—€ Prev</button>
              <span id="currentDateDisplay">Monday, 1 Jan 2024</span>
              <button id="nextDayBtn" class="secondary">Next â–¶</button>
            </div>
            <div class="interval-selector">
              <span style="font-size: 14px; font-weight: 600; color: var(--text-color);">View:</span>
              <div class="interval-buttons">
                <button class="interval-btn" data-interval="15">15min</button>
                <button class="interval-btn" data-interval="30">30min</button>
                <button class="interval-btn" data-interval="45">45min</button>
                <button class="interval-btn active" data-interval="60">60min</button>
              </div>
            </div>
            <div class="sort-controls">
              <span style="font-size: 14px; font-weight: 600; color: var(--text-color);">Sort by:</span>
              <select id="sortSchedule" class="sort-select">
                <option value="name">Agent Name</option>
                <option value="earliestStart">Earliest Shift Start</option>
                <option value="earliestEnd">Earliest Shift End</option>
                <option value="department">Department</option>
                <option value="totalHours">Total Scheduled Hours</option>
              </select>
            </div>
            <button id="exportScheduleBtn" class="secondary">ðŸ“¤ Export</button>
          </div>
        </div>

        <div class="net-staffing-ribbon" id="netStaffingRibbon" style="display: none;">
          <div class="ribbon-header">
            <h3>Net Staffing by Interval</h3>
            <div class="ribbon-stats">
              <div class="stat-item">
                <div class="stat-value net-balanced" id="ribbonBalanced">0</div>
                <div class="stat-label">Balanced</div>
              </div>
              <div class="stat-item">
                <div class="stat-value net-overstaffed" id="ribbonOverstaffed">0</div>
                <div class="stat-label">Overstaffed</div>
              </div>
              <div class="stat-item">
                <div class="stat-value net-understaffed" id="ribbonUnderstaffed">0</div>
                <div class="stat-label">Understaffed</div>
              </div>
              <div class="stat-item">
                <div class="stat-value net-overtime" id="ribbonOvertimeOpp">0</div>
                <div class="stat-label">Overtime Opps</div>
              </div>
            </div>
          </div>
          <div class="ribbon-visual" id="ribbonVisual">
          </div>
          <div class="ribbon-time-labels" id="ribbonTimeLabels">
          </div>
        </div>

        <div class="summary-tiles">
          <div class="tile">
            <div class="label">Scheduled Hours</div>
            <div class="value" id="resultScheduledHours">â€”</div>
            <div class="subtext">Total staff hours</div>
          </div>
          <div class="tile">
            <div class="label">Utilization</div>
            <div class="value" id="resultUtilization">â€”</div>
            <div class="subtext">Effectiveness rate</div>
          </div>
          <div class="tile">
            <div class="label">Coverage Gaps</div>
            <div class="value" id="resultCoverageGaps">â€”</div>
            <div class="subtext">Hours understaffed</div>
          </div>
          <div class="tile">
            <div class="label">Overtime Hours</div>
            <div class="value" id="resultOvertime">â€”</div>
            <div class="subtext">Additional hours</div>
          </div>
        </div>

        <div class="horizontal-schedule-container">
          <div class="schedule-grid-wrapper">
            <div class="horizontal-schedule-grid" id="horizontalScheduleGrid">
            </div>
          </div>
          
          <div class="schedule-legend">
            <div class="legend-item">
              <div class="legend-color activity-onqueue"></div>
              <span>On Queue</span>
            </div>
            <div class="legend-item">
              <div class="legend-color activity-break"></div>
              <span>Break</span>
            </div>
            <div class="legend-item">
              <div class="legend-color activity-lunch"></div>
              <span>Lunch</span>
            </div>
            <div class="legend-item">
              <div class="legend-color activity-meeting"></div>
              <span>Meeting</span>
            </div>
            <div class="legend-item">
              <div class="legend-color activity-coaching"></div>
              <span>Coaching</span>
            </div>
            <div class="legend-item">
              <div class="legend-color activity-overtime"></div>
              <span>Overtime Opp</span>
            </div>
          </div>
        </div>

        <div class="publish-controls">
          <button id="saveChangesBtn" class="secondary" style="display: none;">ðŸ’¾ Save Changes</button>
          <button id="publishScheduleBtn" class="primary">ðŸ“¤ Publish Schedule</button>
          <select id="publishOption" style="min-width: 200px; padding: 10px 14px;">
            <option value="current">Current Day Only</option>
            <option value="range" selected>Date Range</option>
            <option value="all">All Days</option>
          </select>
        </div>

        <div class="note" style="margin-top: 20px;">
          <strong>Schedule Health:</strong> Green indicates adequate coverage, yellow shows minor gaps, red indicates significant understaffing.
          <br><strong>Overtime Opportunities:</strong> Orange cells show intervals where additional staff are needed, highlighting potential overtime opportunities.
        </div>
      </div>
    </div>

    <div class="footer">
      <p>WFM Scheduling Tool v1.0 | Rule-based scheduling with optimization algorithms</p>
      <p>For support or questions, contact your WFM administrator</p>
    </div>
  </div>

  <div id="agentModal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <h2><i class="fas fa-user-edit"></i> <span id="modalTitle">Add New Agent</span></h2>
        <button class="modal-close" id="modalCloseBtn">&times;</button>
      </div>
      <div class="modal-body">
        <form id="agentForm">
          <div class="row">
            <div class="form-group">
              <label for="agentName">Full Name *</label>
              <input type="text" id="agentName" required>
            </div>
            <div class="form-group">
              <label for="agentDepartment">Department *</label>
              <select id="agentDepartment" required>
                <option value="">Select Department</option>
                <option value="Customer Service">Customer Service</option>
                <option value="Technical Support">Technical Support</option>
                <option value="Sales">Sales</option>
                <option value="Billing">Billing</option>
                <option value="Retention">Retention</option>
                <option value="Social Media">Social Media</option>
              </select>
            </div>
          </div>
          
          <div class="row">
            <div class="form-group">
              <label for="agentEmployment">Employment Type *</label>
              <select id="agentEmployment" required>
                <option value="">Select Type</option>
                <option value="Full Time">Full Time</option>
                <option value="Part Time">Part Time</option>
                <option value="Contractor">Contractor</option>
              </select>
            </div>
            <div class="form-group">
              <label for="agentHours">Contracted Hours (per week) *</label>
              <input type="number" id="agentHours" min="10" max="50" step="0.5" required>
            </div>
          </div>
          
          <div class="row">
            <div class="form-group">
              <label for="agentStartDate">Start Date *</label>
              <input type="date" id="agentStartDate" required>
            </div>
            <div class="form-group">
              <label for="agentEndDate">End Date (if applicable)</label>
              <input type="date" id="agentEndDate">
            </div>
          </div>
          
          <div class="form-group">
            <label>Skills *</label>
            <div class="multi-select-container" style="grid-template-columns: 1fr 1fr; gap: 20px; display: grid;">
              <div class="select-group">
                <h4>Technical Skills</h4>
                <div class="checkbox-group" style="max-height: 150px; overflow-y: auto;">
                  <div class="checkbox-item">
                    <input type="checkbox" id="skillChat" value="Chat Support">
                    <label for="skillChat">Chat Support</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="skillEmail" value="Email Support">
                    <label for="skillEmail">Email Support</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="skillPhone" value="Phone Support">
                    <label for="skillPhone">Phone Support</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="skillSocial" value="Social Media">
                    <label for="skillSocial">Social Media</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="skillTechnical" value="Technical Troubleshooting">
                    <label for="skillTechnical">Technical Troubleshooting</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="skillBilling" value="Billing Support">
                    <label for="skillBilling">Billing Support</label>
                  </div>
                </div>
              </div>
              
              <div class="select-group">
                <h4>Soft Skills</h4>
                <div class="checkbox-group" style="max-height: 150px; overflow-y: auto;">
                  <div class="checkbox-item">
                    <input type="checkbox" id="skillSales" value="Sales">
                    <label for="skillSales">Sales</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="skillRetention" value="Retention">
                    <label for="skillRetention">Retention</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="skillEscalation" value="Escalation Handling">
                    <label for="skillEscalation">Escalation Handling</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="skillMultilingual" value="Multilingual">
                    <label for="skillMultilingual">Multilingual</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="skillTraining" value="Training">
                    <label for="skillTraining">Training</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="skillQuality" value="Quality Assurance">
                    <label for="skillQuality">Quality Assurance</label>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="form-group">
            <label>Queues *</label>
            <div class="multi-select-container" style="grid-template-columns: 1fr 1fr; gap: 20px; display: grid;">
              <div class="select-group">
                <h4>Primary Queues</h4>
                <div class="checkbox-group" style="max-height: 150px; overflow-y: auto;">
                  <div class="checkbox-item">
                    <input type="checkbox" id="queueGeneral" value="General Inquiries">
                    <label for="queueGeneral">General Inquiries</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="queueTechnical" value="Technical Support">
                    <label for="queueTechnical">Technical Support</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="queueSales" value="Sales">
                    <label for="queueSales">Sales</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="queueBilling" value="Billing">
                    <label for="queueBilling">Billing</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="queueRetention" value="Retention">
                    <label for="queueRetention">Retention</label>
                  </div>
                </div>
              </div>
              
              <div class="select-group">
                <h4>Specialty Queues</h4>
                <div class="checkbox-group" style="max-height: 150px; overflow-y: auto;">
                  <div class="checkbox-item">
                    <input type="checkbox" id="queueEscalation" value="Escalations">
                    <label for="queueEscalation">Escalations</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="queueSocial" value="Social Media">
                    <label for="queueSocial">Social Media</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="queueVIP" value="VIP Support">
                    <label for="queueVIP">VIP Support</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="queueBackoffice" value="Back Office">
                    <label for="queueBackoffice">Back Office</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="queueChat" value="Chat Only">
                    <label for="queueChat">Chat Only</label>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="btn-group">
            <button type="submit" class="primary icon-btn">
              <i class="fas fa-save"></i> Save Agent
            </button>
            <button type="button" class="secondary" id="cancelModalBtn">
              Cancel
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <script>
    const scheduleStatus = document.getElementById('scheduleStatus');
    const generateScheduleBtn = document.getElementById('generateScheduleBtn');
    const progressBar = document.getElementById('progressBar');
    const progressFill = document.getElementById('progressFill');
    const businessHoursSelect = document.getElementById('businessHours');
    const customHoursSection = document.getElementById('customHoursSection');
    const forecastSourceSelect = document.getElementById('forecastSource');
    const manualForecastSection = document.getElementById('manualForecastSection');
    const importForecastSection = document.getElementById('importForecastSection');
    const prevDayBtn = document.getElementById('prevDayBtn');
    const nextDayBtn = document.getElementById('nextDayBtn');
    const currentDateDisplay = document.getElementById('currentDateDisplay');
    const sortScheduleSelect = document.getElementById('sortSchedule');
    const manageStaffBtn = document.getElementById('manageStaffBtn');
    const saveChangesBtn = document.getElementById('saveChangesBtn');
    const publishScheduleBtn = document.getElementById('publishScheduleBtn');
    const netStaffingRibbon = document.getElementById('netStaffingRibbon');
    const ribbonVisual = document.getElementById('ribbonVisual');
    const ribbonTimeLabels = document.getElementById('ribbonTimeLabels');
    const horizontalScheduleGrid = document.getElementById('horizontalScheduleGrid');
    const intervalButtons = document.querySelectorAll('.interval-btn');

    const tabs = document.querySelectorAll('.tab');
    const tabContents = document.querySelectorAll('.tab-content');

    const searchInput = document.getElementById('searchInput');
    const departmentFilter = document.getElementById('departmentFilter');
    const statusFilter = document.getElementById('statusFilter');
    const addAgentBtn = document.getElementById('addAgentBtn');
    const agentsTableBody = document.getElementById('agentsTableBody');
    const agentModal = document.getElementById('agentModal');
    const modalCloseBtn = document.getElementById('modalCloseBtn');
    const cancelModalBtn = document.getElementById('cancelModalBtn');
    const modalTitle = document.getElementById('modalTitle');
    const agentForm = document.getElementById('agentForm');
    const totalAgentsCount = document.getElementById('totalAgentsCount');
    const fullTimeCount = document.getElementById('fullTimeCount');
    const partTimeCount = document.getElementById('partTimeCount');
    const activeCount = document.getElementById('activeCount');

    let agents = [];
    let currentEditId = null;

    let scheduleData = {
      requirements: [],
      staff: [],
      assignments: [],
      generatedSchedule: null,
      currentDay: 0,
      totalDays: 1,
      optimizationResults: null,
      agentSchedules: [],
      netStaffing: [],
      overtimeOpportunities: [],
      intervalLength: 60,
      modified: false,
      horizontalSchedule: []
    };

    const activityTypes = [
      { id: "onqueue", name: "On Queue", color: "activity-onqueue" },
      { id: "break", name: "Break", color: "activity-break" },
      { id: "lunch", name: "Lunch", color: "activity-lunch" },
      { id: "meeting", name: "Meeting", color: "activity-meeting" },
      { id: "coaching", name: "Coaching", color: "activity-coaching" },
      { id: "overtime", name: "Overtime", color: "activity-overtime" }
    ];

    function initializeAgents() {
      const today = new Date();
      const oneYearAgo = new Date();
      oneYearAgo.setFullYear(today.getFullYear() - 1);
      
      const sixMonthsFromNow = new Date();
      sixMonthsFromNow.setMonth(today.getMonth() + 6);
      
      agents = [
        {
          id: 1,
          name: 'John Thompson',
          department: 'Customer Service',
          skills: ['Phone Support', 'Email Support', 'Chat Support', 'Multilingual'],
          queues: ['General Inquiries', 'Technical Support', 'Escalations'],
          employmentType: 'Full Time',
          contractedHours: 40,
          startDate: formatDate(oneYearAgo),
          endDate: '',
          status: 'active'
        },
        {
          id: 2,
          name: 'Sasha Smith',
          department: 'Technical Support',
          skills: ['Technical Troubleshooting', 'Chat Support', 'Email Support', 'Escalation Handling'],
          queues: ['Technical Support', 'Escalations', 'VIP Support'],
          employmentType: 'Full Time',
          contractedHours: 40,
          startDate: formatDate(new Date(oneYearAgo.getFullYear(), oneYearAgo.getMonth() - 3, 15)),
          endDate: '',
          status: 'active'
        },
        {
          id: 3,
          name: 'Liam Cooper',
          department: 'Sales',
          skills: ['Sales', 'Phone Support', 'Retention', 'Chat Support'],
          queues: ['Sales', 'Retention', 'VIP Support'],
          employmentType: 'Full Time',
          contractedHours: 37.5,
          startDate: formatDate(new Date(oneYearAgo.getFullYear(), oneYearAgo.getMonth() - 8, 1)),
          endDate: '',
          status: 'active'
        },
        {
          id: 4,
          name: 'Ethan Reynolds',
          department: 'Billing',
          skills: ['Billing Support', 'Email Support', 'Phone Support', 'Technical Troubleshooting'],
          queues: ['Billing', 'Technical Support', 'General Inquiries'],
          employmentType: 'Part Time',
          contractedHours: 25,
          startDate: formatDate(new Date(oneYearAgo.getFullYear(), oneYearAgo.getMonth() - 5, 20)),
          endDate: formatDate(sixMonthsFromNow),
          status: 'active'
        },
        {
          id: 5,
          name: 'Ava Mitchell',
          department: 'Social Media',
          skills: ['Social Media', 'Chat Support', 'Email Support', 'Multilingual'],
          queues: ['Social Media', 'Chat Only', 'General Inquiries'],
          employmentType: 'Full Time',
          contractedHours: 40,
          startDate: formatDate(new Date(today.getFullYear(), today.getMonth() - 2, 10)),
          endDate: '',
          status: 'active'
        }
      ];
      
      updateAgentDisplay();
      updateSummaryCards();
      updateStatus('Agent profiles loaded successfully');
    }

    function formatDate(date) {
      if (!date) return '';
      return date.toISOString().split('T')[0];
    }

    function formatDisplayDate(dateString) {
      if (!dateString) return 'â€”';
      const date = new Date(dateString);
      return date.toLocaleDateString('en-GB');
    }

    function updateAgentDisplay() {
      const searchTerm = searchInput.value.toLowerCase();
      const department = departmentFilter.value;
      const status = statusFilter.value;
      
      let filteredAgents = agents.filter(agent => {
        const matchesSearch = 
          agent.name.toLowerCase().includes(searchTerm) ||
          agent.department.toLowerCase().includes(searchTerm) ||
          agent.skills.some(skill => skill.toLowerCase().includes(searchTerm)) ||
          agent.queues.some(queue => queue.toLowerCase().includes(searchTerm));
        
        const matchesDepartment = department === 'all' || agent.department === department;
        const matchesStatus = status === 'all' || agent.status === status;
        
        return matchesSearch && matchesDepartment && matchesStatus;
      });
      
      agentsTableBody.innerHTML = '';
      
      filteredAgents.forEach(agent => {
        const row = document.createElement('tr');
        const isActive = agent.status === 'active' && (!agent.endDate || new Date(agent.endDate) > new Date());
        const statusText = isActive ? 'Active' : 'Inactive';
        const statusClass = isActive ? 'status-active' : 'status-inactive';
        
        row.innerHTML = `
          <td><strong>${agent.name}</strong></td>
          <td>${agent.department}</td>
          <td>
            <div class="badge-list">
              ${agent.skills.map(skill => `<span class="badge-item">${skill}</span>`).join('')}
            </div>
          </td>
          <td>
            <div class="badge-list">
              ${agent.queues.map(queue => `<span class="badge-item">${queue}</span>`).join('')}
            </div>
          </td>
          <td>${agent.employmentType}</td>
          <td class="right">${agent.contractedHours.toFixed(1)}</td>
          <td>${formatDisplayDate(agent.startDate)}</td>
          <td>${formatDisplayDate(agent.endDate)}</td>
          <td class="${statusClass}">${statusText}</td>
          <td class="center">
            <button class="action-btn edit" data-id="${agent.id}" title="Edit agent" style="background: none; border: none; cursor: pointer; padding: 4px 8px; border-radius: 4px; color: var(--text-light);">
              <i class="fas fa-edit"></i>
            </button>
            <button class="action-btn delete" data-id="${agent.id}" title="Delete agent" style="background: none; border: none; cursor: pointer; padding: 4px 8px; border-radius: 4px; color: var(--text-light);">
              <i class="fas fa-trash"></i>
            </button>
          </td>
        `;
        agentsTableBody.appendChild(row);
      });
    }

    function updateSummaryCards() {
      totalAgentsCount.textContent = agents.length;
      fullTimeCount.textContent = agents.filter(a => a.employmentType === 'Full Time').length;
      partTimeCount.textContent = agents.filter(a => a.employmentType === 'Part Time' || a.employmentType === 'Contractor').length;
      activeCount.textContent = agents.filter(a => a.status === 'active' && (!a.endDate || new Date(a.endDate) > new Date())).length;
    }

    function showAgentModal(agentId = null) {
      currentEditId = agentId;
      
      if (agentId) {
        modalTitle.textContent = 'Edit Agent Profile';
        const agent = agents.find(a => a.id === agentId);
        
        if (agent) {
          document.getElementById('agentName').value = agent.name;
          document.getElementById('agentDepartment').value = agent.department;
          document.getElementById('agentEmployment').value = agent.employmentType;
          document.getElementById('agentHours').value = agent.contractedHours;
          document.getElementById('agentStartDate').value = agent.startDate;
          document.getElementById('agentEndDate').value = agent.endDate;
          
          document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
            if (checkbox.value) {
              if (agent.skills.includes(checkbox.value) || agent.queues.includes(checkbox.value)) {
                checkbox.checked = true;
              } else {
                checkbox.checked = false;
              }
            }
          });
        }
      } else {
        modalTitle.textContent = 'Add New Agent';
        agentForm.reset();
        document.getElementById('agentStartDate').value = formatDate(new Date());
      }
      
      agentModal.style.display = 'flex';
    }

    function hideAgentModal() {
      agentModal.style.display = 'none';
      currentEditId = null;
    }

    function saveAgent(event) {
      event.preventDefault();
      
      const name = document.getElementById('agentName').value.trim();
      const department = document.getElementById('agentDepartment').value;
      const employmentType = document.getElementById('agentEmployment').value;
      const contractedHours = parseFloat(document.getElementById('agentHours').value);
      const startDate = document.getElementById('agentStartDate').value;
      const endDate = document.getElementById('agentEndDate').value;
      
      const selectedSkills = [];
      document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
        if (checkbox.checked && checkbox.value) {
          const skillCheckboxes = [
            'skillChat', 'skillEmail', 'skillPhone', 'skillSocial',
            'skillTechnical', 'skillBilling', 'skillSales', 'skillRetention',
            'skillEscalation', 'skillMultilingual', 'skillTraining', 'skillQuality'
          ];
          if (skillCheckboxes.includes(checkbox.id)) {
            selectedSkills.push(checkbox.value);
          }
        }
      });
      
      const selectedQueues = [];
      document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
        if (checkbox.checked && checkbox.value) {
          const queueCheckboxes = [
            'queueGeneral', 'queueTechnical', 'queueSales', 'queueBilling',
            'queueRetention', 'queueEscalation', 'queueSocial', 'queueVIP',
            'queueBackoffice', 'queueChat'
          ];
          if (queueCheckboxes.includes(checkbox.id)) {
            selectedQueues.push(checkbox.value);
          }
        }
      });
      
      if (!name || !department || !employmentType || !contractedHours || !startDate) {
        updateStatus('Please fill in all required fields', true);
        return;
      }
      
      if (selectedSkills.length === 0 || selectedQueues.length === 0) {
        updateStatus('Please select at least one skill and one queue', true);
        return;
      }
      
      if (currentEditId) {
        const agentIndex = agents.findIndex(a => a.id === currentEditId);
        if (agentIndex !== -1) {
          agents[agentIndex] = {
            ...agents[agentIndex],
            name,
            department,
            skills: selectedSkills,
            queues: selectedQueues,
            employmentType,
            contractedHours,
            startDate,
            endDate
          };
          updateStatus(`Agent "${name}" updated successfully`);
        }
      } else {
        const newId = agents.length > 0 ? Math.max(...agents.map(a => a.id)) + 1 : 1;
        const newAgent = {
          id: newId,
          name,
          department,
          skills: selectedSkills,
          queues: selectedQueues,
          employmentType,
          contractedHours,
          startDate,
          endDate,
          status: 'active'
        };
        agents.push(newAgent);
        updateStatus(`Agent "${name}" added successfully`);
      }
      
      updateAgentDisplay();
      updateSummaryCards();
      hideAgentModal();
    }

    function deleteAgent(agentId) {
      if (confirm('Are you sure you want to delete this agent?')) {
        const agentIndex = agents.findIndex(a => a.id === agentId);
        if (agentIndex !== -1) {
          const agentName = agents[agentIndex].name;
          agents.splice(agentIndex, 1);
          updateAgentDisplay();
          updateSummaryCards();
          updateStatus(`Agent "${agentName}" deleted successfully`);
        }
      }
    }

    function initializeDatePicker() {
      const today = new Date();
      const nextMonday = new Date(today);
      const daysUntilMonday = (1 - today.getDay() + 7) % 7;
      nextMonday.setDate(today.getDate() + daysUntilMonday);
      
      document.getElementById('startDate').value = formatDate(nextMonday);
    }

    tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        const tabId = tab.dataset.tab;
        
        tabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        
        tabContents.forEach(content => {
          content.classList.remove('active');
          if (content.id === `${tabId}Tab`) {
            content.classList.add('active');
          }
        });
        
        if (tabId === 'scheduleView' && scheduleData.generatedSchedule) {
          generateHorizontalSchedule();
          updateNetStaffingRibbon();
          updateDateDisplay();
        }
      });
    });

    class SchedulingEngine {
      constructor() {
        this.rules = {};
        this.staffPool = [];
        this.requirements = [];
        this.schedule = null;
      }

      generateSchedule(requirements, staffPool, rules) {
        this.requirements = requirements;
        this.staffPool = staffPool;
        this.rules = rules;
        
        this.schedule = this.createInitialSchedule();
        const agentSchedules = this.generateAgentSchedules(staffPool, this.schedule);
        
        if (rules.bestFit) {
          this.applyBestFit(this.schedule, agentSchedules);
        }
        
        if (rules.evenSpread) {
          this.applyEvenSpread(this.schedule, agentSchedules);
        }
        
        if (rules.respectPreferences) {
          this.applyStaffPreferences(agentSchedules);
        }
        
        if (rules.avoidOvertime) {
          this.minimizeOvertime(agentSchedules);
        }
        
        this.applyConstraints(agentSchedules);
        
        this.schedule.agentSchedules = agentSchedules;
        this.schedule.metrics = this.calculateMetrics(this.schedule, agentSchedules);
        this.schedule.netStaffing = this.calculateNetStaffing(this.schedule, requirements);
        this.schedule.overtimeOpportunities = this.identifyOvertimeOpportunities(this.schedule, requirements);
        
        this.schedule.horizontalSchedule = this.generateHorizontalScheduleData(agentSchedules, requirements);
        
        return this.schedule;
      }

      createInitialSchedule() {
        const schedule = {
          days: [],
          assignments: [],
          metrics: {
            totalHours: 0,
            utilization: 0,
            coverageGaps: 0,
            overtime: 0,
            satisfaction: 0
          }
        };

        const period = parseInt(document.getElementById('schedulePeriod').value);
        for (let i = 0; i < period; i++) {
          schedule.days.push({
            date: new Date(),
            assignments: []
          });
        }

        return schedule;
      }

      generateAgentSchedules(staffPool, schedule) {
        const agentSchedules = [];
        const lunchDuration = parseInt(document.getElementById('lunchDuration').value) / 60;
        const breakFrequency = parseFloat(document.getElementById('breakFrequency').value);
        
        staffPool.forEach(agent => {
          const agentSchedule = {
            agentId: agent.id,
            agentName: agent.name,
            department: agent.department,
            schedule: [],
            totalHours: 0,
            daysWorking: 0,
            earliestStart: 24,
            earliestEnd: 0,
            overtimeHours: 0
          };
          
          const period = parseInt(document.getElementById('schedulePeriod').value);
          const shiftPattern = document.getElementById('shiftPattern').value;
          const isFullTime = agent.employmentType === 'Full Time';
          
          let shiftHours = 8;
          let daysPerWeek = 5;
          
          if (shiftPattern === '9x5') {
            shiftHours = 9;
            daysPerWeek = 5;
          } else if (shiftPattern === '10x4') {
            shiftHours = 10;
            daysPerWeek = 4;
          } else if (shiftPattern === '12x3') {
            shiftHours = 12;
            daysPerWeek = 3;
          }
          
          if (!isFullTime) {
            shiftHours = Math.min(shiftHours, 6);
            daysPerWeek = Math.min(daysPerWeek, 4);
          }
          
          for (let day = 0; day < period; day++) {
            const daySchedule = {
              dayIndex: day,
              activities: [],
              working: false,
              startTime: null,
              endTime: null
            };
            
            const dayOfWeek = day % 7;
            const shouldWork = day % Math.ceil(7 / daysPerWeek) < daysPerWeek;
            
            if (shouldWork) {
              daySchedule.working = true;
              agentSchedule.daysWorking++;
              
              const startHour = 8 + Math.random() * 2;
              const endHour = startHour + shiftHours;
              
              agentSchedule.earliestStart = Math.min(agentSchedule.earliestStart, startHour);
              agentSchedule.earliestEnd = Math.max(agentSchedule.earliestEnd, endHour);
              
              daySchedule.startTime = startHour;
              daySchedule.endTime = endHour;
              
              let currentHour = startHour;
              let hoursSinceBreak = 0;
              
              while (currentHour < endHour) {
                if (hoursSinceBreak >= breakFrequency && currentHour < endHour - lunchDuration) {
                  daySchedule.activities.push({
                    start: currentHour,
                    end: currentHour + 0.25,
                    type: 'break',
                    activity: 'Break'
                  });
                  currentHour += 0.25;
                  hoursSinceBreak = 0;
                } else if (currentHour >= startHour + shiftHours/2 - lunchDuration/2 && 
                          currentHour < startHour + shiftHours/2 + lunchDuration/2) {
                  daySchedule.activities.push({
                    start: currentHour,
                    end: currentHour + lunchDuration,
                    type: 'lunch',
                    activity: 'Lunch'
                  });
                  currentHour += lunchDuration;
                  hoursSinceBreak = 0;
                } else {
                  const activityDuration = Math.min(1, endHour - currentHour);
                  daySchedule.activities.push({
                    start: currentHour,
                    end: currentHour + activityDuration,
                    type: 'inbound',
                    activity: 'Inbound'
                  });
                  currentHour += activityDuration;
                  hoursSinceBreak += activityDuration;
                  agentSchedule.totalHours += activityDuration;
                }
              }
            }
            
            agentSchedule.schedule.push(daySchedule);
          }
          
          agentSchedules.push(agentSchedule);
        });
        
        return agentSchedules;
      }

      applyBestFit(schedule, agentSchedules) {
        schedule.days.forEach((day, dayIndex) => {
          const dayRequirements = this.requirements[dayIndex] || [];
          
          dayRequirements.forEach((requirement, hourIndex) => {
            const required = requirement;
            const availableAgents = this.getAvailableAgentsAtHour(agentSchedules, dayIndex, hourIndex);
            const assigned = Math.min(availableAgents.length, required);
            
            if (!day.assignments[hourIndex]) {
              day.assignments[hourIndex] = [];
            }
            
            for (let i = 0; i < assigned; i++) {
              day.assignments[hourIndex].push(availableAgents[i].agentId);
            }
            
            if (assigned < required) {
              schedule.metrics.coverageGaps += (required - assigned);
            }
            
            schedule.metrics.totalHours += assigned;
          });
        });
      }

      applyEvenSpread(schedule, agentSchedules) {
        const agentWorkload = {};
        agentSchedules.forEach(agent => {
          agentWorkload[agent.agentId] = agent.totalHours;
        });
        
        schedule.days.forEach((day, dayIndex) => {
          day.assignments.forEach((hourAssignments, hourIndex) => {
            if (hourAssignments && hourAssignments.length > 0) {
              let minWorkload = Infinity;
              let bestAgent = null;
              
              hourAssignments.forEach(agentId => {
                if (agentWorkload[agentId] < minWorkload) {
                  minWorkload = agentWorkload[agentId];
                  bestAgent = agentId;
                }
              });
              
              if (bestAgent) {
                hourAssignments.forEach((agentId, idx) => {
                  if (agentId !== bestAgent) {
                    hourAssignments[idx] = bestAgent;
                    agentWorkload[bestAgent]++;
                    agentWorkload[agentId]--;
                  }
                });
              }
            }
          });
        });
      }

      applyStaffPreferences(agentSchedules) {
        agentSchedules.forEach(agentSchedule => {
          const agent = this.staffPool.find(a => a.id === agentSchedule.agentId);
          if (agent && agentSchedule.totalHours > agent.contractedHours * (parseInt(document.getElementById('schedulePeriod').value) / 7)) {
            this.reduceAgentHours(agentSchedule, agent.contractedHours);
          }
        });
      }

      minimizeOvertime(agentSchedules) {
        const maxWeeklyHours = parseInt(document.getElementById('maxWeeklyHours').value);
        const periodWeeks = parseInt(document.getElementById('schedulePeriod').value) / 7;
        
        agentSchedules.forEach(agentSchedule => {
          const weeklyHours = agentSchedule.totalHours / periodWeeks;
          if (weeklyHours > maxWeeklyHours) {
            const excess = weeklyHours - maxWeeklyHours;
            agentSchedule.overtimeHours = excess * periodWeeks;
            this.reduceAgentHours(agentSchedule, maxWeeklyHours * periodWeeks);
          }
        });
      }

      applyConstraints(agentSchedules) {
        const maxConsecutiveDays = parseInt(document.getElementById('maxConsecutiveDays').value);
        
        agentSchedules.forEach(agentSchedule => {
          let consecutiveDays = 0;
          let maxConsecutive = 0;
          
          agentSchedule.schedule.forEach(day => {
            if (day.working) {
              consecutiveDays++;
              maxConsecutive = Math.max(maxConsecutive, consecutiveDays);
            } else {
              consecutiveDays = 0;
            }
          });
          
          if (maxConsecutive > maxConsecutiveDays) {
            this.adjustForConsecutiveDays(agentSchedule, maxConsecutiveDays);
          }
        });
      }

      calculateNetStaffing(schedule, requirements) {
        const netStaffing = [];
        const period = parseInt(document.getElementById('schedulePeriod').value);
        
        for (let day = 0; day < period; day++) {
          const dayNetStaffing = [];
          const dayRequirements = requirements[day] || [];
          const dayAssignments = schedule.days[day]?.assignments || [];
          
          for (let interval = 0; interval < dayRequirements.length; interval++) {
            const required = Math.round(dayRequirements[interval] || 0);
            const assigned = dayAssignments[interval]?.length || 0;
            const net = assigned - required;
            
            dayNetStaffing.push({
              interval,
              required,
              assigned,
              net,
              status: net === 0 ? 'balanced' : net > 0 ? 'overstaffed' : 'understaffed'
            });
          }
          
          netStaffing.push(dayNetStaffing);
        }
        
        return netStaffing;
      }

      identifyOvertimeOpportunities(schedule, requirements) {
        const opportunities = [];
        const period = parseInt(document.getElementById('schedulePeriod').value);
        
        for (let day = 0; day < period; day++) {
          const dayRequirements = requirements[day] || [];
          const dayAssignments = schedule.days[day]?.assignments || [];
          
          for (let interval = 0; interval < dayRequirements.length; interval++) {
            const required = Math.round(dayRequirements[interval] || 0);
            const assigned = dayAssignments[interval]?.length || 0;
            const shortfall = required - assigned;
            
            if (shortfall > 0) {
              const intervalMinutes = scheduleData.intervalLength;
              const totalMinutes = interval * intervalMinutes;
              const hours = Math.floor(totalMinutes / 60);
              const minutes = totalMinutes % 60;
              const timeString = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
              
              opportunities.push({
                day,
                interval,
                time: timeString,
                required,
                assigned,
                shortfall,
                potentialOvertime: shortfall
              });
            }
          }
        }
        
        return opportunities;
      }

      generateHorizontalScheduleData(agentSchedules, requirements) {
        const horizontalSchedule = [];
        const period = parseInt(document.getElementById('schedulePeriod').value);
        
        for (let day = 0; day < period; day++) {
          const daySchedule = {
            dayIndex: day,
            agents: [],
            requirements: requirements[day] || [],
            overtimeOpportunities: []
          };
          
          agentSchedules.forEach(agentSchedule => {
            const dayAgentSchedule = agentSchedule.schedule[day];
            const agentActivities = [];
            
            if (dayAgentSchedule && dayAgentSchedule.working) {
              dayAgentSchedule.activities.forEach(activity => {
                const startInterval = Math.floor(activity.start * (60 / scheduleData.intervalLength));
                const durationInIntervals = Math.ceil((activity.end - activity.start) * (60 / scheduleData.intervalLength));
                
                for (let i = 0; i < durationInIntervals; i++) {
                  const intervalIndex = startInterval + i;
                  if (intervalIndex < 24 * (60 / scheduleData.intervalLength)) {
                    agentActivities[intervalIndex] = activity.type === 'inbound' ? 'onqueue' : activity.type;
                  }
                }
              });
            }
            
            daySchedule.agents.push({
              agentId: agentSchedule.agentId,
              agentName: agentSchedule.agentName,
              department: agentSchedule.department,
              activities: agentActivities,
              earliestStart: agentSchedule.earliestStart,
              earliestEnd: agentSchedule.earliestEnd,
              totalHours: agentSchedule.totalHours
            });
          });
          
          const dayRequirements = requirements[day] || [];
          const dayAssignments = this.schedule.days[day]?.assignments || [];
          
          for (let interval = 0; interval < dayRequirements.length; interval++) {
            const required = Math.round(dayRequirements[interval] || 0);
            const assigned = dayAssignments[interval]?.length || 0;
            
            if (required > 0 && assigned < required) {
              daySchedule.overtimeOpportunities.push({
                interval,
                required,
                assigned,
                shortfall: required - assigned
              });
            }
          }
          
          horizontalSchedule.push(daySchedule);
        }
        
        return horizontalSchedule;
      }

      getAvailableAgentsAtHour(agentSchedules, dayIndex, hourIndex) {
        return agentSchedules
          .filter(agentSchedule => {
            const daySchedule = agentSchedule.schedule[dayIndex];
            if (!daySchedule || !daySchedule.working) return false;
            
            return daySchedule.activities.some(activity => 
              activity.start <= hourIndex && activity.end > hourIndex && activity.type === 'inbound'
            );
          })
          .sort((a, b) => a.totalHours - b.totalHours);
      }

      reduceAgentHours(agentSchedule, targetHours) {
        let currentHours = agentSchedule.totalHours;
        
        for (let day = agentSchedule.schedule.length - 1; day >= 0 && currentHours > targetHours; day--) {
          const daySchedule = agentSchedule.schedule[day];
          if (daySchedule.working) {
            for (let i = daySchedule.activities.length - 1; i >= 0; i--) {
              if (daySchedule.activities[i].type === 'inbound') {
                const duration = daySchedule.activities[i].end - daySchedule.activities[i].start;
                daySchedule.activities.splice(i, 1);
                currentHours -= duration;
                agentSchedule.totalHours -= duration;
                break;
              }
            }
          }
        }
      }

      adjustForConsecutiveDays(agentSchedule, maxDays) {
        let consecutiveDays = 0;
        
        for (let i = 0; i < agentSchedule.schedule.length; i++) {
          if (agentSchedule.schedule[i].working) {
            consecutiveDays++;
            if (consecutiveDays > maxDays) {
              agentSchedule.schedule[i].working = false;
              agentSchedule.schedule[i].activities = [];
              agentSchedule.daysWorking--;
              
              const dayHours = agentSchedule.schedule[i].activities.reduce((sum, act) => 
                sum + (act.end - act.start), 0
              );
              agentSchedule.totalHours -= dayHours;
              
              consecutiveDays = 0;
            }
          } else {
            consecutiveDays = 0;
          }
        }
      }

      calculateMetrics(schedule, agentSchedules) {
        const totalPossibleHours = this.requirements.reduce((sum, day) => 
          sum + day.reduce((daySum, hour) => daySum + hour, 0), 0
        );
        
        const utilization = schedule.metrics.totalHours > 0 ? 
          (schedule.metrics.totalHours / totalPossibleHours) * 100 : 0;
        
        const totalOvertime = agentSchedules.reduce((sum, agent) => sum + (agent.overtimeHours || 0), 0);
        
        return {
          totalHours: Math.round(schedule.metrics.totalHours),
          utilization: Math.min(100, Math.round(utilization)),
          coverageGaps: Math.round(schedule.metrics.coverageGaps),
          overtime: Math.round(totalOvertime),
          satisfaction: Math.round(schedule.metrics.satisfaction)
        };
      }
    }

    const schedulingEngine = new SchedulingEngine();

    async function generateRequirements(config) {
      const forecastSource = document.getElementById('forecastSource').value;
      const requirements = [];
      const period = config.period;
      
      if (forecastSource === 'manual') {
        const dailyInputs = document.querySelectorAll('#manualForecastSection input');
        const dailyRequirements = Array.from(dailyInputs).map(input => parseInt(input.value) || 0);
        
        for (let day = 0; day < period; day++) {
          const dayRequirements = [];
          const dayIndex = day % 7;
          const baseRequirement = dailyRequirements[dayIndex];
          
          const businessHours = config.businessHours.end - config.businessHours.start;
          const peakHour = Math.floor(businessHours / 2);
          
          const intervalsPerHour = 60 / config.intervalLength;
          const totalIntervals = 24 * intervalsPerHour;
          
          for (let interval = 0; interval < totalIntervals; interval++) {
            const hour = Math.floor(interval / intervalsPerHour);
            if (hour >= config.businessHours.start && hour < config.businessHours.end) {
              const hourOffset = hour - config.businessHours.start;
              const distanceFromPeak = Math.abs(hourOffset - peakHour);
              const reduction = distanceFromPeak / businessHours;
              const requirement = Math.max(1, Math.round(baseRequirement * (1 - reduction * 0.5)));
              
              dayRequirements.push(requirement / intervalsPerHour);
            } else {
              dayRequirements.push(0);
            }
          }
          
          requirements.push(dayRequirements);
        }
      } else if (forecastSource === 'import') {
        const fileInput = document.getElementById('forecastFile');
        if (fileInput.files && fileInput.files[0]) {
          const file = fileInput.files[0];
          const text = await file.text();
          return parseForecastCSV(text, config);
        } else {
          return generateRequirements({ ...config, forecastSource: 'manual' });
        }
      } else {
        return generateRequirements({ ...config, forecastSource: 'manual' });
      }
      
      return requirements;
    }

    function parseForecastCSV(text, config) {
      const lines = text.split(/\r?\n/).filter(line => line.trim());
      if (lines.length === 0) return [];
      
      const headers = lines[0].split(',').map(h => h.trim().toLowerCase());
      const requirements = [];
      
      const dateMap = new Map();
      
      for (let i = 1; i < lines.length; i++) {
        const values = lines[i].split(',');
        const row = {};
        headers.forEach((header, index) => {
          row[header] = values[index] ? values[index].trim() : '';
        });
        
        if (row.date && row.time && row.required_staff) {
          const dateKey = row.date;
          const intervalsPerHour = 60 / config.intervalLength;
          const totalIntervals = 24 * intervalsPerHour;
          
          if (!dateMap.has(dateKey)) {
            dateMap.set(dateKey, Array(totalIntervals).fill(0));
          }
          
          const timeParts = row.time.split(':');
          const hour = parseInt(timeParts[0]);
          const minute = timeParts[1] ? parseInt(timeParts[1]) : 0;
          const intervalIndex = hour * intervalsPerHour + Math.floor(minute / config.intervalLength);
          
          if (intervalIndex < dateMap.get(dateKey).length) {
            const currentValue = dateMap.get(dateKey)[intervalIndex] || 0;
            const newValue = parseFloat(row.required_staff) || 0;
            dateMap.get(dateKey)[intervalIndex] = currentValue + newValue;
          }
        }
      }
      
      const period = parseInt(document.getElementById('schedulePeriod').value);
      const sortedDates = Array.from(dateMap.keys()).sort();
      
      for (let i = 0; i < Math.min(period, sortedDates.length); i++) {
        const dateKey = sortedDates[i];
        requirements.push(dateMap.get(dateKey));
      }
      
      while (requirements.length < period) {
        const lastDay = requirements[requirements.length - 1] || Array(24 * (60 / config.intervalLength)).fill(0);
        requirements.push([...lastDay]);
      }
      
      return requirements;
    }

    function collectRules() {
      return {
        bestFit: document.getElementById('ruleBestFit').checked,
        evenSpread: document.getElementById('ruleEvenSpread').checked,
        minGaps: document.getElementById('ruleMinGaps').checked,
        respectPreferences: document.getElementById('ruleRespectPreferences').checked,
        avoidOvertime: document.getElementById('ruleAvoidOvertime').checked
      };
    }

    async function generateSchedule() {
      const activeAgents = agents.filter(agent => 
        agent.status === 'active' && (!agent.endDate || new Date(agent.endDate) > new Date())
      );
      
      if (activeAgents.length === 0) {
        alert('No active agents found. Please add agents in the Agent Management tab.');
        return;
      }

      progressBar.style.display = 'block';
      updateProgress(10);
      updateStatus('Generating schedule...');

      try {
        const config = collectConfiguration();
        const staffPool = activeAgents.map(agent => ({
          id: agent.id,
          name: agent.name,
          department: agent.department,
          skills: agent.skills,
          queues: agent.queues,
          employmentType: agent.employmentType,
          contractedHours: agent.contractedHours,
          startDate: agent.startDate,
          endDate: agent.endDate,
          status: agent.status
        }));
        
        scheduleData.staff = staffPool;
        
        const requirements = await generateRequirements(config);
        scheduleData.requirements = requirements;
        
        updateProgress(40);
        
        const rules = collectRules();
        const schedule = schedulingEngine.generateSchedule(requirements, staffPool, rules);
        scheduleData.generatedSchedule = schedule;
        scheduleData.agentSchedules = schedule.agentSchedules;
        scheduleData.netStaffing = schedule.netStaffing;
        scheduleData.overtimeOpportunities = schedule.overtimeOpportunities;
        scheduleData.totalDays = schedule.days.length;
        scheduleData.currentDay = 0;
        scheduleData.modified = false;
        scheduleData.horizontalSchedule = schedule.horizontalSchedule;
        scheduleData.intervalLength = config.intervalLength;
        
        updateProgress(70);
        
        displayScheduleResults(schedule, schedule.metrics);
        generateHorizontalSchedule();
        updateNetStaffingRibbon();
        updateDateDisplay();
        
        updateProgress(100);
        
        setTimeout(() => {
          progressBar.style.display = 'none';
          progressFill.style.width = '0%';
        }, 1000);
        
        updateStatus('Schedule generated successfully');
        document.querySelector('[data-tab="scheduleView"]').click();
        saveChangesBtn.style.display = 'block';
        
      } catch (error) {
        console.error('Schedule generation error:', error);
        updateStatus('Error generating schedule: ' + error.message, true);
        progressBar.style.display = 'none';
      }
    }

    function generateHorizontalSchedule() {
      if (!scheduleData.horizontalSchedule || scheduleData.horizontalSchedule.length === 0) {
        horizontalScheduleGrid.innerHTML = '<div class="note" style="margin: 20px; text-align: center;">No schedule generated yet. Click "Generate Schedule" to create a schedule.</div>';
        return;
      }

      horizontalScheduleGrid.innerHTML = '';
      
      const daySchedule = scheduleData.horizontalSchedule[scheduleData.currentDay];
      if (!daySchedule) return;
      
      let sortedAgents = [...daySchedule.agents];
      const sortBy = sortScheduleSelect.value;
      
      switch(sortBy) {
        case 'name':
          sortedAgents.sort((a, b) => a.agentName.localeCompare(b.agentName));
          break;
        case 'department':
          sortedAgents.sort((a, b) => a.department.localeCompare(b.department));
          break;
        case 'earliestStart':
          sortedAgents.sort((a, b) => a.earliestStart - b.earliestStart);
          break;
        case 'earliestEnd':
          sortedAgents.sort((a, b) => a.earliestEnd - b.earliestEnd);
          break;
        case 'totalHours':
          sortedAgents.sort((a, b) => b.totalHours - a.totalHours);
          break;
      }
      
      const intervalsPerHour = 60 / scheduleData.intervalLength;
      const totalIntervals = 24 * intervalsPerHour;
      
      const timeHeaderRow = document.createElement('div');
      timeHeaderRow.className = 'schedule-time-header';
      
      const agentNameHeader = document.createElement('div');
      agentNameHeader.className = 'agent-name-header';
      agentNameHeader.textContent = 'Agent / Time';
      timeHeaderRow.appendChild(agentNameHeader);
      
      for (let interval = 0; interval < totalIntervals; interval++) {
        const hour = Math.floor(interval / intervalsPerHour);
        const minute = (interval % intervalsPerHour) * scheduleData.intervalLength;
        
        const timeHeader = document.createElement('div');
        timeHeader.className = 'time-interval-header';
        
        if (minute === 0) {
          timeHeader.textContent = `${hour.toString().padStart(2, '0')}:00`;
        } else {
          timeHeader.textContent = `${minute}`;
        }
        
        timeHeader.title = `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
        timeHeaderRow.appendChild(timeHeader);
      }
      
      horizontalScheduleGrid.appendChild(timeHeaderRow);
      
      sortedAgents.forEach(agent => {
        const agentRow = document.createElement('div');
        agentRow.className = 'agent-schedule-row';
        
        const agentNameCell = document.createElement('div');
        agentNameCell.className = 'agent-name-cell';
        agentNameCell.textContent = agent.agentName;
        agentNameCell.title = `${agent.agentName} (${agent.department})`;
        agentRow.appendChild(agentNameCell);
        
        for (let interval = 0; interval < totalIntervals; interval++) {
          const cell = document.createElement('div');
          cell.className = 'time-interval-cell';
          
          const activity = agent.activities[interval];
          if (activity) {
            const activityType = activityTypes.find(type => type.id === activity);
            if (activityType) {
              const activityBlock = document.createElement('div');
              activityBlock.className = `activity-block ${activityType.color}`;
              activityBlock.textContent = activityType.name.substring(0, 1);
              
              const hour = Math.floor(interval / intervalsPerHour);
              const minute = (interval % intervalsPerHour) * scheduleData.intervalLength;
              const timeString = `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
              activityBlock.title = `${agent.agentName} - ${activityType.name} - ${timeString}`;
              
              cell.appendChild(activityBlock);
            }
          }
          
          agentRow.appendChild(cell);
        }
        
        horizontalScheduleGrid.appendChild(agentRow);
      });
      
      const overtimeRow = document.createElement('div');
      overtimeRow.className = 'agent-schedule-row overtime-row';
      
      const overtimeLabelCell = document.createElement('div');
      overtimeLabelCell.className = 'agent-name-cell';
      overtimeLabelCell.textContent = 'Overtime Opportunities';
      overtimeLabelCell.style.fontWeight = '700';
      overtimeLabelCell.style.color = 'var(--warn)';
      overtimeRow.appendChild(overtimeLabelCell);
      
      const overtimeOpportunities = daySchedule.overtimeOpportunities || [];
      for (let interval = 0; interval < totalIntervals; interval++) {
        const cell = document.createElement('div');
        cell.className = 'overtime-cell';
        
        const opportunity = overtimeOpportunities.find(opp => opp.interval === interval);
        if (opportunity && opportunity.shortfall > 0) {
          const overtimeBlock = document.createElement('div');
          overtimeBlock.className = 'overtime-opportunity';
          overtimeBlock.textContent = `+${opportunity.shortfall}`;
          overtimeBlock.title = `Overtime opportunity: ${opportunity.shortfall} staff needed\nRequired: ${opportunity.required}\nAssigned: ${opportunity.assigned}`;
          cell.appendChild(overtimeBlock);
        }
        
        overtimeRow.appendChild(cell);
      }
      
      horizontalScheduleGrid.appendChild(overtimeRow);
    }

    function updateNetStaffingRibbon() {
      if (!scheduleData.netStaffing || scheduleData.netStaffing.length === 0) {
        netStaffingRibbon.style.display = 'none';
        return;
      }
      
      netStaffingRibbon.style.display = 'block';
      ribbonVisual.innerHTML = '';
      ribbonTimeLabels.innerHTML = '';
      
      const dayNetStaffing = scheduleData.netStaffing[scheduleData.currentDay] || [];
      const intervalsPerHour = 60 / scheduleData.intervalLength;
      const totalIntervals = 24 * intervalsPerHour;
      
      let balancedCount = 0;
      let overstaffedCount = 0;
      let understaffedCount = 0;
      let overtimeOppCount = 0;
      
      for (let interval = 0; interval < totalIntervals; interval++) {
        const staffing = dayNetStaffing[interval] || { net: 0, required: 0, assigned: 0 };
        
        let status = 'balanced';
        let color = '#16a34a';
        let tooltipText = '';
        
        if (staffing.net === 0) {
          status = 'balanced';
          color = '#16a34a';
          balancedCount++;
          tooltipText = `Balanced: ${staffing.assigned} staff`;
        } else if (staffing.net > 0) {
          status = 'overstaffed';
          color = '#3b82f6';
          overstaffedCount++;
          tooltipText = `Overstaffed by ${staffing.net}: ${staffing.assigned}/${staffing.required} staff`;
        } else if (staffing.net < 0) {
          status = 'understaffed';
          color = '#ef4444';
          understaffedCount++;
          if (staffing.required > 0) {
            overtimeOppCount++;
            tooltipText = `Understaffed by ${-staffing.net}: ${staffing.assigned}/${staffing.required} staff - Overtime opportunity`;
          } else {
            tooltipText = `Understaffed by ${-staffing.net}: ${staffing.assigned}/${staffing.required} staff`;
          }
        }
        
        const segment = document.createElement('div');
        segment.className = 'ribbon-segment';
        segment.style.background = color;
        
        const hour = Math.floor(interval / intervalsPerHour);
        const minute = (interval % intervalsPerHour) * scheduleData.intervalLength;
        const timeString = `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
        
        const tooltip = document.createElement('div');
        tooltip.className = 'ribbon-tooltip';
        tooltip.textContent = `${timeString} - ${tooltipText}`;
        segment.appendChild(tooltip);
        
        const countSpan = document.createElement('span');
        countSpan.textContent = staffing.assigned;
        countSpan.style.fontSize = '10px';
        segment.appendChild(countSpan);
        
        ribbonVisual.appendChild(segment);
        
        if (scheduleData.intervalLength <= 30 && minute % 30 === 0) {
          const timeLabel = document.createElement('div');
          timeLabel.className = 'ribbon-time-label';
          timeLabel.textContent = timeString;
          ribbonTimeLabels.appendChild(timeLabel);
        } else if (minute === 0) {
          const timeLabel = document.createElement('div');
          timeLabel.className = 'ribbon-time-label';
          timeLabel.textContent = `${hour.toString().padStart(2, '0')}:00`;
          ribbonTimeLabels.appendChild(timeLabel);
        } else {
          const timeLabel = document.createElement('div');
          timeLabel.className = 'ribbon-time-label';
          timeLabel.textContent = '';
          ribbonTimeLabels.appendChild(timeLabel);
        }
      }
      
      document.getElementById('ribbonBalanced').textContent = balancedCount;
      document.getElementById('ribbonOverstaffed').textContent = overstaffedCount;
      document.getElementById('ribbonUnderstaffed').textContent = understaffedCount;
      document.getElementById('ribbonOvertimeOpp').textContent = overtimeOppCount;
    }

    function collectConfiguration() {
      const period = parseInt(document.getElementById('schedulePeriod').value);
      const startDate = new Date(document.getElementById('startDate').value);
      const intervalLength = parseInt(document.getElementById('intervalLength').value);
      const businessHours = document.getElementById('businessHours').value;
      
      let customHours = { start: 8, end: 18 };
      if (businessHours === 'custom') {
        const start = document.getElementById('customStart').value;
        const end = document.getElementById('customEnd').value;
        customHours.start = parseInt(start.split(':')[0]);
        customHours.end = parseInt(end.split(':')[0]);
      } else if (businessHours !== '24') {
        const [start, end] = businessHours.split('_');
        customHours.start = parseInt(start);
        customHours.end = parseInt(end);
      } else {
        customHours = { start: 0, end: 24 };
      }
      
      return {
        period,
        startDate,
        intervalLength,
        businessHours: customHours
      };
    }

    function displayScheduleResults(schedule, metrics) {
      updateResultsDisplay(metrics);
      scheduleData.intervalLength = parseInt(document.getElementById('intervalLength').value);
      updateDateDisplay();
    }

    function updateResultsDisplay(metrics) {
      document.getElementById('resultScheduledHours').textContent = metrics.totalHours;
      document.getElementById('resultUtilization').textContent = metrics.utilization + '%';
      document.getElementById('resultCoverageGaps').textContent = metrics.coverageGaps;
      document.getElementById('resultOvertime').textContent = metrics.overtime;
    }

    function updateDateDisplay() {
      if (!scheduleData.generatedSchedule || scheduleData.totalDays === 0) {
        currentDateDisplay.textContent = 'No schedule generated';
        return;
      }
      
      const startDate = new Date(document.getElementById('startDate').value);
      const currentDate = new Date(startDate);
      currentDate.setDate(currentDate.getDate() + scheduleData.currentDay);
      
      const dayNames = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
      const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
      
      const dayName = dayNames[currentDate.getDay()];
      const monthName = monthNames[currentDate.getMonth()];
      const day = currentDate.getDate();
      const year = currentDate.getFullYear();
      
      currentDateDisplay.textContent = `${dayName}, ${day} ${monthName} ${year} (Day ${scheduleData.currentDay + 1} of ${scheduleData.totalDays})`;
    }

    function updateProgress(percent) {
      progressFill.style.width = `${percent}%`;
    }
    
    function updateStatus(message, isError = false) {
      scheduleStatus.textContent = message;
      scheduleStatus.style.color = isError ? 'var(--bad)' : 'var(--text-color)';
    }

    function saveChanges() {
      if (!scheduleData.modified) {
        updateStatus('No changes to save');
        return;
      }
      
      try {
        localStorage.setItem('wfmScheduleData', JSON.stringify(scheduleData));
        scheduleData.modified = false;
        updateStatus('Changes saved successfully');
        saveChangesBtn.textContent = 'ðŸ’¾ Save Changes';
      } catch (error) {
        updateStatus('Error saving changes: ' + error.message, true);
      }
    }

    function publishSchedule() {
      const option = document.getElementById('publishOption').value;
      let publishRange = '';
      
      if (option === 'current') {
        publishRange = 'Current day only';
      } else if (option === 'range') {
        publishRange = 'Selected date range';
      } else {
        publishRange = 'All days';
      }
      
      updateStatus(`Schedule published for: ${publishRange}`);
      
      alert(`Schedule published successfully!\n\nRange: ${publishRange}\n\nThe schedule is now visible to all team members.`);
    }

    function changeInterval(interval) {
      intervalButtons.forEach(btn => {
        btn.classList.remove('active');
        if (parseInt(btn.dataset.interval) === interval) {
          btn.classList.add('active');
        }
      });
      
      document.getElementById('intervalLength').value = interval;
      
      scheduleData.intervalLength = interval;
      
      if (scheduleData.generatedSchedule) {
        generateHorizontalSchedule();
        updateNetStaffingRibbon();
      }
    }

    function navigateDay(direction) {
      if (!scheduleData.generatedSchedule) return;
      
      const newDay = scheduleData.currentDay + direction;
      if (newDay >= 0 && newDay < scheduleData.totalDays) {
        scheduleData.currentDay = newDay;
        generateHorizontalSchedule();
        updateNetStaffingRibbon();
        updateDateDisplay();
      }
    }

    initializeDatePicker();
    initializeAgents();
    
    businessHoursSelect.addEventListener('change', function() {
      customHoursSection.style.display = this.value === 'custom' ? 'block' : 'none';
    });

    forecastSourceSelect.addEventListener('change', function() {
      manualForecastSection.style.display = this.value === 'manual' ? 'block' : 'none';
      importForecastSection.style.display = this.value === 'import' ? 'block' : 'none';
    });

    document.querySelectorAll('.rule-item input[type="checkbox"]').forEach(checkbox => {
      checkbox.addEventListener('change', function() {
        const ruleItem = this.closest('.rule-item');
        if (this.checked) {
          ruleItem.classList.add('active');
        } else {
          ruleItem.classList.remove('active');
        }
      });
    });

    intervalButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        changeInterval(parseInt(btn.dataset.interval));
      });
    });

    document.getElementById('intervalLength').addEventListener('change', function() {
      changeInterval(parseInt(this.value));
    });

    sortScheduleSelect.addEventListener('change', () => {
      if (scheduleData.generatedSchedule) {
        generateHorizontalSchedule();
      }
    });

    prevDayBtn.addEventListener('click', () => navigateDay(-1));
    nextDayBtn.addEventListener('click', () => navigateDay(1));

    generateScheduleBtn.addEventListener('click', generateSchedule);
    manageStaffBtn.addEventListener('click', () => {
      document.querySelector('[data-tab="agents"]').click();
    });
    saveChangesBtn.addEventListener('click', saveChanges);
    publishScheduleBtn.addEventListener('click', publishSchedule);

    searchInput.addEventListener('input', updateAgentDisplay);
    departmentFilter.addEventListener('change', updateAgentDisplay);
    statusFilter.addEventListener('change', updateAgentDisplay);
    addAgentBtn.addEventListener('click', () => showAgentModal());
    modalCloseBtn.addEventListener('click', hideAgentModal);
    cancelModalBtn.addEventListener('click', hideAgentModal);
    agentForm.addEventListener('submit', saveAgent);

    agentsTableBody.addEventListener('click', (event) => {
      const target = event.target;
      const button = target.closest('button');
      
      if (!button) return;
      
      const agentId = parseInt(button.getAttribute('data-id'));
      
      if (button.classList.contains('edit')) {
        showAgentModal(agentId);
      } else if (button.classList.contains('delete')) {
        deleteAgent(agentId);
      }
    });

    agentModal.addEventListener('click', (e) => {
      if (e.target === agentModal) {
        hideAgentModal();
      }
    });

    updateStatus('Ready to create schedule');
    
    try {
      const savedData = localStorage.getItem('wfmScheduleData');
      if (savedData) {
        const parsed = JSON.parse(savedData);
        if (parsed.generatedSchedule) {
          scheduleData = parsed;
          updateStatus('Loaded saved schedule');
          if (scheduleData.modified) {
            saveChangesBtn.style.display = 'block';
            saveChangesBtn.textContent = 'ðŸ’¾ Save Changes*';
          }
        }
      }
    } catch (error) {
      console.log('No saved schedule found');
    }
  </script>
</body>
</html>
