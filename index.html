<!DOCTYPE html>
<html lang="en-GB">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>WFM Scheduling Tool | Rule-Based Scheduling</title>
  <style>
    :root {
      --primary-color: #63AB8F;
      --secondary-color: #4A8C7D;
      --border-color: #DEE2E6;
      --light-bg: #F8F9FA;
      --card-bg: #FFFFFF;
      --text-color: #2C3E50;
      --text-light: #6C757D;
      --warn: #f59e0b;
      --bad: #dc2626;
      --good: #16a34a;
      --schedule-available: #63AB8F;
      --schedule-assigned: #4A8C7D;
      --schedule-unavailable: #9CA3AF;
      --schedule-overtime: #F59E0B;
      --chart-1: #4A8C7D;
      --chart-2: #63AB8F;
      --chart-3: #A8D5BA;
      --chart-4: #C7E8D3;
      --modified: #8b5cf6;
      --overstaffed: #3b82f6;
      --understaffed: #ef4444;
      --shortfall: #dc2626;
      --overtime-opp: #f59e0b;
    }
    
    body, h1, h2, h3, h4, h5, h6, p, div, span, label, button, input, select, textarea, th, td, li, ul, ol {
      font-family: 'Aptos', 'Segoe UI', system-ui, -apple-system, Arial, sans-serif;
    }
    
    body {
      margin: 0;
      padding: 20px;
      background: var(--light-bg);
      color: var(--text-color);
      min-height: 100vh;
    }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
    }

    /* Header */
    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 2px solid var(--border-color);
    }
    
    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .brand h1 {
      margin: 0;
      font-size: 28px;
      color: var(--secondary-color);
      font-weight: 800;
    }
    
    .brand .subtitle {
      color: var(--text-light);
      font-weight: 600;
      font-size: 14px;
      margin-left: 8px;
    }
    
    .schedule-status {
      background: white;
      padding: 10px 16px;
      border-radius: 8px;
      border: 1px solid var(--border-color);
      font-size: 14px;
      min-width: 200px;
      text-align: center;
    }

    /* Main Layout */
    .main-layout {
      display: grid;
      grid-template-columns: 1fr;
      gap: 24px;
    }
    
    .cards-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 24px;
    }
    
    @media (max-width: 768px) {
      .cards-row {
        grid-template-columns: 1fr;
      }
    }

    /* Card Styling */
    .card {
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 24px;
      box-shadow: 0 1px 3px rgba(0,0,0,.08);
    }
    
    .card:hover {
      box-shadow: 0 2px 8px rgba(0,0,0,.1);
    }
    
    .card-title {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
      padding-bottom: 16px;
      border-bottom: 2px solid var(--border-color);
    }
    
    .card-title h2 {
      margin: 0;
      font-size: 18px;
      font-weight: 700;
      color: var(--secondary-color);
    }
    
    .badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 900;
      background: rgba(99, 171, 143, 0.1);
      color: var(--secondary-color);
      border: 1px solid rgba(99, 171, 143, 0.3);
    }

    /* Form Controls */
    .form-group {
      margin-bottom: 20px;
    }
    
    label {
      display: block;
      font-weight: 600;
      margin-bottom: 8px;
      font-size: 14px;
      color: var(--text-color);
    }
    
    select, input, textarea, button {
      padding: 12px 14px;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      background: var(--card-bg);
      font-size: 14px;
      width: 100%;
      box-sizing: border-box;
      transition: all 0.2s ease;
    }
    
    select:focus, input:focus, textarea:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(99, 171, 143, 0.1);
    }
    
    button {
      background: var(--primary-color);
      color: #fff;
      font-weight: 600;
      cursor: pointer;
      transition: background .2s;
      border: none;
    }
    
    button:hover {
      background: var(--secondary-color);
      transform: translateY(-1px);
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    
    button.secondary {
      background: #fff;
      color: var(--primary-color);
      border: 2px solid var(--primary-color);
    }
    
    button.secondary:hover {
      background: rgba(99, 171, 143, 0.1);
      border-color: var(--secondary-color);
      color: var(--secondary-color);
    }
    
    button:disabled {
      background: var(--text-light);
      cursor: not-allowed;
      transform: none !important;
      box-shadow: none !important;
    }

    /* Row layouts */
    .row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }
    
    .row-3 {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 16px;
    }
    
    @media (max-width: 768px) {
      .row, .row-3 {
        grid-template-columns: 1fr;
      }
    }

    /* Button Groups */
    .btn-group {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px solid var(--border-color);
    }
    
    .btn-group button {
      flex: 1;
      min-width: 140px;
    }

    /* Rule Toggles */
    .rule-group {
      margin-bottom: 24px;
    }
    
    .rule-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      background: rgba(99, 171, 143, 0.05);
      border-radius: 8px;
      margin-bottom: 8px;
      border: 1px solid transparent;
      transition: all 0.2s ease;
    }
    
    .rule-item:hover {
      border-color: var(--primary-color);
      background: rgba(99, 171, 143, 0.1);
    }
    
    .rule-item input[type="checkbox"] {
      width: 18px;
      height: 18px;
      margin: 0;
    }
    
    .rule-label {
      flex: 1;
      font-weight: 600;
      color: var(--text-color);
    }
    
    .rule-description {
      font-size: 12px;
      color: var(--text-light);
      margin-top: 2px;
    }
    
    .rule-settings {
      margin-top: 12px;
      padding: 12px;
      background: white;
      border-radius: 6px;
      border: 1px solid var(--border-color);
      display: none;
    }
    
    .rule-item.active .rule-settings {
      display: block;
    }

    /* Schedule View */
    .schedule-view-container {
      margin-top: 32px;
      border-top: 2px solid var(--border-color);
      padding-top: 24px;
    }
    
    .schedule-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }
    
    .schedule-header h2 {
      margin: 0;
      font-size: 24px;
      color: var(--secondary-color);
    }
    
    .schedule-controls {
      display: flex;
      gap: 12px;
      align-items: center;
      flex-wrap: wrap;
    }
    
    .date-navigation {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .date-navigation button {
      padding: 8px 12px;
      min-width: auto;
    }

    /* Publish Controls */
    .publish-controls {
      display: flex;
      gap: 12px;
      align-items: center;
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px solid var(--border-color);
    }
    
    .publish-controls button {
      min-width: 150px;
    }

    /* Net Staffing Ribbon */
    .net-staffing-ribbon {
      background: white;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 24px;
      box-shadow: 0 1px 3px rgba(0,0,0,.08);
    }
    
    .ribbon-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }
    
    .ribbon-header h3 {
      margin: 0;
      font-size: 16px;
      color: var(--secondary-color);
    }
    
    .ribbon-stats {
      display: flex;
      gap: 20px;
    }
    
    .stat-item {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    
    .stat-value {
      font-size: 20px;
      font-weight: 700;
    }
    
    .stat-label {
      font-size: 12px;
      color: var(--text-light);
    }
    
    .net-overstaffed {
      color: var(--overstaffed);
    }
    
    .net-understaffed {
      color: var(--understaffed);
    }
    
    .net-balanced {
      color: var(--good);
    }
    
    .net-overtime {
      color: var(--overtime-opp);
    }
    
    .ribbon-visual {
      display: flex;
      height: 40px;
      border-radius: 4px;
      overflow: hidden;
      border: 1px solid var(--border-color);
    }
    
    .ribbon-segment {
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 600;
      font-size: 12px;
      transition: all 0.2s;
      position: relative;
    }
    
    .ribbon-segment:hover {
      filter: brightness(1.1);
      z-index: 10;
    }
    
    .ribbon-tooltip {
      position: absolute;
      top: -40px;
      background: var(--text-color);
      color: white;
      padding: 6px 12px;
      border-radius: 4px;
      font-size: 11px;
      white-space: nowrap;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s;
    }
    
    .ribbon-segment:hover .ribbon-tooltip {
      opacity: 1;
    }

    /* Daily Schedule Grid */
    .daily-schedule-container {
      margin-top: 20px;
    }
    
    .daily-grid {
      border: 1px solid var(--border-color);
      border-radius: 8px;
      overflow: hidden;
      background: white;
      position: relative;
    }
    
    .daily-grid-header {
      display: grid;
      grid-template-columns: 80px repeat(auto-fit, minmax(40px, 1fr));
      background: var(--light-bg);
      border-bottom: 1px solid var(--border-color);
      position: sticky;
      top: 0;
      z-index: 20;
    }
    
    .time-header-cell {
      padding: 12px 8px;
      text-align: center;
      font-weight: 600;
      font-size: 12px;
      color: var(--secondary-color);
      border-right: 1px solid var(--border-color);
      background: var(--light-bg);
    }
    
    .daily-grid-body {
      display: grid;
      grid-template-columns: 80px repeat(auto-fit, minmax(40px, 1fr));
      max-height: 600px;
      overflow-y: auto;
    }
    
    .staff-row {
      display: contents;
    }
    
    .staff-name-cell {
      padding: 12px 8px;
      font-weight: 600;
      font-size: 13px;
      border-right: 1px solid var(--border-color);
      border-bottom: 1px solid var(--border-color);
      background: white;
      position: sticky;
      left: 0;
      z-index: 10;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .time-cell {
      padding: 12px 4px;
      text-align: center;
      border-right: 1px solid var(--border-color);
      border-bottom: 1px solid var(--border-color);
      font-size: 12px;
      min-height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      transition: all 0.2s;
    }
    
    .time-cell:hover {
      transform: scale(1.05);
      z-index: 5;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .activity-block {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
      font-weight: 600;
      font-size: 11px;
      text-align: center;
      padding: 2px;
      cursor: pointer;
      transition: all 0.2s;
      border: 1px solid transparent;
    }
    
    .activity-block:hover {
      filter: brightness(1.1);
    }
    
    .activity-inbound {
      background: var(--schedule-assigned);
      color: white;
    }
    
    .activity-break {
      background: linear-gradient(45deg, #f59e0b, #fbbf24);
      color: white;
    }
    
    .activity-lunch {
      background: linear-gradient(45deg, #dc2626, #ef4444);
      color: white;
    }
    
    .activity-meeting {
      background: linear-gradient(45deg, #3b82f6, #60a5fa);
      color: white;
    }
    
    .activity-coaching {
      background: linear-gradient(45deg, #8b5cf6, #a78bfa);
      color: white;
    }
    
    .activity-training {
      background: linear-gradient(45deg, #10b981, #34d399);
      color: white;
    }
    
    .activity-overtime {
      background: repeating-linear-gradient(
        45deg,
        var(--overtime-opp),
        var(--overtime-opp) 10px,
        #fbbf24 10px,
        #fbbf24 20px
      );
      color: white;
      border: 2px solid var(--warn);
    }
    
    .activity-shortfall {
      background: repeating-linear-gradient(
        -45deg,
        var(--shortfall),
        var(--shortfall) 10px,
        #fca5a5 10px,
        #fca5a5 20px
      );
      color: white;
      border: 2px solid var(--bad);
    }
    
    .activity-empty {
      background: rgba(156, 163, 175, 0.1);
      color: var(--text-light);
    }
    
    .time-slot-header {
      font-weight: 600;
      color: var(--text-color);
    }
    
    .overtime-opportunities {
      margin-top: 24px;
      padding: 16px;
      background: rgba(245, 158, 11, 0.1);
      border: 1px solid rgba(245, 158, 11, 0.3);
      border-radius: 8px;
    }
    
    .overtime-opportunities h4 {
      margin: 0 0 12px 0;
      color: var(--warn);
      font-size: 16px;
    }
    
    .opportunities-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 12px;
    }
    
    .opportunity-item {
      padding: 12px;
      background: white;
      border-radius: 6px;
      border: 1px solid rgba(245, 158, 11, 0.3);
    }
    
    .opportunity-time {
      font-weight: 600;
      color: var(--text-color);
      margin-bottom: 4px;
    }
    
    .opportunity-details {
      font-size: 12px;
      color: var(--text-light);
    }

    /* Results Summary */
    .summary-tiles {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin: 24px 0;
    }
    
    .tile {
      border: 1px solid var(--border-color);
      border-radius: 10px;
      padding: 20px;
      background: #fff;
      text-align: center;
    }
    
    .tile .label {
      color: var(--text-light);
      font-weight: 800;
      font-size: 13px;
      letter-spacing: .3px;
      text-transform: uppercase;
      margin-bottom: 8px;
    }
    
    .tile .value {
      font-size: 28px;
      font-weight: 900;
      margin-top: 4px;
      color: var(--secondary-color);
      line-height: 1.2;
    }
    
    .tile .subtext {
      margin-top: 8px;
      font-size: 12px;
      color: var(--text-light);
      line-height: 1.4;
    }

    /* Staff Assignments Table */
    .assignments-table {
      max-height: 400px;
      overflow: auto;
      border: 1px solid var(--border-color);
      border-radius: 12px;
      margin-top: 24px;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
      background: white;
    }
    
    thead th {
      background: var(--primary-color);
      color: white;
      text-align: left;
      padding: 16px 12px;
      border-bottom: 1px solid var(--border-color);
      position: sticky;
      top: 0;
      z-index: 10;
      font-weight: 700;
      font-size: 13px;
      letter-spacing: .3px;
    }
    
    tbody td {
      padding: 12px;
      border-bottom: 1px solid var(--border-color);
      vertical-align: middle;
    }
    
    tbody tr:hover {
      background: rgba(99, 171, 143, 0.05);
    }
    
    tbody tr:last-child td {
      border-bottom: none;
    }
    
    .center {
      text-align: center;
    }
    
    .right {
      text-align: right;
    }

    /* Optimization Results */
    .optimization-results {
      background: rgba(99, 171, 143, 0.05);
      border: 1px solid var(--primary-color);
      border-radius: 8px;
      padding: 20px;
      margin-top: 20px;
    }
    
    .optimization-metrics {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 16px;
      margin-top: 16px;
    }
    
    .metric {
      text-align: center;
      padding: 12px;
      background: white;
      border-radius: 6px;
      border: 1px solid var(--border-color);
    }
    
    .metric .value {
      font-size: 20px;
      font-weight: 700;
      color: var(--secondary-color);
    }
    
    .metric .label {
      font-size: 12px;
      color: var(--text-light);
      margin-top: 4px;
    }

    /* Help Text */
    .help-text {
      font-size: 12px;
      color: var(--text-light);
      margin-top: 6px;
      line-height: 1.4;
    }
    
    .note {
      background: rgba(99, 171, 143, 0.05);
      border-left: 4px solid var(--primary-color);
      border-radius: 8px;
      padding: 14px;
      margin-top: 20px;
      font-size: 13px;
      color: var(--text-color);
      line-height: 1.5;
    }

    /* Progress Bar */
    .progress-bar {
      height: 8px;
      background: var(--border-color);
      border-radius: 4px;
      overflow: hidden;
      margin: 20px 0;
    }
    
    .progress-fill {
      height: 100%;
      background: var(--primary-color);
      transition: width 0.3s ease;
    }

    /* Footer */
    .footer {
      margin-top: 40px;
      padding-top: 20px;
      border-top: 1px solid var(--border-color);
      text-align: center;
      color: var(--text-light);
      font-size: 12px;
    }

    /* Tabs */
    .tabs {
      display: flex;
      border-bottom: 2px solid var(--border-color);
      margin-bottom: 24px;
    }
    
    .tab {
      padding: 12px 24px;
      background: none;
      border: none;
      font-size: 16px;
      font-weight: 600;
      color: var(--text-light);
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
    }
    
    .tab:hover {
      color: var(--primary-color);
    }
    
    .tab.active {
      color: var(--primary-color);
    }
    
    .tab.active::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      right: 0;
      height: 2px;
      background: var(--primary-color);
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }

    /* Agent Profiles Table */
    .table-container {
      max-height: 400px;
      overflow: auto;
      border: 1px solid var(--border-color);
      border-radius: 12px;
      margin-top: 24px;
    }
    
    /* Search and Filter Bar */
    .search-filter-bar {
      display: flex;
      gap: 15px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    
    .search-box {
      flex: 1;
      min-width: 250px;
    }
    
    .filter-select {
      min-width: 150px;
    }
    
    /* Agent Summary */
    .agent-summary {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .summary-card {
      background: white;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 15px;
      text-align: center;
    }
    
    .summary-card .value {
      font-size: 24px;
      font-weight: 900;
      color: var(--secondary-color);
      margin-bottom: 5px;
    }
    
    .summary-card .label {
      font-size: 12px;
      color: var(--text-light);
      font-weight: 600;
      text-transform: uppercase;
    }
    
    /* Badge lists */
    .badge-list {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin: 0;
      padding: 0;
    }
    
    .badge-item {
      display: inline-block;
      padding: 2px 8px;
      background: rgba(99, 171, 143, 0.1);
      border: 1px solid rgba(99, 171, 143, 0.3);
      border-radius: 12px;
      font-size: 11px;
      color: var(--secondary-color);
      white-space: nowrap;
    }
    
    /* Status indicators */
    .status-active {
      color: var(--good);
      font-weight: 600;
    }
    
    .status-inactive {
      color: var(--bad);
      font-weight: 600;
    }
    
    /* Modal */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }
    
    .modal {
      background: white;
      border-radius: 12px;
      width: 90%;
      max-width: 800px;
      max-height: 90vh;
      overflow-y: auto;
    }
    
    .modal-header {
      padding: 20px 24px;
      border-bottom: 1px solid var(--border-color);
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: var(--primary-color);
      color: white;
      border-radius: 12px 12px 0 0;
    }
    
    .modal-header h2 {
      margin: 0;
      font-size: 20px;
    }
    
    .modal-close {
      background: none;
      border: none;
      color: white;
      font-size: 24px;
      cursor: pointer;
      padding: 0;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
    }
    
    .modal-body {
      padding: 24px;
    }
    
    /* Interval Selector */
    .interval-selector {
      display: flex;
      gap: 12px;
      align-items: center;
      margin-bottom: 16px;
    }
    
    .interval-selector label {
      margin-bottom: 0;
      font-weight: 600;
    }
    
    .interval-buttons {
      display: flex;
      gap: 8px;
    }
    
    .interval-btn {
      padding: 8px 16px;
      border: 1px solid var(--border-color);
      background: white;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.2s;
    }
    
    .interval-btn:hover {
      background: rgba(99, 171, 143, 0.1);
    }
    
    .interval-btn.active {
      background: var(--primary-color);
      color: white;
      border-color: var(--primary-color);
    }
    
    /* Traditional WFM Calendar Grid */
    .daily-schedule-grid {
      border: 1px solid var(--border-color);
      border-radius: 8px;
      overflow: hidden;
      background: white;
      margin-top: 20px;
      overflow-x: auto;
    }

    .schedule-grid-header {
      display: grid;
      grid-auto-flow: column;
      grid-auto-columns: minmax(40px, 1fr);
      background: var(--primary-color);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .schedule-time-header {
      padding: 10px 4px;
      text-align: center;
      font-size: 11px;
      font-weight: 600;
      color: white;
      border-right: 1px solid rgba(255, 255, 255, 0.2);
      min-width: 120px;
      position: sticky;
      left: 0;
      background: var(--primary-color);
      z-index: 101;
    }

    .schedule-interval-header {
      padding: 8px 4px;
      text-align: center;
      font-size: 10px;
      font-weight: 600;
      color: white;
      border-right: 1px solid rgba(255, 255, 255, 0.2);
    }

    .schedule-agent-row {
      display: grid;
      grid-auto-flow: column;
      grid-auto-columns: minmax(40px, 1fr);
      border-bottom: 1px solid var(--border-color);
    }

    .schedule-agent-row:last-child {
      border-bottom: none;
    }

    .schedule-agent-name {
      padding: 12px 8px;
      font-weight: 600;
      font-size: 12px;
      background: rgba(99, 171, 143, 0.05);
      border-right: 1px solid var(--border-color);
      min-width: 120px;
      position: sticky;
      left: 0;
      z-index: 10;
      display: flex;
      align-items: center;
    }

    .schedule-activity-cell {
      padding: 4px;
      text-align: center;
      border-right: 1px solid var(--border-color);
      font-size: 10px;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 50px;
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
    }

    .schedule-activity-cell:hover {
      box-shadow: inset 0 0 0 2px var(--primary-color);
    }

    .schedule-activity-cell.modified {
      border: 2px solid var(--modified);
    }

    .schedule-activity-cell.on-queue {
      background: rgba(99, 171, 143, 0.3);
      color: var(--secondary-color);
    }

    .schedule-activity-cell.break {
      background: rgba(245, 158, 11, 0.3);
      color: var(--warn);
    }

    .schedule-activity-cell.lunch {
      background: rgba(220, 38, 38, 0.3);
      color: var(--bad);
    }

    .schedule-activity-cell.meeting {
      background: rgba(37, 99, 235, 0.3);
      color: #2563eb;
    }

    .schedule-activity-cell.coaching {
      background: rgba(147, 51, 234, 0.3);
      color: #9333ea;
    }

    .schedule-activity-cell.off {
      background: rgba(156, 163, 175, 0.1);
      color: var(--text-light);
    }

    .schedule-activity-cell.overtime-opportunity {
      background: repeating-linear-gradient(
        45deg,
        rgba(245, 158, 11, 0.1),
        rgba(245, 158, 11, 0.1) 10px,
        rgba(245, 158, 11, 0.2) 10px,
        rgba(245, 158, 11, 0.2) 20px
      );
      border: 1px dashed var(--warn);
      color: var(--warn);
    }

    .overtime-badge {
      position: absolute;
      top: 2px;
      right: 2px;
      background: var(--warn);
      color: white;
      font-size: 8px;
      padding: 1px 4px;
      border-radius: 3px;
      font-weight: 700;
    }

    /* Save Indicator */
    .save-indicator {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: white;
      border: 2px solid var(--primary-color);
      border-radius: 8px;
      padding: 12px 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      display: none;
      align-items: center;
      gap: 10px;
      z-index: 999;
      animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
      from {
        transform: translateY(100px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .save-indicator.show {
      display: flex;
    }

    .save-indicator-icon {
      font-size: 20px;
    }

    .save-indicator-text {
      font-weight: 600;
      color: var(--secondary-color);
    }

    /* Publish Options */
    .publish-option {
      padding: 15px;
      border: 2px solid var(--border-color);
      border-radius: 8px;
      margin-bottom: 15px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .publish-option:hover {
      border-color: var(--primary-color);
      background: rgba(99, 171, 143, 0.05);
    }

    .publish-option.selected {
      border-color: var(--primary-color);
      background: rgba(99, 171, 143, 0.1);
    }

    .publish-option input[type="radio"] {
      width: auto;
      margin-right: 10px;
    }

    .publish-option-title {
      font-weight: 700;
      font-size: 15px;
      margin-bottom: 5px;
    }

    .publish-option-description {
      font-size: 12px;
      color: var(--text-light);
    }

    .date-range-inputs {
      margin-top: 15px;
      padding: 15px;
      background: rgba(99, 171, 143, 0.05);
      border-radius: 8px;
      display: none;
    }

    .date-range-inputs.active {
      display: block;
    }

    /* Responsive */
    @media (max-width: 1024px) {
      .daily-grid-header,
      .daily-grid-body {
        grid-template-columns: 100px repeat(12, 1fr);
      }
    }
    
    @media (max-width: 768px) {
      body {
        padding: 10px;
      }
      
      .card {
        padding: 16px;
      }
      
      .header {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
      }
      
      .schedule-status {
        width: 100%;
        min-width: unset;
      }
      
      .daily-grid-header,
      .daily-grid-body {
        grid-template-columns: 80px repeat(8, 1fr);
        font-size: 10px;
      }
      
      .time-cell {
        padding: 4px;
        min-height: 40px;
      }
      
      .schedule-controls {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .publish-controls {
        flex-direction: column;
        align-items: stretch;
      }
      
      .publish-controls button {
        width: 100%;
      }
    }
    
    @media (max-width: 480px) {
      .daily-grid-header,
      .daily-grid-body {
        grid-template-columns: 70px repeat(6, 1fr);
      }
      
      .btn-group {
        flex-direction: column;
      }
      
      .btn-group button {
        width: 100%;
      }
      
      .ribbon-stats {
        flex-direction: column;
        gap: 10px;
      }
    }

    /* Custom scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb {
      background: var(--primary-color);
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: var(--secondary-color);
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <div class="brand">
        <h1>WFM Scheduling Tool</h1>
        <span class="subtitle">Rule-Based Scheduling</span>
      </div>
      <div class="schedule-status" id="scheduleStatus">
        Ready to create schedule
      </div>
    </div>

    <!-- Tabs -->
    <div class="tabs">
      <button class="tab active" data-tab="scheduling">Scheduling</button>
      <button class="tab" data-tab="agents">Agent Management</button>
      <button class="tab" data-tab="scheduleView">Daily Schedule View</button>
    </div>

    <!-- Scheduling Tab -->
    <div id="schedulingTab" class="tab-content active">
      <!-- Main Content -->
      <div class="main-layout">
        <!-- Schedule Configuration Card -->
        <div class="card">
          <div class="card-title">
            <h2>Schedule Configuration</h2>
            <span class="badge">Setup</span>
          </div>
          
          <div class="row">
            <div class="form-group">
              <label for="schedulePeriod">Schedule Period</label>
              <select id="schedulePeriod">
                <option value="7">7 days (1 week)</option>
                <option value="14" selected>14 days (2 weeks)</option>
                <option value="28">28 days (4 weeks)</option>
                <option value="30">30 days (1 month)</option>
              </select>
            </div>

            <div class="form-group">
              <label for="startDate">Start Date</label>
              <input type="date" id="startDate" value="">
              <div class="help-text">First day of the schedule</div>
            </div>
          </div>

          <div class="row">
            <div class="form-group">
              <label for="intervalLength">Interval Length</label>
              <select id="intervalLength">
                <option value="15">15 minutes</option>
                <option value="30">30 minutes</option>
                <option value="45">45 minutes</option>
                <option value="60" selected>60 minutes</option>
              </select>
            </div>

            <div class="form-group">
              <label for="businessHours">Business Hours</label>
              <select id="businessHours">
                <option value="8_18">8:00 - 18:00 (10 hours)</option>
                <option value="9_17" selected>9:00 - 17:00 (8 hours)</option>
                <option value="8_20">8:00 - 20:00 (12 hours)</option>
                <option value="24">24/7 Operation</option>
                <option value="custom">Custom Hours</option>
              </select>
            </div>
          </div>

          <div id="customHoursSection" class="form-group" style="display: none;">
            <label>Custom Business Hours</label>
            <div class="row">
              <input type="time" id="customStart" value="08:00">
              <input type="time" id="customEnd" value="18:00">
            </div>
          </div>
        </div>

        <!-- Staff Pool Card -->
        <div class="cards-row">
          <div class="card">
            <div class="card-title">
              <h2>Staff Pool</h2>
              <span class="badge">Resources</span>
            </div>
            
            <div class="agent-summary" style="margin-bottom: 20px;">
              <div class="summary-card">
                <div class="value" id="totalAgentsCount">0</div>
                <div class="label">Total Agents</div>
              </div>
              <div class="summary-card">
                <div class="value" id="fullTimeCount">0</div>
                <div class="label">Full Time</div>
              </div>
              <div class="summary-card">
                <div class="value" id="partTimeCount">0</div>
                <div class="label">Part Time</div>
              </div>
              <div class="summary-card">
                <div class="value" id="activeCount">0</div>
                <div class="label">Active</div>
              </div>
            </div>

            <div class="form-group">
              <label for="skillLevel">Average Skill Level</label>
              <select id="skillLevel">
                <option value="0.8">Level 1 (Trainee)</option>
                <option value="1.0" selected>Level 2 (Standard)</option>
                <option value="1.2">Level 3 (Experienced)</option>
                <option value="1.5">Level 4 (Expert)</option>
              </select>
              <div class="help-text">Productivity multiplier</div>
            </div>

            <button id="manageStaffBtn" class="secondary">ðŸ‘¥ Go to Agent Management</button>
          </div>

          <div class="card">
            <div class="card-title">
              <h2>Shift Patterns</h2>
              <span class="badge">Work Hours</span>
            </div>
            
            <div class="form-group">
              <label for="shiftPattern">Primary Shift Pattern</label>
              <select id="shiftPattern">
                <option value="8x5">8x5 (8hrs, 5 days/week)</option>
                <option value="9x5" selected>9x5 (9hrs, 5 days/week)</option>
                <option value="10x4">10x4 (10hrs, 4 days/week)</option>
                <option value="12x3">12x3 (12hrs, 3 days/week)</option>
                <option value="custom">Custom Pattern</option>
              </select>
            </div>

            <div class="form-group">
              <label for="lunchDuration">Lunch Duration (minutes)</label>
              <input type="number" id="lunchDuration" min="15" max="120" value="60" step="15">
              <div class="help-text">Duration of lunch break for each agent</div>
            </div>

            <div class="form-group">
              <label for="breakFrequency">Break Frequency (hours)</label>
              <input type="number" id="breakFrequency" min="1" max="4" value="2" step="0.5">
              <div class="help-text">Breaks scheduled every X hours</div>
            </div>
          </div>
        </div>

        <!-- Scheduling Rules Card -->
        <div class="card">
          <div class="card-title">
            <h2>Scheduling Rules</h2>
            <span class="badge">Optimization</span>
          </div>
          
          <div class="rule-group">
            <div class="rule-item">
              <input type="checkbox" id="ruleBestFit" checked>
              <div>
                <div class="rule-label">Best Fit to Requirements</div>
                <div class="rule-description">Match staff as closely as possible to forecasted requirements</div>
              </div>
            </div>
            
            <div class="rule-item active">
              <input type="checkbox" id="ruleEvenSpread" checked>
              <div>
                <div class="rule-label">Even Workload Spread</div>
                <div class="rule-description">Distribute workload evenly across staff and time periods</div>
              </div>
            </div>
            
            <div class="rule-item">
              <input type="checkbox" id="ruleMinGaps">
              <div>
                <div class="rule-label">Minimize Schedule Gaps</div>
                <div class="rule-description">Reduce idle time between shifts</div>
              </div>
            </div>
            
            <div class="rule-item">
              <input type="checkbox" id="ruleRespectPreferences">
              <div>
                <div class="rule-label">Respect Staff Preferences</div>
                <div class="rule-description">Consider staff availability and shift preferences</div>
              </div>
            </div>
            
            <div class="rule-item">
              <input type="checkbox" id="ruleAvoidOvertime">
              <div>
                <div class="rule-label">Minimize Overtime</div>
                <div class="rule-description">Avoid overtime hours when possible</div>
              </div>
            </div>
            
            <!-- Add Overtime Opportunities Rule -->
            <div class="rule-item">
              <input type="checkbox" id="ruleOvertimeOpportunities" checked>
              <div>
                <div class="rule-label">Generate Overtime Opportunities</div>
                <div class="rule-description">Create overtime slots for coverage shortfalls</div>
              </div>
            </div>
          </div>

          <div class="row-3">
            <div class="form-group">
              <label for="maxConsecutiveDays">Max Consecutive Days</label>
              <input type="number" id="maxConsecutiveDays" min="1" max="7" value="5">
              <div class="help-text">Maximum days without a day off</div>
            </div>

            <div class="form-group">
              <label for="minHoursBetweenShifts">Min Hours Between Shifts</label>
              <input type="number" id="minHoursBetweenShifts" min="8" max="24" value="10">
              <div class="help-text">Minimum rest between shifts</div>
            </div>

            <div class="form-group">
              <label for="maxWeeklyHours">Max Weekly Hours</label>
              <input type="number" id="maxWeeklyHours" min="20" max="60" value="40">
              <div class="help-text">Maximum hours per week per staff</div>
            </div>
          </div>
        </div>

        <!-- Forecast Import Card -->
        <div class="card">
          <div class="card-title">
            <h2>Forecast Requirements</h2>
            <span class="badge">Demand</span>
          </div>
          
          <div class="form-group">
            <label for="forecastSource">Forecast Source</label>
            <select id="forecastSource">
              <option value="manual">Manual Input</option>
              <option value="import" selected>Import from Forecast Tool</option>
              <option value="historical">Historical Patterns</option>
            </select>
          </div>

          <div id="manualForecastSection" class="form-group" style="display: none;">
            <label>Daily Requirements</label>
            <div class="row-3">
              <input type="number" placeholder="Mon" value="15">
              <input type="number" placeholder="Tue" value="18">
              <input type="number" placeholder="Wed" value="20">
              <input type="number" placeholder="Thu" value="22">
              <input type="number" placeholder="Fri" value="25">
              <input type="number" placeholder="Sat" value="12">
              <input type="number" placeholder="Sun" value="8">
            </div>
          </div>

          <div id="importForecastSection">
            <div class="form-group">
              <label for="forecastFile">Upload Forecast CSV</label>
              <input type="file" id="forecastFile" accept=".csv">
              <div class="help-text">Format: date, time, queue, required_staff</div>
            </div>
          </div>

          <div class="note">
            <strong>Note:</strong> Schedule will be generated based on forecast requirements and configured rules.
          </div>
        </div>

        <!-- Generate Schedule Card -->
        <div class="card">
          <div class="card-title">
            <h2>Generate Schedule</h2>
            <span class="badge">Calculate</span>
          </div>
          
          <div class="btn-group">
            <button id="generateScheduleBtn" class="primary">ðŸ“… Generate Schedule</button>
            <button id="optimizeScheduleBtn" class="secondary">âš¡ Optimize Schedule</button>
            <button id="clearScheduleBtn" class="secondary">Clear Schedule</button>
          </div>

          <div class="progress-bar" id="progressBar" style="display: none;">
            <div class="progress-fill" id="progressFill" style="width: 0%;"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Agent Management Tab -->
    <div id="agentsTab" class="tab-content">
      <div class="card">
        <div class="card-title">
          <h2>Agent Management</h2>
          <span class="badge">Profiles</span>
        </div>
        
        <!-- Search and Filter Bar -->
        <div class="search-filter-bar">
          <div class="search-box">
            <label for="searchInput">Search Agents</label>
            <input type="text" id="searchInput" placeholder="Search by name, department, skills...">
          </div>
          <div class="filter-select">
            <label for="departmentFilter">Department</label>
            <select id="departmentFilter">
              <option value="all">All Departments</option>
              <option value="Customer Service">Customer Service</option>
              <option value="Technical Support">Technical Support</option>
              <option value="Sales">Sales</option>
              <option value="Billing">Billing</option>
            </select>
          </div>
          <div class="filter-select">
            <label for="statusFilter">Status</label>
            <select id="statusFilter">
              <option value="all">All Status</option>
              <option value="active">Active</option>
              <option value="inactive">Inactive</option>
            </select>
          </div>
          <div style="align-self: flex-end;">
            <button id="addAgentBtn" class="primary icon-btn">
              <i class="fas fa-user-plus"></i> Add New Agent
            </button>
          </div>
        </div>

        <!-- Agent Profiles Table -->
        <div class="table-container">
          <table id="agentsTable">
            <thead>
              <tr>
                <th>Name</th>
                <th>Department</th>
                <th>Skills</th>
                <th>Queues</th>
                <th>Full/Part Time</th>
                <th>Contracted Hours</th>
                <th>Start Date</th>
                <th>End Date</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="agentsTableBody">
              <!-- Agent rows will be populated by JavaScript -->
            </tbody>
          </table>
        </div>
        
        <div class="note">
          <strong><i class="fas fa-info-circle"></i> How to use:</strong> 
          Click the edit icon <i class="fas fa-edit" style="color: #3b82f6;"></i> to modify an agent's profile. 
          Click the delete icon <i class="fas fa-trash" style="color: #ef4444;"></i> to remove an agent. 
          Use the search and filters above to find specific agents.
        </div>
      </div>
    </div>

    <!-- Schedule View Tab -->
    <div id="scheduleViewTab" class="tab-content">
      <div class="schedule-view-container">
        <div class="schedule-header">
          <h2>Daily Schedule View</h2>
          <div class="schedule-controls">
            <div class="date-navigation">
              <button id="prevDayBtn" class="secondary">â—€ Prev</button>
              <span id="currentDateDisplay" style="padding: 0 15px; font-weight: 600;">Monday, 5 Feb 2024</span>
              <button id="nextDayBtn" class="secondary">Next â–¶</button>
            </div>
            <div class="interval-selector">
              <div class="interval-buttons">
                <button class="interval-btn" data-interval="15">15m</button>
                <button class="interval-btn" data-interval="30">30m</button>
                <button class="interval-btn" data-interval="45">45m</button>
                <button class="interval-btn active" data-interval="60">60m</button>
              </div>
            </div>
            <div style="display: flex; gap: 10px;">
              <button id="saveChangesBtn" class="secondary" style="display: none;">ðŸ’¾ Save Changes</button>
              <button id="publishBtn" class="primary">ðŸ“¤ Publish Schedule</button>
            </div>
          </div>
        </div>

        <!-- Net Staffing Ribbon -->
        <div class="net-staffing-ribbon">
          <div class="ribbon-header">
            <h3>ðŸ“Š Net Staffing (Required vs Scheduled)</h3>
            <div class="ribbon-stats">
              <div class="stat-item">
                <div class="stat-value net-balanced" id="ribbonBalanced">0</div>
                <div class="stat-label">Balanced</div>
              </div>
              <div class="stat-item">
                <div class="stat-value net-overstaffed" id="ribbonOverstaffed">0</div>
                <div class="stat-label">Overstaffed</div>
              </div>
              <div class="stat-item">
                <div class="stat-value net-understaffed" id="ribbonUnderstaffed">0</div>
                <div class="stat-label">Understaffed</div>
              </div>
              <div class="stat-item">
                <div class="stat-value net-overtime" id="ribbonOvertimeOpp">0</div>
                <div class="stat-label">Overtime Opps</div>
              </div>
            </div>
          </div>
          <div class="ribbon-visual" id="netStaffingGrid">
            <!-- Net staffing cells will be generated here -->
          </div>
        </div>

        <div class="summary-tiles">
          <div class="tile">
            <div class="label">Scheduled Hours</div>
            <div class="value" id="resultScheduledHours">â€”</div>
            <div class="subtext">Total staff hours</div>
          </div>
          <div class="tile">
            <div class="label">Utilization</div>
            <div class="value" id="resultUtilization">â€”</div>
            <div class="subtext">Effectiveness rate</div>
          </div>
          <div class="tile">
            <div class="label">Coverage Gaps</div>
            <div class="value" id="resultCoverageGaps">â€”</div>
            <div class="subtext">Hours understaffed</div>
          </div>
          <div class="tile">
            <div class="label">Overtime Hours</div>
            <div class="value" id="resultOvertime">â€”</div>
            <div class="subtext">Additional hours</div>
          </div>
        </div>

        <!-- Daily Schedule Grid -->
        <div class="daily-schedule-container">
          <div class="daily-schedule-grid" id="dailyScheduleGrid">
            <!-- Traditional WFM schedule grid will be generated here -->
          </div>
        </div>

        <!-- Overtime Opportunities Section -->
        <div class="overtime-opportunities" id="overtimeOpportunities" style="display: none;">
          <h4>ðŸ“Š Overtime Opportunities Identified</h4>
          <div class="opportunities-list" id="opportunitiesList">
            <!-- Overtime opportunities will be listed here -->
          </div>
        </div>

        <!-- Schedule Legend -->
        <div style="display: flex; gap: 20px; margin: 20px 0; flex-wrap: wrap;">
          <div style="display: flex; align-items: center; gap: 8px;">
            <div class="schedule-activity-cell on-queue" style="min-height: 20px; min-width: 30px;">In</div>
            <span style="font-size: 12px;">On Queue</span>
          </div>
          <div style="display: flex; align-items: center; gap: 8px;">
            <div class="schedule-activity-cell break" style="min-height: 20px; min-width: 30px;">B</div>
            <span style="font-size: 12px;">Break</span>
          </div>
          <div style="display: flex; align-items: center; gap: 8px;">
            <div class="schedule-activity-cell lunch" style="min-height: 20px; min-width: 30px;">L</div>
            <span style="font-size: 12px;">Lunch</span>
          </div>
          <div style="display: flex; align-items: center; gap: 8px;">
            <div class="schedule-activity-cell meeting" style="min-height: 20px; min-width: 30px;">M</div>
            <span style="font-size: 12px;">Meeting</span>
          </div>
          <div style="display: flex; align-items: center; gap: 8px;">
            <div class="schedule-activity-cell coaching" style="min-height: 20px; min-width: 30px;">C</div>
            <span style="font-size: 12px;">Coaching</span>
          </div>
          <div style="display: flex; align-items: center; gap: 8px;">
            <div class="schedule-activity-cell overtime-opportunity" style="min-height: 20px; min-width: 30px;">OT</div>
            <span style="font-size: 12px;">Overtime Opp</span>
          </div>
        </div>

        <!-- Staff Assignments Table -->
        <div class="assignments-table">
          <table id="assignmentsTable">
            <thead>
              <tr>
                <th>Staff ID</th>
                <th>Name</th>
                <th class="center">Department</th>
                <th class="center">Skills</th>
                <th class="center">Scheduled Hours</th>
                <th class="center">Shift Pattern</th>
                <th class="center">Days Working</th>
                <th class="center">Status</th>
              </tr>
            </thead>
            <tbody id="assignmentsTableBody">
              <tr>
                <td colspan="8" class="center" style="padding: 40px; color: var(--text-light);">
                  No schedule generated yet. Click "Generate Schedule" to create assignments.
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="note" style="margin-top: 20px;">
          <strong>Schedule Health:</strong> Green indicates adequate coverage, yellow shows minor gaps, red indicates significant understaffing. Overtime opportunities are highlighted in striped orange.
        </div>
      </div>
    </div>

    <!-- Footer -->
    <div class="footer">
      <p>WFM Scheduling Tool v1.0 | Rule-based scheduling with optimization algorithms</p>
      <p>For support or questions, contact your WFM administrator</p>
    </div>
  </div>

  <!-- Modal for Add/Edit Agent -->
  <div id="agentModal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <h2><i class="fas fa-user-edit"></i> <span id="modalTitle">Add New Agent</span></h2>
        <button class="modal-close" id="modalCloseBtn">&times;</button>
      </div>
      <div class="modal-body">
        <form id="agentForm">
          <div class="row">
            <div class="form-group">
              <label for="agentName">Full Name *</label>
              <input type="text" id="agentName" required>
            </div>
            <div class="form-group">
              <label for="agentDepartment">Department *</label>
              <select id="agentDepartment" required>
                <option value="">Select Department</option>
                <option value="Customer Service">Customer Service</option>
                <option value="Technical Support">Technical Support</option>
                <option value="Sales">Sales</option>
                <option value="Billing">Billing</option>
                <option value="Retention">Retention</option>
                <option value="Social Media">Social Media</option>
              </select>
            </div>
          </div>
          
          <div class="row">
            <div class="form-group">
              <label for="agentEmployment">Employment Type *</label>
              <select id="agentEmployment" required>
                <option value="">Select Type</option>
                <option value="Full Time">Full Time</option>
                <option value="Part Time">Part Time</option>
                <option value="Contractor">Contractor</option>
              </select>
            </div>
            <div class="form-group">
              <label for="agentHours">Contracted Hours (per week) *</label>
              <input type="number" id="agentHours" min="10" max="50" step="0.5" required>
            </div>
          </div>
          
          <div class="row">
            <div class="form-group">
              <label for="agentStartDate">Start Date *</label>
              <input type="date" id="agentStartDate" required>
            </div>
            <div class="form-group">
              <label for="agentEndDate">End Date (if applicable)</label>
              <input type="date" id="agentEndDate">
            </div>
          </div>
          
          <div class="form-group">
            <label>Skills *</label>
            <div class="multi-select-container" style="grid-template-columns: 1fr 1fr; gap: 20px; display: grid;">
              <div class="select-group">
                <h4>Technical Skills</h4>
                <div class="checkbox-group" style="max-height: 150px; overflow-y: auto;">
                  <div class="checkbox-item">
                    <input type="checkbox" id="skillChat" value="Chat Support">
                    <label for="skillChat">Chat Support</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="skillEmail" value="Email Support">
                    <label for="skillEmail">Email Support</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="skillPhone" value="Phone Support">
                    <label for="skillPhone">Phone Support</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="skillSocial" value="Social Media">
                    <label for="skillSocial">Social Media</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="skillTechnical" value="Technical Troubleshooting">
                    <label for="skillTechnical">Technical Troubleshooting</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="skillBilling" value="Billing Support">
                    <label for="skillBilling">Billing Support</label>
                  </div>
                </div>
              </div>
              
              <div class="select-group">
                <h4>Soft Skills</h4>
                <div class="checkbox-group" style="max-height: 150px; overflow-y: auto;">
                  <div class="checkbox-item">
                    <input type="checkbox" id="skillSales" value="Sales">
                    <label for="skillSales">Sales</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="skillRetention" value="Retention">
                    <label for="skillRetention">Retention</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="skillEscalation" value="Escalation Handling">
                    <label for="skillEscalation">Escalation Handling</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="skillMultilingual" value="Multilingual">
                    <label for="skillMultilingual">Multilingual</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="skillTraining" value="Training">
                    <label for="skillTraining">Training</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="skillQuality" value="Quality Assurance">
                    <label for="skillQuality">Quality Assurance</label>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="form-group">
            <label>Queues *</label>
            <div class="multi-select-container" style="grid-template-columns: 1fr 1fr; gap: 20px; display: grid;">
              <div class="select-group">
                <h4>Primary Queues</h4>
                <div class="checkbox-group" style="max-height: 150px; overflow-y: auto;">
                  <div class="checkbox-item">
                    <input type="checkbox" id="queueGeneral" value="General Inquiries">
                    <label for="queueGeneral">General Inquiries</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="queueTechnical" value="Technical Support">
                    <label for="queueTechnical">Technical Support</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="queueSales" value="Sales">
                    <label for="queueSales">Sales</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="queueBilling" value="Billing">
                    <label for="queueBilling">Billing</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="queueRetention" value="Retention">
                    <label for="queueRetention">Retention</label>
                  </div>
                </div>
              </div>
              
              <div class="select-group">
                <h4>Specialty Queues</h4>
                <div class="checkbox-group" style="max-height: 150px; overflow-y: auto;">
                  <div class="checkbox-item">
                    <input type="checkbox" id="queueEscalation" value="Escalations">
                    <label for="queueEscalation">Escalations</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="queueSocial" value="Social Media">
                    <label for="queueSocial">Social Media</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="queueVIP" value="VIP Support">
                    <label for="queueVIP">VIP Support</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="queueBackoffice" value="Back Office">
                    <label for="queueBackoffice">Back Office</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="queueChat" value="Chat Only">
                    <label for="queueChat">Chat Only</label>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="btn-group">
            <button type="submit" class="primary icon-btn">
              <i class="fas fa-save"></i> Save Agent
            </button>
            <button type="button" class="secondary" id="cancelModalBtn">
              Cancel
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Publish Schedule Modal -->
  <div id="publishModal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <h2>ðŸ“¤ Publish Schedule</h2>
        <button class="modal-close" id="publishModalCloseBtn">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>Select publish option:</label>
          
          <div class="publish-option" data-option="current">
            <div>
              <input type="radio" name="publishOption" value="current" id="publishCurrent" checked>
              <label for="publishCurrent" style="display: inline;">
                <div class="publish-option-title">Current Day Only</div>
              </label>
            </div>
            <div class="publish-option-description">Publish schedule for the currently displayed day</div>
          </div>
          
          <div class="publish-option" data-option="all">
            <div>
              <input type="radio" name="publishOption" value="all" id="publishAll">
              <label for="publishAll" style="display: inline;">
                <div class="publish-option-title">All Days</div>
              </label>
            </div>
            <div class="publish-option-description">Publish the entire generated schedule period</div>
          </div>
          
          <div class="publish-option" data-option="range">
            <div>
              <input type="radio" name="publishOption" value="range" id="publishRange">
              <label for="publishRange" style="display: inline;">
                <div class="publish-option-title">Date Range</div>
              </label>
            </div>
            <div class="publish-option-description">Select specific start and end dates</div>
            <div class="date-range-inputs" id="dateRangeInputs">
              <div class="row">
                <div class="form-group">
                  <label for="publishStartDate">Start Date</label>
                  <input type="date" id="publishStartDate">
                </div>
                <div class="form-group">
                  <label for="publishEndDate">End Date</label>
                  <input type="date" id="publishEndDate">
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="note">
          <strong>âš ï¸ Important:</strong> Publishing will make the schedule available to all agents and managers. Ensure all changes have been saved before publishing.
        </div>
        
        <div class="btn-group">
          <button id="confirmPublishBtn" class="primary">âœ… Confirm & Publish</button>
          <button id="cancelPublishBtn" class="secondary">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Save Indicator -->
  <div class="save-indicator" id="saveIndicator">
    <span class="save-indicator-icon">âœ…</span>
    <span class="save-indicator-text">Changes saved</span>
  </div>

  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <script>
    // ====== DOM ELEMENTS ======
    // Schedule View
    const scheduleStatus = document.getElementById('scheduleStatus');
    const generateScheduleBtn = document.getElementById('generateScheduleBtn');
    const progressBar = document.getElementById('progressBar');
    const progressFill = document.getElementById('progressFill');
    const dailyScheduleGrid = document.getElementById('dailyScheduleGrid');
    const prevDayBtn = document.getElementById('prevDayBtn');
    const nextDayBtn = document.getElementById('nextDayBtn');
    const currentDateDisplay = document.getElementById('currentDateDisplay');
    const intervalButtons = document.querySelectorAll('.interval-btn');
    const saveChangesBtn = document.getElementById('saveChangesBtn');
    const publishBtn = document.getElementById('publishBtn');
    const netStaffingGrid = document.getElementById('netStaffingGrid');
    const publishModal = document.getElementById('publishModal');
    const publishModalCloseBtn = document.getElementById('publishModalCloseBtn');
    const confirmPublishBtn = document.getElementById('confirmPublishBtn');
    const cancelPublishBtn = document.getElementById('cancelPublishBtn');
    const saveIndicator = document.getElementById('saveIndicator');

    // Tabs
    const tabs = document.querySelectorAll('.tab');
    const tabContents = document.querySelectorAll('.tab-content');

    // ====== SCHEDULE DATA ======
    let scheduleData = {
      requirements: [],
      staff: [],
      assignments: [],
      generatedSchedule: null,
      currentDayIndex: 0,
      totalDays: 0,
      currentInterval: 60,
      agentSchedules: [],
      netStaffing: [],
      overtimeOpportunities: [],
      hasUnsavedChanges: false,
      modifiedCells: new Set()
    };

    // ====== AGENT MANAGEMENT ======
    // (Your existing agent management code remains unchanged)
    // Agent data storage
    let agents = [];
    let currentEditId = null;

    // Available skills and queues
    const allSkills = [
      'Chat Support', 'Email Support', 'Phone Support', 'Social Media',
      'Technical Troubleshooting', 'Billing Support', 'Sales', 'Retention',
      'Escalation Handling', 'Multilingual', 'Training', 'Quality Assurance'
    ];

    const allQueues = [
      'General Inquiries', 'Technical Support', 'Sales', 'Billing', 'Retention',
      'Escalations', 'Social Media', 'VIP Support', 'Back Office', 'Chat Only'
    ];

    // Initialize with hardcoded agents
    function initializeAgents() {
      const today = new Date();
      const oneYearAgo = new Date();
      oneYearAgo.setFullYear(today.getFullYear() - 1);
      
      const sixMonthsFromNow = new Date();
      sixMonthsFromNow.setMonth(today.getMonth() + 6);
      
      agents = [
        {
          id: 1,
          name: 'John Thompson',
          department: 'Customer Service',
          skills: ['Phone Support', 'Email Support', 'Chat Support', 'Multilingual'],
          queues: ['General Inquiries', 'Technical Support', 'Escalations'],
          employmentType: 'Full Time',
          contractedHours: 40,
          startDate: formatDate(oneYearAgo),
          endDate: '',
          status: 'active'
        },
        {
          id: 2,
          name: 'Sasha Smith',
          department: 'Technical Support',
          skills: ['Technical Troubleshooting', 'Chat Support', 'Email Support', 'Escalation Handling'],
          queues: ['Technical Support', 'Escalations', 'VIP Support'],
          employmentType: 'Full Time',
          contractedHours: 40,
          startDate: formatDate(new Date(oneYearAgo.getFullYear(), oneYearAgo.getMonth() - 3, 15)),
          endDate: '',
          status: 'active'
        },
        {
          id: 3,
          name: 'Liam Cooper',
          department: 'Sales',
          skills: ['Sales', 'Phone Support', 'Retention', 'Chat Support'],
          queues: ['Sales', 'Retention', 'VIP Support'],
          employmentType: 'Full Time',
          contractedHours: 37.5,
          startDate: formatDate(new Date(oneYearAgo.getFullYear(), oneYearAgo.getMonth() - 8, 1)),
          endDate: '',
          status: 'active'
        },
        {
          id: 4,
          name: 'Ethan Reynolds',
          department: 'Billing',
          skills: ['Billing Support', 'Email Support', 'Phone Support', 'Technical Troubleshooting'],
          queues: ['Billing', 'Technical Support', 'General Inquiries'],
          employmentType: 'Part Time',
          contractedHours: 25,
          startDate: formatDate(new Date(oneYearAgo.getFullYear(), oneYearAgo.getMonth() - 5, 20)),
          endDate: formatDate(sixMonthsFromNow),
          status: 'active'
        },
        {
          id: 5,
          name: 'Ava Mitchell',
          department: 'Social Media',
          skills: ['Social Media', 'Chat Support', 'Email Support', 'Multilingual'],
          queues: ['Social Media', 'Chat Only', 'General Inquiries'],
          employmentType: 'Full Time',
          contractedHours: 40,
          startDate: formatDate(new Date(today.getFullYear(), today.getMonth() - 2, 10)),
          endDate: '',
          status: 'active'
        }
      ];
    }

    // ====== NEW FUNCTIONS FOR DAILY VIEW ======

    // Navigate to previous day
    function navigatePrevDay() {
      if (scheduleData.currentDayIndex > 0) {
        scheduleData.currentDayIndex--;
        updateDateDisplay();
        renderDailySchedule();
        renderNetStaffing();
      }
    }

    // Navigate to next day
    function navigateNextDay() {
      if (scheduleData.currentDayIndex < scheduleData.totalDays - 1) {
        scheduleData.currentDayIndex++;
        updateDateDisplay();
        renderDailySchedule();
        renderNetStaffing();
      }
    }

    // Update date display
    function updateDateDisplay() {
      if (!scheduleData.generatedSchedule || scheduleData.currentDayIndex >= scheduleData.generatedSchedule.days.length) {
        currentDateDisplay.textContent = 'No date selected';
        return;
      }
      
      const currentDay = scheduleData.generatedSchedule.days[scheduleData.currentDayIndex];
      currentDateDisplay.textContent = formatFullDate(currentDay.date);
    }

    // Format date for full display
    function formatFullDate(date) {
      const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
      const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
      return `${days[date.getDay()]}, ${date.getDate()} ${months[date.getMonth()]} ${date.getFullYear()}`;
    }

    // Format date for input fields
    function formatDate(date) {
      if (!date) return '';
      const year = date.getFullYear();
      const month = (date.getMonth() + 1).toString().padStart(2, '0');
      const day = date.getDate().toString().padStart(2, '0');
      return `${year}-${month}-${day}`;
    }

    // Render net staffing ribbon
    function renderNetStaffing() {
      if (!scheduleData.netStaffing || scheduleData.currentDayIndex >= scheduleData.netStaffing.length) {
        netStaffingGrid.innerHTML = '<div style="padding: 20px; text-align: center; color: var(--text-light);">No net staffing data available</div>';
        return;
      }
      
      netStaffingGrid.innerHTML = '';
      
      const dayNetStaffing = scheduleData.netStaffing[scheduleData.currentDayIndex];
      const intervalLength = scheduleData.currentInterval;
      const config = collectConfiguration();
      
      // Filter to show only business hours
      const businessStart = config.businessHours.start;
      const businessEnd = config.businessHours.end;
      const intervalsPerHour = 60 / intervalLength;
      
      dayNetStaffing.forEach(interval => {
        const hour = Math.floor((interval.intervalIndex * intervalLength) / 60);
        
        // Only show business hours
        if (hour < businessStart || hour >= businessEnd) return;
        
        const cell = document.createElement('div');
        cell.className = `ribbon-segment`;
        
        // Set color based on status
        if (interval.status === 'balanced') {
          cell.style.background = '#10b981';
        } else if (interval.status === 'overstaffed') {
          cell.style.background = '#3b82f6';
        } else if (interval.status === 'understaffed') {
          cell.style.background = '#ef4444';
        }
        
        const minute = (interval.intervalIndex * intervalLength) % 60;
        const timeLabel = `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
        
        const tooltip = document.createElement('div');
        tooltip.className = 'ribbon-tooltip';
        tooltip.textContent = `${timeLabel}: ${interval.net >= 0 ? '+' + interval.net : interval.net} (${interval.assigned}/${interval.required})`;
        cell.appendChild(tooltip);
        
        netStaffingGrid.appendChild(cell);
      });
      
      // Update ribbon stats
      if (dayNetStaffing.length > 0) {
        const stats = {
          balanced: dayNetStaffing.filter(i => i.status === 'balanced').length,
          overstaffed: dayNetStaffing.filter(i => i.status === 'overstaffed').length,
          understaffed: dayNetStaffing.filter(i => i.status === 'understaffed').length,
          overtimeOpp: dayNetStaffing.filter(i => i.net < 0 && i.required > 0).length
        };
        
        document.getElementById('ribbonBalanced').textContent = stats.balanced;
        document.getElementById('ribbonOverstaffed').textContent = stats.overstaffed;
        document.getElementById('ribbonUnderstaffed').textContent = stats.understaffed;
        document.getElementById('ribbonOvertimeOpp').textContent = stats.overtimeOpp;
      }
    }

    // Render daily schedule grid (traditional WFM format)
    function renderDailySchedule() {
      if (!scheduleData.agentSchedules || scheduleData.agentSchedules.length === 0) {
        dailyScheduleGrid.innerHTML = '<div style="padding: 40px; text-align: center; color: var(--text-light);">No schedule generated yet. Click "Generate Schedule" to create assignments.</div>';
        return;
      }
      
      dailyScheduleGrid.innerHTML = '';
      
      const intervalLength = scheduleData.currentInterval;
      const config = collectConfiguration();
      const businessStart = config.businessHours.start;
      const businessEnd = config.businessHours.end;
      const intervalsPerHour = 60 / intervalLength;
      const totalIntervals = (businessEnd - businessStart) * intervalsPerHour;
      
      // Create header row
      const headerRow = document.createElement('div');
      headerRow.className = 'schedule-grid-header';
      
      const timeHeader = document.createElement('div');
      timeHeader.className = 'schedule-time-header';
      timeHeader.textContent = 'Agent Name';
      headerRow.appendChild(timeHeader);
      
      // Add interval headers for business hours only
      for (let hour = businessStart; hour < businessEnd; hour++) {
        for (let interval = 0; interval < intervalsPerHour; interval++) {
          const minute = interval * intervalLength;
          const intervalHeader = document.createElement('div');
          intervalHeader.className = 'schedule-interval-header';
          intervalHeader.textContent = `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
          headerRow.appendChild(intervalHeader);
        }
      }
      
      dailyScheduleGrid.appendChild(headerRow);
      
      // Create agent rows
      const currentDayIndex = scheduleData.currentDayIndex;
      const overtimeSlots = scheduleData.generatedSchedule?.days[currentDayIndex]?.overtimeSlots || [];
      
      scheduleData.agentSchedules.forEach(agentSchedule => {
        if (currentDayIndex >= agentSchedule.schedule.length) return;
        
        const daySchedule = agentSchedule.schedule[currentDayIndex];
        const row = document.createElement('div');
        row.className = 'schedule-agent-row';
        
        const agentName = document.createElement('div');
        agentName.className = 'schedule-agent-name';
        agentName.textContent = agentSchedule.agentName;
        row.appendChild(agentName);
        
        // Add activity cells for business hours
        for (let hour = businessStart; hour < businessEnd; hour++) {
          for (let interval = 0; interval < intervalsPerHour; interval++) {
            const minute = interval * intervalLength;
            const totalMinutes = hour * 60 + minute;
            const intervalIndex = totalMinutes / intervalLength;
            const currentTime = hour + (minute / 60);
            
            const cell = document.createElement('div');
            cell.className = 'schedule-activity-cell';
            cell.dataset.agent = agentSchedule.agentId;
            cell.dataset.interval = intervalIndex;
            
            // Find activity at this time
            const activity = daySchedule.activities.find(act => 
              act.start <= currentTime && act.end > currentTime
            );
            
            if (activity) {
              if (activity.type === 'inbound') {
                cell.classList.add('on-queue');
                cell.textContent = 'In';
              } else if (activity.type === 'break') {
                cell.classList.add('break');
                cell.textContent = 'B';
              } else if (activity.type === 'lunch') {
                cell.classList.add('lunch');
                cell.textContent = 'L';
              } else if (activity.type === 'meeting') {
                cell.classList.add('meeting');
                cell.textContent = 'M';
              } else if (activity.type === 'coaching') {
                cell.classList.add('coaching');
                cell.textContent = 'C';
              }
              
              // Check if cell was modified
              const cellKey = `${agentSchedule.agentId}-${currentDayIndex}-${intervalIndex}`;
              if (scheduleData.modifiedCells.has(cellKey)) {
                cell.classList.add('modified');
              }
            } else if (!daySchedule.working) {
              cell.classList.add('off');
              cell.textContent = '';
            }
            
            // Check if this interval has overtime opportunities
            const hasOvertimeOpp = overtimeSlots.some(slot => 
              Math.abs(slot.intervalIndex - intervalIndex) < 0.5
            );
            
            if (hasOvertimeOpp && !activity) {
              cell.classList.add('overtime-opportunity');
              cell.innerHTML = 'OT<span class="overtime-badge">!</span>';
            }
            
            // Make cell clickable
            cell.addEventListener('click', () => handleCellClick(agentSchedule.agentId, currentDayIndex, intervalIndex, cell));
            
            row.appendChild(cell);
          }
        }
        
        dailyScheduleGrid.appendChild(row);
      });
    }

    // Handle cell click for editing
    function handleCellClick(agentId, dayIndex, intervalIndex, cell) {
      const activities = ['On Queue', 'Break', 'Lunch', 'Meeting', 'Coaching', 'Off'];
      const currentActivity = cell.textContent.replace('OT!', '').trim();
      
      let nextActivityIndex = 0;
      if (currentActivity === 'In') nextActivityIndex = 0;
      else if (currentActivity === 'B') nextActivityIndex = 1;
      else if (currentActivity === 'L') nextActivityIndex = 2;
      else if (currentActivity === 'M') nextActivityIndex = 3;
      else if (currentActivity === 'C') nextActivityIndex = 4;
      else nextActivityIndex = 5;
      
      nextActivityIndex = (nextActivityIndex + 1) % activities.length;
      const nextActivity = activities[nextActivityIndex];
      
      // Update cell appearance
      cell.className = 'schedule-activity-cell modified';
      cell.innerHTML = '';
      
      if (nextActivity === 'On Queue') {
        cell.classList.add('on-queue');
        cell.textContent = 'In';
      } else if (nextActivity === 'Break') {
        cell.classList.add('break');
        cell.textContent = 'B';
      } else if (nextActivity === 'Lunch') {
        cell.classList.add('lunch');
        cell.textContent = 'L';
      } else if (nextActivity === 'Meeting') {
        cell.classList.add('meeting');
        cell.textContent = 'M';
      } else if (nextActivity === 'Coaching') {
        cell.classList.add('coaching');
        cell.textContent = 'C';
      } else if (nextActivity === 'Off') {
        cell.classList.add('off');
        cell.textContent = '';
      }
      
      // Track modification
      const cellKey = `${agentId}-${dayIndex}-${intervalIndex}`;
      scheduleData.modifiedCells.add(cellKey);
      scheduleData.hasUnsavedChanges = true;
      
      // Show save button
      saveChangesBtn.style.display = 'inline-block';
    }

    // Save changes
    function saveChanges() {
      if (!scheduleData.hasUnsavedChanges) {
        showSaveIndicator('No changes to save');
        return;
      }
      
      // In a real application, this would save to a backend
      console.log('Saving changes...', Array.from(scheduleData.modifiedCells));
      
      scheduleData.hasUnsavedChanges = false;
      saveChangesBtn.style.display = 'none';
      
      showSaveIndicator('Changes saved successfully');
      updateStatus('Schedule changes saved');
    }

    // Show save indicator
    function showSaveIndicator(message) {
      const indicator = document.getElementById('saveIndicator');
      const textEl = indicator.querySelector('.save-indicator-text');
      textEl.textContent = message;
      
      indicator.classList.add('show');
      
      setTimeout(() => {
        indicator.classList.remove('show');
      }, 3000);
    }

    // Show publish modal
    function showPublishModal() {
      if (!scheduleData.generatedSchedule) {
        alert('Please generate a schedule first.');
        return;
      }
      
      if (scheduleData.hasUnsavedChanges) {
        if (!confirm('You have unsaved changes. Do you want to save them before publishing?')) {
          return;
        }
        saveChanges();
      }
      
      // Set date range defaults
      const firstDay = scheduleData.generatedSchedule.days[0].date;
      const lastDay = scheduleData.generatedSchedule.days[scheduleData.totalDays - 1].date;
      
      document.getElementById('publishStartDate').value = formatDate(firstDay);
      document.getElementById('publishEndDate').value = formatDate(lastDay);
      
      publishModal.style.display = 'flex';
    }

    // Hide publish modal
    function hidePublishModal() {
      publishModal.style.display = 'none';
    }

    // Handle publish option selection
    document.querySelectorAll('.publish-option').forEach(option => {
      option.addEventListener('click', function() {
        const radio = this.querySelector('input[type="radio"]');
        radio.checked = true;
        
        document.querySelectorAll('.publish-option').forEach(opt => opt.classList.remove('selected'));
        this.classList.add('selected');
        
        // Show/hide date range inputs
        if (radio.value === 'range') {
          document.getElementById('dateRangeInputs').classList.add('active');
        } else {
          document.getElementById('dateRangeInputs').classList.remove('active');
        }
      });
    });

    // Confirm publish
    function confirmPublish() {
      const selectedOption = document.querySelector('input[name="publishOption"]:checked').value;
      
      let publishMessage = '';
      
      if (selectedOption === 'current') {
        const currentDay = scheduleData.generatedSchedule.days[scheduleData.currentDayIndex];
        publishMessage = `Publishing schedule for ${formatFullDate(currentDay.date)}`;
      } else if (selectedOption === 'all') {
        publishMessage = `Publishing entire schedule (${scheduleData.totalDays} days)`;
      } else if (selectedOption === 'range') {
        const startDate = document.getElementById('publishStartDate').value;
        const endDate = document.getElementById('publishEndDate').value;
        publishMessage = `Publishing schedule from ${formatDisplayDate(startDate)} to ${formatDisplayDate(endDate)}`;
      }
      
      // In a real application, this would publish to a backend
      console.log('Publishing:', selectedOption, publishMessage);
      
      hidePublishModal();
      showSaveIndicator('Schedule published successfully');
      updateStatus('Schedule published to agents and managers');
      
      alert(publishMessage + '\n\nSchedule has been successfully published!');
    }

    // Format date for display
    function formatDisplayDate(dateStr) {
      if (!dateStr) return 'â€”';
      const date = new Date(dateStr);
      return date.toLocaleDateString('en-GB', { day: 'numeric', month: 'short', year: 'numeric' });
    }

    // ====== UPDATED SCHEDULING ENGINE ======

    // Collect configuration
    function collectConfiguration() {
      const businessHours = document.getElementById('businessHours').value;
      
      let customHours = { start: 8, end: 18 };
      if (businessHours === 'custom') {
        const start = document.getElementById('customStart').value;
        const end = document.getElementById('customEnd').value;
        customHours.start = parseInt(start.split(':')[0]);
        customHours.end = parseInt(end.split(':')[0]);
      } else if (businessHours !== '24') {
        const [start, end] = businessHours.split('_');
        customHours.start = parseInt(start);
        customHours.end = parseInt(end);
      } else {
        customHours = { start: 0, end: 24 };
      }
      
      return {
        period: parseInt(document.getElementById('schedulePeriod').value),
        startDate: new Date(document.getElementById('startDate').value),
        intervalLength: parseInt(document.getElementById('intervalLength').value),
        businessHours: customHours
      };
    }

    // Collect rules
    function collectRules() {
      return {
        bestFit: document.getElementById('ruleBestFit').checked,
        evenSpread: document.getElementById('ruleEvenSpread').checked,
        minGaps: document.getElementById('ruleMinGaps').checked,
        respectPreferences: document.getElementById('ruleRespectPreferences').checked,
        avoidOvertime: document.getElementById('ruleAvoidOvertime').checked,
        overtimeOpportunities: document.getElementById('ruleOvertimeOpportunities').checked
      };
    }

    // Enhanced Scheduling Engine with Overtime Opportunities
    class SchedulingEngine {
      constructor() {
        this.rules = {};
        this.staffPool = [];
        this.requirements = [];
        this.intervalLength = 60;
      }

      generateSchedule(requirements, staffPool, rules) {
        this.requirements = requirements;
        this.staffPool = staffPool;
        this.rules = rules;
        this.intervalLength = scheduleData.intervalLength;
        
        const schedule = this.createInitialSchedule();
        const agentSchedules = this.generateAgentSchedules(staffPool, schedule);
        
        // Apply rules
        if (rules.bestFit) {
          this.applyBestFit(schedule, agentSchedules);
        }
        
        if (rules.evenSpread) {
          this.applyEvenSpread(schedule, agentSchedules);
        }
        
        if (rules.respectPreferences) {
          this.applyStaffPreferences(agentSchedules);
        }
        
        if (rules.avoidOvertime) {
          this.minimizeOvertime(agentSchedules);
        }
        
        this.applyConstraints(agentSchedules);
        
        // Generate overtime opportunities if enabled
        if (rules.overtimeOpportunities) {
          this.generateOvertimeOpportunities(schedule, agentSchedules);
        }
        
        schedule.agentSchedules = agentSchedules;
        schedule.metrics = this.calculateMetrics(schedule, agentSchedules);
        schedule.netStaffing = this.calculateNetStaffing(schedule, requirements);
        schedule.overtimeOpportunities = this.identifyOvertimeOpportunities(schedule, requirements);
        
        return schedule;
      }

      createInitialSchedule() {
        const schedule = {
          days: [],
          assignments: [],
          metrics: {
            totalHours: 0,
            utilization: 0,
            coverageGaps: 0,
            overtime: 0,
            satisfaction: 0
          }
        };

        const period = parseInt(document.getElementById('schedulePeriod').value);
        const startDate = new Date(document.getElementById('startDate').value);
        
        for (let i = 0; i < period; i++) {
          const date = new Date(startDate);
          date.setDate(date.getDate() + i);
          schedule.days.push({
            date: date,
            assignments: [],
            overtimeSlots: []
          });
        }

        return schedule;
      }

      generateAgentSchedules(staffPool, schedule) {
        const agentSchedules = [];
        const lunchDuration = parseInt(document.getElementById('lunchDuration').value) / 60; // in hours
        const breakFrequency = parseFloat(document.getElementById('breakFrequency').value);
        
        staffPool.forEach(agent => {
          const agentSchedule = {
            agentId: agent.id,
            agentName: agent.name,
            schedule: [],
            totalHours: 0,
            daysWorking: 0
          };
          
          const period = parseInt(document.getElementById('schedulePeriod').value);
          const shiftPattern = document.getElementById('shiftPattern').value;
          const isFullTime = agent.employmentType === 'Full Time';
          
          // Determine shift hours based on pattern
          let shiftHours = 8;
          let daysPerWeek = 5;
          
          if (shiftPattern === '9x5') {
            shiftHours = 9;
            daysPerWeek = 5;
          } else if (shiftPattern === '10x4') {
            shiftHours = 10;
            daysPerWeek = 4;
          } else if (shiftPattern === '12x3') {
            shiftHours = 12;
            daysPerWeek = 3;
          }
          
          // Adjust for part-time
          if (!isFullTime) {
            shiftHours = Math.min(shiftHours, 6);
            daysPerWeek = Math.min(daysPerWeek, 4);
          }
          
          // Generate schedule for each day
          for (let day = 0; day < period; day++) {
            const daySchedule = {
              dayIndex: day,
              activities: [],
              working: false
            };
            
            // Determine if agent works this day
            const dayOfWeek = day % 7;
            const shouldWork = day % Math.ceil(7 / daysPerWeek) < daysPerWeek;
            
            if (shouldWork) {
              daySchedule.working = true;
              agentSchedule.daysWorking++;
              
              // Generate shift with breaks and lunch
              const startHour = 8; // Default start time
              const endHour = startHour + shiftHours;
              
              // Add Inbound activities with breaks
              let currentHour = startHour;
              let hoursSinceBreak = 0;
              
              while (currentHour < endHour) {
                if (hoursSinceBreak >= breakFrequency && currentHour < endHour - lunchDuration) {
                  // Add break
                  daySchedule.activities.push({
                    start: currentHour,
                    end: currentHour + 0.25, // 15 minute break
                    type: 'break',
                    activity: 'Break'
                  });
                  currentHour += 0.25;
                  hoursSinceBreak = 0;
                } else if (currentHour >= startHour + shiftHours/2 - lunchDuration/2 && 
                          currentHour < startHour + shiftHours/2 + lunchDuration/2) {
                  // Add lunch
                  daySchedule.activities.push({
                    start: currentHour,
                    end: currentHour + lunchDuration,
                    type: 'lunch',
                    activity: 'Lunch'
                  });
                  currentHour += lunchDuration;
                  hoursSinceBreak = 0;
                } else {
                  // Add Inbound work
                  const activityDuration = Math.min(1, endHour - currentHour);
                  daySchedule.activities.push({
                    start: currentHour,
                    end: currentHour + activityDuration,
                    type: 'inbound',
                    activity: 'Inbound'
                  });
                  currentHour += activityDuration;
                  hoursSinceBreak += activityDuration;
                  agentSchedule.totalHours += activityDuration;
                }
              }
            }
            
            agentSchedule.schedule.push(daySchedule);
          }
          
          agentSchedules.push(agentSchedule);
        });
        
        return agentSchedules;
      }

      generateOvertimeOpportunities(schedule, agentSchedules) {
        const intervalLength = parseInt(document.getElementById('intervalLength').value);
        
        schedule.days.forEach((day, dayIndex) => {
          const dayRequirements = this.requirements[dayIndex] || [];
          day.overtimeSlots = [];
          
          dayRequirements.forEach((requirement, intervalIndex) => {
            const required = Math.round(requirement);
            const assigned = day.assignments[intervalIndex]?.length || 0;
            
            if (assigned < required) {
              const shortage = required - assigned;
              // Create overtime opportunities for the shortage
              for (let i = 0; i < shortage; i++) {
                day.overtimeSlots.push({
                  intervalIndex,
                  hour: Math.floor(intervalIndex * intervalLength / 60),
                  minute: (intervalIndex * intervalLength) % 60,
                  duration: intervalLength,
                  available: true
                });
              }
              schedule.metrics.overtime += shortage * (intervalLength / 60);
            }
          });
        });
      }

      applyBestFit(schedule, agentSchedules) {
        schedule.days.forEach((day, dayIndex) => {
          const dayRequirements = this.requirements[dayIndex] || [];
          
          dayRequirements.forEach((requirement, hourIndex) => {
            const required = requirement;
            const availableAgents = this.getAvailableAgentsAtHour(agentSchedules, dayIndex, hourIndex);
            const assigned = Math.min(availableAgents.length, required);
            
            if (!day.assignments[hourIndex]) {
              day.assignments[hourIndex] = [];
            }
            
            for (let i = 0; i < assigned; i++) {
              day.assignments[hourIndex].push(availableAgents[i].agentId);
            }
            
            if (assigned < required) {
              schedule.metrics.coverageGaps += (required - assigned);
            }
            
            schedule.metrics.totalHours += assigned;
          });
        });
      }

      // ... (other methods remain the same as your existing code)

      calculateNetStaffing(schedule, requirements) {
        const netStaffing = [];
        const period = parseInt(document.getElementById('schedulePeriod').value);
        const intervalLength = scheduleData.intervalLength;
        const intervalsPerHour = 60 / intervalLength;
        const totalIntervals = 24 * intervalsPerHour;
        
        for (let day = 0; day < period; day++) {
          const dayNetStaffing = [];
          const dayRequirements = requirements[day] || [];
          const dayAssignments = schedule.days[day]?.assignments || [];
          
          for (let interval = 0; interval < totalIntervals; interval++) {
            const required = Math.round(dayRequirements[interval] || 0);
            const assigned = dayAssignments[interval]?.length || 0;
            const net = assigned - required;
            
            let status = 'balanced';
            if (net === 0) status = 'balanced';
            else if (net > 0) status = 'overstaffed';
            else if (net < 0) status = 'understaffed';
            
            dayNetStaffing.push({
              intervalIndex: interval,
              required: required,
              assigned: assigned,
              net: net,
              status: status
            });
          }
          
          netStaffing.push(dayNetStaffing);
        }
        
        return netStaffing;
      }

      identifyOvertimeOpportunities(schedule, requirements) {
        const opportunities = [];
        const period = parseInt(document.getElementById('schedulePeriod').value);
        const intervalLength = scheduleData.intervalLength;
        const intervalsPerHour = 60 / intervalLength;
        const totalIntervals = 24 * intervalsPerHour;
        
        for (let day = 0; day < period; day++) {
          const dayRequirements = requirements[day] || [];
          const dayAssignments = schedule.days[day]?.assignments || [];
          
          for (let interval = 0; interval < totalIntervals; interval++) {
            const required = Math.round(dayRequirements[interval] || 0);
            const assigned = dayAssignments[interval]?.length || 0;
            const shortfall = required - assigned;
            
            if (shortfall > 0) {
              // Calculate time for this interval
              const totalMinutes = interval * intervalLength;
              const hours = Math.floor(totalMinutes / 60);
              const minutes = totalMinutes % 60;
              const timeString = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
              
              opportunities.push({
                day,
                interval,
                time: timeString,
                required,
                assigned,
                shortfall,
                potentialOvertime: shortfall
              });
            }
          }
        }
        
        return opportunities;
      }

      getAvailableAgentsAtHour(agentSchedules, dayIndex, hourIndex) {
        return agentSchedules
          .filter(agentSchedule => {
            const daySchedule = agentSchedule.schedule[dayIndex];
            if (!daySchedule || !daySchedule.working) return false;
            
            return daySchedule.activities.some(activity => 
              activity.start <= hourIndex && activity.end > hourIndex && activity.type === 'inbound'
            );
          })
          .sort((a, b) => a.totalHours - b.totalHours);
      }
    }

    const schedulingEngine = new SchedulingEngine();

    // Generate requirements function
    async function generateRequirements(config) {
      const forecastSource = document.getElementById('forecastSource').value;
      const requirements = [];
      const period = config.period;
      const intervalLength = config.intervalLength;
      const intervalsPerHour = 60 / intervalLength;
      const totalIntervals = 24 * intervalsPerHour;
      
      if (forecastSource === 'manual') {
        const dailyInputs = document.querySelectorAll('#manualForecastSection input');
        const dailyRequirements = Array.from(dailyInputs).map(input => parseInt(input.value) || 0);
        
        for (let day = 0; day < period; day++) {
          const dayRequirements = [];
          const dayIndex = day % 7;
          const baseRequirement = dailyRequirements[dayIndex];
          
          for (let interval = 0; interval < totalIntervals; interval++) {
            const hour = Math.floor(interval / intervalsPerHour);
            if (hour >= config.businessHours.start && hour < config.businessHours.end) {
              // Simulate daily pattern - peak in middle of day
              const normalizedHour = (hour - config.businessHours.start) / (config.businessHours.end - config.businessHours.start);
              const peakFactor = Math.sin(normalizedHour * Math.PI);
              const requirement = Math.max(1, Math.round(baseRequirement * (0.5 + peakFactor * 0.5)));
              dayRequirements.push(requirement / intervalsPerHour);
            } else {
              dayRequirements.push(0);
            }
          }
          
          requirements.push(dayRequirements);
        }
      } else {
        // Default generated requirements
        for (let day = 0; day < period; day++) {
          const dayRequirements = [];
          const baseRequirement = 10 + Math.sin(day * 0.5) * 3; // Vary by day
          
          for (let interval = 0; interval < totalIntervals; interval++) {
            const hour = Math.floor(interval / intervalsPerHour);
            if (hour >= config.businessHours.start && hour < config.businessHours.end) {
              // Simulate daily pattern
              const normalizedHour = (hour - config.businessHours.start) / (config.businessHours.end - config.businessHours.start);
              const peakFactor = Math.sin(normalizedHour * Math.PI);
              const requirement = Math.max(1, Math.round(baseRequirement * (0.5 + peakFactor * 0.5)));
              dayRequirements.push(requirement / intervalsPerHour);
            } else {
              dayRequirements.push(0);
            }
          }
          
          requirements.push(dayRequirements);
        }
      }
      
      return requirements;
    }

    // Generate schedule
    async function generateSchedule() {
      const activeAgents = agents.filter(agent => 
        agent.status === 'active' && (!agent.endDate || new Date(agent.endDate) > new Date())
      );
      
      if (activeAgents.length === 0) {
        alert('No active agents found. Please add agents in the Agent Management tab.');
        return;
      }

      progressBar.style.display = 'block';
      updateProgress(10);
      updateStatus('Generating schedule...');

      try {
        const config = collectConfiguration();
        const staffPool = activeAgents.map(agent => ({
          id: agent.id,
          name: agent.name,
          department: agent.department,
          skills: agent.skills,
          queues: agent.queues,
          employmentType: agent.employmentType,
          contractedHours: agent.contractedHours,
          startDate: agent.startDate,
          endDate: agent.endDate,
          status: agent.status
        }));
        
        scheduleData.staff = staffPool;
        
        const requirements = await generateRequirements(config);
        scheduleData.requirements = requirements;
        
        updateProgress(40);
        
        const rules = collectRules();
        const schedule = schedulingEngine.generateSchedule(requirements, staffPool, rules);
        scheduleData.generatedSchedule = schedule;
        scheduleData.agentSchedules = schedule.agentSchedules;
        scheduleData.netStaffing = schedule.netStaffing;
        scheduleData.overtimeOpportunities = schedule.overtimeOpportunities;
        scheduleData.totalDays = schedule.days.length;
        scheduleData.currentDayIndex = 0;
        scheduleData.currentInterval = parseInt(document.getElementById('intervalLength').value);
        scheduleData.hasUnsavedChanges = false;
        scheduleData.modifiedCells.clear();
        
        updateProgress(70);
        
        // Update UI
        document.getElementById('resultScheduledHours').textContent = schedule.metrics.totalHours;
        document.getElementById('resultUtilization').textContent = schedule.metrics.utilization + '%';
        document.getElementById('resultCoverageGaps').textContent = schedule.metrics.coverageGaps;
        document.getElementById('resultOvertime').textContent = schedule.metrics.overtime;
        
        updateProgress(100);
        
        setTimeout(() => {
          progressBar.style.display = 'none';
          progressFill.style.width = '0%';
        }, 1000);
        
        updateStatus('Schedule generated successfully');
        
        // Switch to schedule view and render
        document.querySelector('[data-tab="scheduleView"]').click();
        updateDateDisplay();
        renderDailySchedule();
        renderNetStaffing();
        saveChangesBtn.style.display = 'none';
        
      } catch (error) {
        console.error('Schedule generation error:', error);
        updateStatus('Error generating schedule: ' + error.message, true);
        progressBar.style.display = 'none';
      }
    }

    // Update progress
    function updateProgress(percent) {
      progressFill.style.width = `${percent}%`;
    }
    
    // Update status
    function updateStatus(message, isError = false) {
      scheduleStatus.textContent = message;
      scheduleStatus.style.color = isError ? 'var(--bad)' : 'var(--text-color)';
    }

    // ====== EVENT LISTENERS ======

    // Tab switching
    tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        const tabId = tab.dataset.tab;
        
        tabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        
        tabContents.forEach(content => {
          content.classList.remove('active');
          if (content.id === `${tabId}Tab`) {
            content.classList.add('active');
          }
        });
        
        if (tabId === 'scheduleView' && scheduleData.generatedSchedule) {
          updateDateDisplay();
          renderDailySchedule();
          renderNetStaffing();
        }
      });
    });

    // Interval selector
    intervalButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        const interval = parseInt(btn.dataset.interval);
        scheduleData.currentInterval = interval;
        
        intervalButtons.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        
        // Update interval select
        document.getElementById('intervalLength').value = interval;
        
        if (scheduleData.generatedSchedule) {
          renderDailySchedule();
          renderNetStaffing();
        }
      });
    });

    // Date navigation
    prevDayBtn.addEventListener('click', navigatePrevDay);
    nextDayBtn.addEventListener('click', navigateNextDay);

    // Save changes
    saveChangesBtn.addEventListener('click', saveChanges);

    // Publish schedule
    publishBtn.addEventListener('click', showPublishModal);
    publishModalCloseBtn.addEventListener('click', hidePublishModal);
    confirmPublishBtn.addEventListener('click', confirmPublish);
    cancelPublishBtn.addEventListener('click', hidePublishModal);

    // Close modal when clicking outside
    publishModal.addEventListener('click', (e) => {
      if (e.target === publishModal) {
        hidePublishModal();
      }
    });

    // Generate schedule button
    generateScheduleBtn.addEventListener('click', generateSchedule);

    // Initialize date picker
    function initializeDatePicker() {
      const today = new Date();
      const nextMonday = new Date(today);
      const daysUntilMonday = (1 - today.getDay() + 7) % 7;
      nextMonday.setDate(today.getDate() + daysUntilMonday);
      
      document.getElementById('startDate').value = formatDate(nextMonday);
    }

    // Initialize
    function init() {
      initializeDatePicker();
      initializeAgents();
      updateStatus('Ready to create schedule');
      
      // Set up business hours toggle
      const businessHoursSelect = document.getElementById('businessHours');
      const customHoursSection = document.getElementById('customHoursSection');
      
      businessHoursSelect.addEventListener('change', function() {
        customHoursSection.style.display = this.value === 'custom' ? 'block' : 'none';
      });
      
      // Set up forecast source toggle
      const forecastSourceSelect = document.getElementById('forecastSource');
      const manualForecastSection = document.getElementById('manualForecastSection');
      const importForecastSection = document.getElementById('importForecastSection');
      
      forecastSourceSelect.addEventListener('change', function() {
        manualForecastSection.style.display = this.value === 'manual' ? 'block' : 'none';
        importForecastSection.style.display = this.value === 'import' ? 'block' : 'none';
      });
    }

    // Start the application
    init();
  </script>
</body>
</html>
