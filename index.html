<!DOCTYPE html>
<html lang="en-GB">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>WFM Scheduling Tool | Rule-Based Scheduling</title>
  <style>
    :root {
      --primary-color: #63AB8F;
      --secondary-color: #4A8C7D;
      --border-color: #DEE2E6;
      --light-bg: #F8F9FA;
      --card-bg: #FFFFFF;
      --text-color: #2C3E50;
      --text-light: #6C757D;
      --warn: #f59e0b;
      --bad: #dc2626;
      --good: #16a34a;
      --schedule-available: #63AB8F;
      --schedule-assigned: #4A8C7D;
      --schedule-unavailable: #9CA3AF;
      --schedule-overtime: #F59E0B;
      --chart-1: #4A8C7D;
      --chart-2: #63AB8F;
      --chart-3: #A8D5BA;
      --chart-4: #C7E8D3;
      --modified: #8b5cf6;
    }
    
    body, h1, h2, h3, h4, h5, h6, p, div, span, label, button, input, select, textarea, th, td, li, ul, ol {
      font-family: 'Aptos', 'Segoe UI', system-ui, -apple-system, Arial, sans-serif;
    }
    
    body {
      margin: 0;
      padding: 20px;
      background: var(--light-bg);
      color: var(--text-color);
      min-height: 100vh;
    }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
    }

    /* Header */
    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 2px solid var(--border-color);
    }
    
    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .brand h1 {
      margin: 0;
      font-size: 28px;
      color: var(--secondary-color);
      font-weight: 800;
    }
    
    .brand .subtitle {
      color: var(--text-light);
      font-weight: 600;
      font-size: 14px;
      margin-left: 8px;
    }
    
    .schedule-status {
      background: white;
      padding: 10px 16px;
      border-radius: 8px;
      border: 1px solid var(--border-color);
      font-size: 14px;
      min-width: 200px;
      text-align: center;
    }

    /* Main Layout */
    .main-layout {
      display: grid;
      grid-template-columns: 1fr;
      gap: 24px;
    }
    
    .cards-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 24px;
    }
    
    @media (max-width: 768px) {
      .cards-row {
        grid-template-columns: 1fr;
      }
    }

    /* Card Styling */
    .card {
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 24px;
      box-shadow: 0 1px 3px rgba(0,0,0,.08);
    }
    
    .card:hover {
      box-shadow: 0 2px 8px rgba(0,0,0,.1);
    }
    
    .card-title {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
      padding-bottom: 16px;
      border-bottom: 2px solid var(--border-color);
    }
    
    .card-title h2 {
      margin: 0;
      font-size: 18px;
      font-weight: 700;
      color: var(--secondary-color);
    }
    
    .badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 900;
      background: rgba(99, 171, 143, 0.1);
      color: var(--secondary-color);
      border: 1px solid rgba(99, 171, 143, 0.3);
    }

    /* Form Controls */
    .form-group {
      margin-bottom: 20px;
    }
    
    label {
      display: block;
      font-weight: 600;
      margin-bottom: 8px;
      font-size: 14px;
      color: var(--text-color);
    }
    
    select, input, textarea, button {
      padding: 12px 14px;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      background: var(--card-bg);
      font-size: 14px;
      width: 100%;
      box-sizing: border-box;
      transition: all 0.2s ease;
    }
    
    select:focus, input:focus, textarea:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(99, 171, 143, 0.1);
    }
    
    button {
      background: var(--primary-color);
      color: #fff;
      font-weight: 600;
      cursor: pointer;
      transition: background .2s;
      border: none;
    }
    
    button:hover {
      background: var(--secondary-color);
      transform: translateY(-1px);
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    
    button.secondary {
      background: #fff;
      color: var(--primary-color);
      border: 2px solid var(--primary-color);
    }
    
    button.secondary:hover {
      background: rgba(99, 171, 143, 0.1);
      border-color: var(--secondary-color);
      color: var(--secondary-color);
    }
    
    button:disabled {
      background: var(--text-light);
      cursor: not-allowed;
      transform: none !important;
      box-shadow: none !important;
    }

    /* Row layouts */
    .row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }
    
    .row-3 {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 16px;
    }
    
    @media (max-width: 768px) {
      .row, .row-3 {
        grid-template-columns: 1fr;
      }
    }

    /* Button Groups */
    .btn-group {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px solid var(--border-color);
    }
    
    .btn-group button {
      flex: 1;
      min-width: 140px;
    }

    /* Rule Toggles */
    .rule-group {
      margin-bottom: 24px;
    }
    
    .rule-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      background: rgba(99, 171, 143, 0.05);
      border-radius: 8px;
      margin-bottom: 8px;
      border: 1px solid transparent;
      transition: all 0.2s ease;
    }
    
    .rule-item:hover {
      border-color: var(--primary-color);
      background: rgba(99, 171, 143, 0.1);
    }
    
    .rule-item input[type="checkbox"] {
      width: 18px;
      height: 18px;
      margin: 0;
    }
    
    .rule-label {
      flex: 1;
      font-weight: 600;
      color: var(--text-color);
    }
    
    .rule-description {
      font-size: 12px;
      color: var(--text-light);
      margin-top: 2px;
    }
    
    .rule-settings {
      margin-top: 12px;
      padding: 12px;
      background: white;
      border-radius: 6px;
      border: 1px solid var(--border-color);
      display: none;
    }
    
    .rule-item.active .rule-settings {
      display: block;
    }

    /* Schedule View */
    .schedule-view-container {
      margin-top: 32px;
      border-top: 2px solid var(--border-color);
      padding-top: 24px;
    }
    
    .schedule-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }
    
    .schedule-header h2 {
      margin: 0;
      font-size: 24px;
      color: var(--secondary-color);
    }
    
    .schedule-controls {
      display: flex;
      gap: 12px;
      align-items: center;
    }
    
    .date-navigation {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .date-navigation button {
      padding: 8px 12px;
      min-width: auto;
    }

    /* Schedule Grid */
    .schedule-grid {
      border: 1px solid var(--border-color);
      border-radius: 8px;
      overflow: hidden;
      background: white;
      margin-top: 20px;
    }
    
    .schedule-row {
      display: grid;
      grid-template-columns: 120px repeat(24, 1fr);
      border-bottom: 1px solid var(--border-color);
    }
    
    .schedule-row:last-child {
      border-bottom: none;
    }
    
    .time-header {
      background: var(--primary-color);
      color: white;
      padding: 12px;
      font-weight: 600;
      font-size: 13px;
      text-align: center;
    }
    
    .hour-header {
      background: rgba(99, 171, 143, 0.1);
      padding: 8px;
      text-align: center;
      font-size: 12px;
      font-weight: 600;
      color: var(--secondary-color);
      border-right: 1px solid var(--border-color);
      border-bottom: 1px solid var(--border-color);
    }
    
    .hour-header:last-child {
      border-right: none;
    }
    
    .schedule-cell {
      padding: 8px;
      text-align: center;
      border-right: 1px solid var(--border-color);
      min-height: 60px;
      position: relative;
    }
    
    .schedule-cell:last-child {
      border-right: none;
    }
    
    .schedule-cell.available {
      background: rgba(99, 171, 143, 0.1);
    }
    
    .schedule-cell.assigned {
      background: rgba(99, 171, 143, 0.3);
      font-weight: 600;
      color: var(--secondary-color);
    }
    
    .schedule-cell.unavailable {
      background: rgba(156, 163, 175, 0.1);
      color: var(--text-light);
    }
    
    .schedule-cell.overtime {
      background: rgba(245, 158, 11, 0.1);
      color: var(--warn);
    }
    
    .staff-count {
      font-size: 14px;
      font-weight: 700;
    }
    
    .requirement-count {
      font-size: 11px;
      color: var(--text-light);
      position: absolute;
      bottom: 2px;
      right: 4px;
    }

    /* Results Summary */
    .summary-tiles {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin: 24px 0;
    }
    
    .tile {
      border: 1px solid var(--border-color);
      border-radius: 10px;
      padding: 20px;
      background: #fff;
      text-align: center;
    }
    
    .tile .label {
      color: var(--text-light);
      font-weight: 800;
      font-size: 13px;
      letter-spacing: .3px;
      text-transform: uppercase;
      margin-bottom: 8px;
    }
    
    .tile .value {
      font-size: 28px;
      font-weight: 900;
      margin-top: 4px;
      color: var(--secondary-color);
      line-height: 1.2;
    }
    
    .tile .subtext {
      margin-top: 8px;
      font-size: 12px;
      color: var(--text-light);
      line-height: 1.4;
    }

    /* Staff Assignments Table */
    .assignments-table {
      max-height: 400px;
      overflow: auto;
      border: 1px solid var(--border-color);
      border-radius: 12px;
      margin-top: 24px;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
      background: white;
    }
    
    thead th {
      background: var(--primary-color);
      color: white;
      text-align: left;
      padding: 16px 12px;
      border-bottom: 1px solid var(--border-color);
      position: sticky;
      top: 0;
      z-index: 10;
      font-weight: 700;
      font-size: 13px;
      letter-spacing: .3px;
    }
    
    tbody td {
      padding: 12px;
      border-bottom: 1px solid var(--border-color);
      vertical-align: middle;
    }
    
    tbody tr:hover {
      background: rgba(99, 171, 143, 0.05);
    }
    
    tbody tr:last-child td {
      border-bottom: none;
    }
    
    .center {
      text-align: center;
    }
    
    .right {
      text-align: right;
    }

    /* Optimization Results */
    .optimization-results {
      background: rgba(99, 171, 143, 0.05);
      border: 1px solid var(--primary-color);
      border-radius: 8px;
      padding: 20px;
      margin-top: 20px;
    }
    
    .optimization-metrics {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 16px;
      margin-top: 16px;
    }
    
    .metric {
      text-align: center;
      padding: 12px;
      background: white;
      border-radius: 6px;
      border: 1px solid var(--border-color);
    }
    
    .metric .value {
      font-size: 20px;
      font-weight: 700;
      color: var(--secondary-color);
    }
    
    .metric .label {
      font-size: 12px;
      color: var(--text-light);
      margin-top: 4px;
    }

    /* Help Text */
    .help-text {
      font-size: 12px;
      color: var(--text-light);
      margin-top: 6px;
      line-height: 1.4;
    }
    
    .note {
      background: rgba(99, 171, 143, 0.05);
      border-left: 4px solid var(--primary-color);
      border-radius: 8px;
      padding: 14px;
      margin-top: 20px;
      font-size: 13px;
      color: var(--text-color);
      line-height: 1.5;
    }

    /* Progress Bar */
    .progress-bar {
      height: 8px;
      background: var(--border-color);
      border-radius: 4px;
      overflow: hidden;
      margin: 20px 0;
    }
    
    .progress-fill {
      height: 100%;
      background: var(--primary-color);
      transition: width 0.3s ease;
    }

    /* Footer */
    .footer {
      margin-top: 40px;
      padding-top: 20px;
      border-top: 1px solid var(--border-color);
      text-align: center;
      color: var(--text-light);
      font-size: 12px;
    }

    /* Tabs */
    .tabs {
      display: flex;
      border-bottom: 2px solid var(--border-color);
      margin-bottom: 24px;
    }
    
    .tab {
      padding: 12px 24px;
      background: none;
      border: none;
      font-size: 16px;
      font-weight: 600;
      color: var(--text-light);
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
    }
    
    .tab:hover {
      color: var(--primary-color);
    }
    
    .tab.active {
      color: var(--primary-color);
    }
    
    .tab.active::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      right: 0;
      height: 2px;
      background: var(--primary-color);
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }

    /* Agent Profiles Table */
    .table-container {
      max-height: 400px;
      overflow: auto;
      border: 1px solid var(--border-color);
      border-radius: 12px;
      margin-top: 24px;
    }
    
    /* Search and Filter Bar */
    .search-filter-bar {
      display: flex;
      gap: 15px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    
    .search-box {
      flex: 1;
      min-width: 250px;
    }
    
    .filter-select {
      min-width: 150px;
    }
    
    /* Agent Summary */
    .agent-summary {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .summary-card {
      background: white;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 15px;
      text-align: center;
    }
    
    .summary-card .value {
      font-size: 24px;
      font-weight: 900;
      color: var(--secondary-color);
      margin-bottom: 5px;
    }
    
    .summary-card .label {
      font-size: 12px;
      color: var(--text-light);
      font-weight: 600;
      text-transform: uppercase;
    }
    
    /* Badge lists */
    .badge-list {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin: 0;
      padding: 0;
    }
    
    .badge-item {
      display: inline-block;
      padding: 2px 8px;
      background: rgba(99, 171, 143, 0.1);
      border: 1px solid rgba(99, 171, 143, 0.3);
      border-radius: 12px;
      font-size: 11px;
      color: var(--secondary-color);
      white-space: nowrap;
    }
    
    /* Status indicators */
    .status-active {
      color: var(--good);
      font-weight: 600;
    }
    
    .status-inactive {
      color: var(--bad);
      font-weight: 600;
    }
    
    /* Modal */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }
    
    .modal {
      background: white;
      border-radius: 12px;
      width: 90%;
      max-width: 800px;
      max-height: 90vh;
      overflow-y: auto;
    }
    
    .modal-header {
      padding: 20px 24px;
      border-bottom: 1px solid var(--border-color);
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: var(--primary-color);
      color: white;
      border-radius: 12px 12px 0 0;
    }
    
    .modal-header h2 {
      margin: 0;
      font-size: 20px;
    }
    
    .modal-close {
      background: none;
      border: none;
      color: white;
      font-size: 24px;
      cursor: pointer;
      padding: 0;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
    }
    
    .modal-body {
      padding: 24px;
    }
    
    /* Activity Blocks */
    .activity-block {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 600;
      margin: 1px;
      min-width: 60px;
      text-align: center;
    }
    
    .activity-inbound {
      background: rgba(99, 171, 143, 0.3);
      border: 1px solid rgba(99, 171, 143, 0.5);
      color: var(--secondary-color);
    }
    
    .activity-break {
      background: rgba(245, 158, 11, 0.3);
      border: 1px solid rgba(245, 158, 11, 0.5);
      color: var(--warn);
    }
    
    .activity-lunch {
      background: rgba(220, 38, 38, 0.3);
      border: 1px solid rgba(220, 38, 38, 0.5);
      color: var(--bad);
    }
    
    .activity-meeting {
      background: rgba(37, 99, 235, 0.3);
      border: 1px solid rgba(37, 99, 235, 0.5);
      color: #2563eb;
    }
    
    .activity-coaching {
      background: rgba(147, 51, 234, 0.3);
      border: 1px solid rgba(147, 51, 234, 0.5);
      color: #9333ea;
    }

    /* Staff Schedule View */
    .staff-schedule-grid {
      border: 1px solid var(--border-color);
      border-radius: 8px;
      overflow: hidden;
      background: white;
      margin-top: 20px;
    }
    
    .staff-schedule-row {
      display: grid;
      grid-template-columns: 120px repeat(24, 1fr);
      border-bottom: 1px solid var(--border-color);
    }
    
    .staff-schedule-row:last-child {
      border-bottom: none;
    }
    
    .staff-schedule-cell {
      padding: 8px;
      text-align: center;
      border-right: 1px solid var(--border-color);
      min-height: 40px;
    }
    
    .staff-schedule-cell:last-child {
      border-right: none;
    }
    
    /* Responsive */
    @media (max-width: 1024px) {
      .schedule-row {
        grid-template-columns: 100px repeat(12, 1fr);
        font-size: 11px;
      }
    }
    
    @media (max-width: 768px) {
      body {
        padding: 10px;
      }
      
      .card {
        padding: 16px;
      }
      
      .header {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
      }
      
      .schedule-status {
        width: 100%;
        min-width: unset;
      }
      
      .schedule-row {
        grid-template-columns: 80px repeat(8, 1fr);
        font-size: 10px;
      }
      
      .schedule-cell {
        padding: 4px;
        min-height: 40px;
      }
      
      .staff-count {
        font-size: 10px;
      }
      
      .schedule-controls {
        flex-direction: column;
        align-items: flex-start;
      }
    }
    
    @media (max-width: 480px) {
      .schedule-row {
        grid-template-columns: 70px repeat(6, 1fr);
      }
      
      .btn-group {
        flex-direction: column;
      }
      
      .btn-group button {
        width: 100%;
      }
    }

    /* Custom scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb {
      background: var(--primary-color);
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: var(--secondary-color);
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <div class="brand">
        <h1>WFM Scheduling Tool</h1>
        <span class="subtitle">Rule-Based Scheduling</span>
      </div>
      <div class="schedule-status" id="scheduleStatus">
        Ready to create schedule
      </div>
    </div>

    <!-- Tabs -->
    <div class="tabs">
      <button class="tab active" data-tab="scheduling">Scheduling</button>
      <button class="tab" data-tab="agents">Agent Management</button>
      <button class="tab" data-tab="scheduleView">Schedule View</button>
    </div>

    <!-- Scheduling Tab -->
    <div id="schedulingTab" class="tab-content active">
      <!-- Main Content -->
      <div class="main-layout">
        <!-- Schedule Configuration Card -->
        <div class="card">
          <div class="card-title">
            <h2>Schedule Configuration</h2>
            <span class="badge">Setup</span>
          </div>
          
          <div class="row">
            <div class="form-group">
              <label for="schedulePeriod">Schedule Period</label>
              <select id="schedulePeriod">
                <option value="7">7 days (1 week)</option>
                <option value="14" selected>14 days (2 weeks)</option>
                <option value="28">28 days (4 weeks)</option>
                <option value="30">30 days (1 month)</option>
              </select>
            </div>

            <div class="form-group">
              <label for="startDate">Start Date</label>
              <input type="date" id="startDate" value="">
              <div class="help-text">First day of the schedule</div>
            </div>
          </div>

          <div class="row">
            <div class="form-group">
              <label for="intervalLength">Interval Length</label>
              <select id="intervalLength">
                <option value="15">15 minutes</option>
                <option value="30">30 minutes</option>
                <option value="60" selected>60 minutes</option>
                <option value="120">120 minutes</option>
              </select>
            </div>

            <div class="form-group">
              <label for="businessHours">Business Hours</label>
              <select id="businessHours">
                <option value="8_18">8:00 - 18:00 (10 hours)</option>
                <option value="9_17">9:00 - 17:00 (8 hours)</option>
                <option value="8_20">8:00 - 20:00 (12 hours)</option>
                <option value="24">24/7 Operation</option>
                <option value="custom">Custom Hours</option>
              </select>
            </div>
          </div>

          <div id="customHoursSection" class="form-group" style="display: none;">
            <label>Custom Business Hours</label>
            <div class="row">
              <input type="time" id="customStart" value="08:00">
              <input type="time" id="customEnd" value="18:00">
            </div>
          </div>
        </div>

        <!-- Staff Pool Card -->
        <div class="cards-row">
          <div class="card">
            <div class="card-title">
              <h2>Staff Pool</h2>
              <span class="badge">Resources</span>
            </div>
            
            <div class="agent-summary" style="margin-bottom: 20px;">
              <div class="summary-card">
                <div class="value" id="totalAgentsCount">0</div>
                <div class="label">Total Agents</div>
              </div>
              <div class="summary-card">
                <div class="value" id="fullTimeCount">0</div>
                <div class="label">Full Time</div>
              </div>
              <div class="summary-card">
                <div class="value" id="partTimeCount">0</div>
                <div class="label">Part Time</div>
              </div>
              <div class="summary-card">
                <div class="value" id="activeCount">0</div>
                <div class="label">Active</div>
              </div>
            </div>

            <div class="form-group">
              <label for="skillLevel">Average Skill Level</label>
              <select id="skillLevel">
                <option value="0.8">Level 1 (Trainee)</option>
                <option value="1.0" selected>Level 2 (Standard)</option>
                <option value="1.2">Level 3 (Experienced)</option>
                <option value="1.5">Level 4 (Expert)</option>
              </select>
              <div class="help-text">Productivity multiplier</div>
            </div>

            <button id="manageStaffBtn" class="secondary">ðŸ‘¥ Go to Agent Management</button>
          </div>

          <div class="card">
            <div class="card-title">
              <h2>Shift Patterns</h2>
              <span class="badge">Work Hours</span>
            </div>
            
            <div class="form-group">
              <label for="shiftPattern">Primary Shift Pattern</label>
              <select id="shiftPattern">
                <option value="8x5">8x5 (8hrs, 5 days/week)</option>
                <option value="9x5" selected>9x5 (9hrs, 5 days/week)</option>
                <option value="10x4">10x4 (10hrs, 4 days/week)</option>
                <option value="12x3">12x3 (12hrs, 3 days/week)</option>
                <option value="custom">Custom Pattern</option>
              </select>
            </div>

            <div class="form-group">
              <label for="lunchDuration">Lunch Duration (minutes)</label>
              <input type="number" id="lunchDuration" min="15" max="120" value="60" step="15">
              <div class="help-text">Duration of lunch break for each agent</div>
            </div>

            <div class="form-group">
              <label for="breakFrequency">Break Frequency (hours)</label>
              <input type="number" id="breakFrequency" min="1" max="4" value="2" step="0.5">
              <div class="help-text">Breaks scheduled every X hours</div>
            </div>
          </div>
        </div>

        <!-- Scheduling Rules Card -->
        <div class="card">
          <div class="card-title">
            <h2>Scheduling Rules</h2>
            <span class="badge">Optimization</span>
          </div>
          
          <div class="rule-group">
            <div class="rule-item">
              <input type="checkbox" id="ruleBestFit" checked>
              <div>
                <div class="rule-label">Best Fit to Requirements</div>
                <div class="rule-description">Match staff as closely as possible to forecasted requirements</div>
              </div>
            </div>
            
            <div class="rule-item active">
              <input type="checkbox" id="ruleEvenSpread" checked>
              <div>
                <div class="rule-label">Even Workload Spread</div>
                <div class="rule-description">Distribute workload evenly across staff and time periods</div>
              </div>
            </div>
            
            <div class="rule-item">
              <input type="checkbox" id="ruleMinGaps">
              <div>
                <div class="rule-label">Minimize Schedule Gaps</div>
                <div class="rule-description">Reduce idle time between shifts</div>
              </div>
            </div>
            
            <div class="rule-item">
              <input type="checkbox" id="ruleRespectPreferences">
              <div>
                <div class="rule-label">Respect Staff Preferences</div>
                <div class="rule-description">Consider staff availability and shift preferences</div>
              </div>
            </div>
            
            <div class="rule-item">
              <input type="checkbox" id="ruleAvoidOvertime">
              <div>
                <div class="rule-label">Minimize Overtime</div>
                <div class="rule-description">Avoid overtime hours when possible</div>
              </div>
            </div>
          </div>

          <div class="row-3">
            <div class="form-group">
              <label for="maxConsecutiveDays">Max Consecutive Days</label>
              <input type="number" id="maxConsecutiveDays" min="1" max="7" value="5">
              <div class="help-text">Maximum days without a day off</div>
            </div>

            <div class="form-group">
              <label for="minHoursBetweenShifts">Min Hours Between Shifts</label>
              <input type="number" id="minHoursBetweenShifts" min="8" max="24" value="10">
              <div class="help-text">Minimum rest between shifts</div>
            </div>

            <div class="form-group">
              <label for="maxWeeklyHours">Max Weekly Hours</label>
              <input type="number" id="maxWeeklyHours" min="20" max="60" value="40">
              <div class="help-text">Maximum hours per week per staff</div>
            </div>
          </div>
        </div>

        <!-- Forecast Import Card -->
        <div class="card">
          <div class="card-title">
            <h2>Forecast Requirements</h2>
            <span class="badge">Demand</span>
          </div>
          
          <div class="form-group">
            <label for="forecastSource">Forecast Source</label>
            <select id="forecastSource">
              <option value="manual">Manual Input</option>
              <option value="import" selected>Import from Forecast Tool</option>
              <option value="historical">Historical Patterns</option>
            </select>
          </div>

          <div id="manualForecastSection" class="form-group" style="display: none;">
            <label>Daily Requirements</label>
            <div class="row-3">
              <input type="number" placeholder="Mon" value="15">
              <input type="number" placeholder="Tue" value="18">
              <input type="number" placeholder="Wed" value="20">
              <input type="number" placeholder="Thu" value="22">
              <input type="number" placeholder="Fri" value="25">
              <input type="number" placeholder="Sat" value="12">
              <input type="number" placeholder="Sun" value="8">
            </div>
          </div>

          <div id="importForecastSection">
            <div class="form-group">
              <label for="forecastFile">Upload Forecast CSV</label>
              <input type="file" id="forecastFile" accept=".csv">
              <div class="help-text">Format: date, time, queue, required_staff</div>
            </div>
          </div>

          <div class="note">
            <strong>Note:</strong> Schedule will be generated based on forecast requirements and configured rules.
          </div>
        </div>

        <!-- Generate Schedule Card -->
        <div class="card">
          <div class="card-title">
            <h2>Generate Schedule</h2>
            <span class="badge">Calculate</span>
          </div>
          
          <div class="btn-group">
            <button id="generateScheduleBtn" class="primary">ðŸ“… Generate Schedule</button>
            <button id="optimizeScheduleBtn" class="secondary">âš¡ Optimize Schedule</button>
            <button id="clearScheduleBtn" class="secondary">Clear Schedule</button>
          </div>

          <div class="progress-bar" id="progressBar" style="display: none;">
            <div class="progress-fill" id="progressFill" style="width: 0%;"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Agent Management Tab -->
    <div id="agentsTab" class="tab-content">
      <div class="card">
        <div class="card-title">
          <h2>Agent Management</h2>
          <span class="badge">Profiles</span>
        </div>
        
        <!-- Search and Filter Bar -->
        <div class="search-filter-bar">
          <div class="search-box">
            <label for="searchInput">Search Agents</label>
            <input type="text" id="searchInput" placeholder="Search by name, department, skills...">
          </div>
          <div class="filter-select">
            <label for="departmentFilter">Department</label>
            <select id="departmentFilter">
              <option value="all">All Departments</option>
              <option value="Customer Service">Customer Service</option>
              <option value="Technical Support">Technical Support</option>
              <option value="Sales">Sales</option>
              <option value="Billing">Billing</option>
            </select>
          </div>
          <div class="filter-select">
            <label for="statusFilter">Status</label>
            <select id="statusFilter">
              <option value="all">All Status</option>
              <option value="active">Active</option>
              <option value="inactive">Inactive</option>
            </select>
          </div>
          <div style="align-self: flex-end;">
            <button id="addAgentBtn" class="primary icon-btn">
              <i class="fas fa-user-plus"></i> Add New Agent
            </button>
          </div>
        </div>

        <!-- Agent Profiles Table -->
        <div class="table-container">
          <table id="agentsTable">
            <thead>
              <tr>
                <th>Name</th>
                <th>Department</th>
                <th>Skills</th>
                <th>Queues</th>
                <th>Full/Part Time</th>
                <th>Contracted Hours</th>
                <th>Start Date</th>
                <th>End Date</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="agentsTableBody">
              <!-- Agent rows will be populated by JavaScript -->
            </tbody>
          </table>
        </div>
        
        <div class="note">
          <strong><i class="fas fa-info-circle"></i> How to use:</strong> 
          Click the edit icon <i class="fas fa-edit" style="color: #3b82f6;"></i> to modify an agent's profile. 
          Click the delete icon <i class="fas fa-trash" style="color: #ef4444;"></i> to remove an agent. 
          Use the search and filters above to find specific agents.
        </div>
      </div>
    </div>

    <!-- Schedule View Tab -->
    <div id="scheduleViewTab" class="tab-content">
      <div class="schedule-view-container">
        <div class="schedule-header">
          <h2>Generated Schedule</h2>
          <div class="schedule-controls">
            <div class="date-navigation">
              <button id="prevWeekBtn" class="secondary">â—€</button>
              <span id="currentWeekDisplay">Week 1, 2024</span>
              <button id="nextWeekBtn" class="secondary">â–¶</button>
            </div>
            <button id="exportScheduleBtn" class="secondary">ðŸ“¤ Export Schedule</button>
          </div>
        </div>

        <div class="summary-tiles">
          <div class="tile">
            <div class="label">Scheduled Hours</div>
            <div class="value" id="resultScheduledHours">â€”</div>
            <div class="subtext">Total staff hours</div>
          </div>
          <div class="tile">
            <div class="label">Utilization</div>
            <div class="value" id="resultUtilization">â€”</div>
            <div class="subtext">Effectiveness rate</div>
          </div>
          <div class="tile">
            <div class="label">Coverage Gaps</div>
            <div class="value" id="resultCoverageGaps">â€”</div>
            <div class="subtext">Hours understaffed</div>
          </div>
          <div class="tile">
            <div class="label">Overtime Hours</div>
            <div class="value" id="resultOvertime">â€”</div>
            <div class="subtext">Additional hours</div>
          </div>
        </div>

        <!-- Schedule Legend -->
        <div style="display: flex; gap: 20px; margin: 20px 0; flex-wrap: wrap;">
          <div style="display: flex; align-items: center; gap: 8px;">
            <div class="activity-block activity-inbound">Inbound</div>
            <span style="font-size: 12px;">Inbound Calls</span>
          </div>
          <div style="display: flex; align-items: center; gap: 8px;">
            <div class="activity-block activity-break">Break</div>
            <span style="font-size: 12px;">Break</span>
          </div>
          <div style="display: flex; align-items: center; gap: 8px;">
            <div class="activity-block activity-lunch">Lunch</div>
            <span style="font-size: 12px;">Lunch</span>
          </div>
          <div style="display: flex; align-items: center; gap: 8px;">
            <div class="activity-block activity-meeting">Meeting</div>
            <span style="font-size: 12px;">Meeting</span>
          </div>
        </div>

        <!-- Schedule Grid -->
        <div class="schedule-grid" id="scheduleGrid">
          <!-- Schedule grid will be generated by JavaScript -->
        </div>

        <!-- Staff Schedule View -->
        <div style="margin-top: 40px;">
          <h3 style="color: var(--secondary-color);">Staff Schedule Details</h3>
          <div class="staff-schedule-grid" id="staffScheduleGrid">
            <!-- Staff schedule grid will be generated by JavaScript -->
          </div>
        </div>

        <!-- Optimization Results -->
        <div class="optimization-results" id="optimizationResults" style="display: none;">
          <h3 style="margin-top: 0; color: var(--secondary-color);">Optimization Results</h3>
          <div id="optimizationMessage"></div>
          <div class="optimization-metrics" id="optimizationMetrics">
            <!-- Metrics will be populated by JavaScript -->
          </div>
        </div>

        <!-- Staff Assignments Table -->
        <div class="assignments-table">
          <table id="assignmentsTable">
            <thead>
              <tr>
                <th>Staff ID</th>
                <th>Name</th>
                <th class="center">Department</th>
                <th class="center">Skills</th>
                <th class="center">Scheduled Hours</th>
                <th class="center">Shift Pattern</th>
                <th class="center">Days Working</th>
                <th class="center">Status</th>
              </tr>
            </thead>
            <tbody id="assignmentsTableBody">
              <tr>
                <td colspan="8" class="center" style="padding: 40px; color: var(--text-light);">
                  No schedule generated yet. Click "Generate Schedule" to create assignments.
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="note" style="margin-top: 20px;">
          <strong>Schedule Health:</strong> Green indicates adequate coverage, yellow shows minor gaps, red indicates significant understaffing.
        </div>
      </div>
    </div>

    <!-- Footer -->
    <div class="footer">
      <p>WFM Scheduling Tool v1.0 | Rule-based scheduling with optimization algorithms</p>
      <p>For support or questions, contact your WFM administrator</p>
    </div>
  </div>

  <!-- Modal for Add/Edit Agent -->
  <div id="agentModal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <h2><i class="fas fa-user-edit"></i> <span id="modalTitle">Add New Agent</span></h2>
        <button class="modal-close" id="modalCloseBtn">&times;</button>
      </div>
      <div class="modal-body">
        <form id="agentForm">
          <div class="row">
            <div class="form-group">
              <label for="agentName">Full Name *</label>
              <input type="text" id="agentName" required>
            </div>
            <div class="form-group">
              <label for="agentDepartment">Department *</label>
              <select id="agentDepartment" required>
                <option value="">Select Department</option>
                <option value="Customer Service">Customer Service</option>
                <option value="Technical Support">Technical Support</option>
                <option value="Sales">Sales</option>
                <option value="Billing">Billing</option>
                <option value="Retention">Retention</option>
                <option value="Social Media">Social Media</option>
              </select>
            </div>
          </div>
          
          <div class="row">
            <div class="form-group">
              <label for="agentEmployment">Employment Type *</label>
              <select id="agentEmployment" required>
                <option value="">Select Type</option>
                <option value="Full Time">Full Time</option>
                <option value="Part Time">Part Time</option>
                <option value="Contractor">Contractor</option>
              </select>
            </div>
            <div class="form-group">
              <label for="agentHours">Contracted Hours (per week) *</label>
              <input type="number" id="agentHours" min="10" max="50" step="0.5" required>
            </div>
          </div>
          
          <div class="row">
            <div class="form-group">
              <label for="agentStartDate">Start Date *</label>
              <input type="date" id="agentStartDate" required>
            </div>
            <div class="form-group">
              <label for="agentEndDate">End Date (if applicable)</label>
              <input type="date" id="agentEndDate">
            </div>
          </div>
          
          <div class="form-group">
            <label>Skills *</label>
            <div class="multi-select-container" style="grid-template-columns: 1fr 1fr; gap: 20px; display: grid;">
              <div class="select-group">
                <h4>Technical Skills</h4>
                <div class="checkbox-group" style="max-height: 150px; overflow-y: auto;">
                  <div class="checkbox-item">
                    <input type="checkbox" id="skillChat" value="Chat Support">
                    <label for="skillChat">Chat Support</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="skillEmail" value="Email Support">
                    <label for="skillEmail">Email Support</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="skillPhone" value="Phone Support">
                    <label for="skillPhone">Phone Support</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="skillSocial" value="Social Media">
                    <label for="skillSocial">Social Media</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="skillTechnical" value="Technical Troubleshooting">
                    <label for="skillTechnical">Technical Troubleshooting</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="skillBilling" value="Billing Support">
                    <label for="skillBilling">Billing Support</label>
                  </div>
                </div>
              </div>
              
              <div class="select-group">
                <h4>Soft Skills</h4>
                <div class="checkbox-group" style="max-height: 150px; overflow-y: auto;">
                  <div class="checkbox-item">
                    <input type="checkbox" id="skillSales" value="Sales">
                    <label for="skillSales">Sales</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="skillRetention" value="Retention">
                    <label for="skillRetention">Retention</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="skillEscalation" value="Escalation Handling">
                    <label for="skillEscalation">Escalation Handling</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="skillMultilingual" value="Multilingual">
                    <label for="skillMultilingual">Multilingual</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="skillTraining" value="Training">
                    <label for="skillTraining">Training</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="skillQuality" value="Quality Assurance">
                    <label for="skillQuality">Quality Assurance</label>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="form-group">
            <label>Queues *</label>
            <div class="multi-select-container" style="grid-template-columns: 1fr 1fr; gap: 20px; display: grid;">
              <div class="select-group">
                <h4>Primary Queues</h4>
                <div class="checkbox-group" style="max-height: 150px; overflow-y: auto;">
                  <div class="checkbox-item">
                    <input type="checkbox" id="queueGeneral" value="General Inquiries">
                    <label for="queueGeneral">General Inquiries</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="queueTechnical" value="Technical Support">
                    <label for="queueTechnical">Technical Support</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="queueSales" value="Sales">
                    <label for="queueSales">Sales</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="queueBilling" value="Billing">
                    <label for="queueBilling">Billing</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="queueRetention" value="Retention">
                    <label for="queueRetention">Retention</label>
                  </div>
                </div>
              </div>
              
              <div class="select-group">
                <h4>Specialty Queues</h4>
                <div class="checkbox-group" style="max-height: 150px; overflow-y: auto;">
                  <div class="checkbox-item">
                    <input type="checkbox" id="queueEscalation" value="Escalations">
                    <label for="queueEscalation">Escalations</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="queueSocial" value="Social Media">
                    <label for="queueSocial">Social Media</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="queueVIP" value="VIP Support">
                    <label for="queueVIP">VIP Support</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="queueBackoffice" value="Back Office">
                    <label for="queueBackoffice">Back Office</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="queueChat" value="Chat Only">
                    <label for="queueChat">Chat Only</label>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="btn-group">
            <button type="submit" class="primary icon-btn">
              <i class="fas fa-save"></i> Save Agent
            </button>
            <button type="button" class="secondary" id="cancelModalBtn">
              Cancel
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <script>
    // DOM Elements
    const scheduleStatus = document.getElementById('scheduleStatus');
    const generateScheduleBtn = document.getElementById('generateScheduleBtn');
    const optimizeScheduleBtn = document.getElementById('optimizeScheduleBtn');
    const clearScheduleBtn = document.getElementById('clearScheduleBtn');
    const exportScheduleBtn = document.getElementById('exportScheduleBtn');
    const scheduleResults = document.getElementById('scheduleResults');
    const progressBar = document.getElementById('progressBar');
    const progressFill = document.getElementById('progressFill');
    const businessHoursSelect = document.getElementById('businessHours');
    const customHoursSection = document.getElementById('customHoursSection');
    const forecastSourceSelect = document.getElementById('forecastSource');
    const manualForecastSection = document.getElementById('manualForecastSection');
    const importForecastSection = document.getElementById('importForecastSection');
    const scheduleGrid = document.getElementById('scheduleGrid');
    const prevWeekBtn = document.getElementById('prevWeekBtn');
    const nextWeekBtn = document.getElementById('nextWeekBtn');
    const currentWeekDisplay = document.getElementById('currentWeekDisplay');
    const assignmentsTableBody = document.getElementById('assignmentsTableBody');
    const optimizationResults = document.getElementById('optimizationResults');
    const optimizationMessage = document.getElementById('optimizationMessage');
    const optimizationMetrics = document.getElementById('optimizationMetrics');
    const manageStaffBtn = document.getElementById('manageStaffBtn');
    const staffScheduleGrid = document.getElementById('staffScheduleGrid');

    // Tabs
    const tabs = document.querySelectorAll('.tab');
    const tabContents = document.querySelectorAll('.tab-content');

    // Agent Management Elements
    const searchInput = document.getElementById('searchInput');
    const departmentFilter = document.getElementById('departmentFilter');
    const statusFilter = document.getElementById('statusFilter');
    const addAgentBtn = document.getElementById('addAgentBtn');
    const agentsTableBody = document.getElementById('agentsTableBody');
    const agentModal = document.getElementById('agentModal');
    const modalCloseBtn = document.getElementById('modalCloseBtn');
    const cancelModalBtn = document.getElementById('cancelModalBtn');
    const modalTitle = document.getElementById('modalTitle');
    const agentForm = document.getElementById('agentForm');
    const totalAgentsCount = document.getElementById('totalAgentsCount');
    const fullTimeCount = document.getElementById('fullTimeCount');
    const partTimeCount = document.getElementById('partTimeCount');
    const activeCount = document.getElementById('activeCount');

    // Agent data storage
    let agents = [];
    let currentEditId = null;

    // Schedule data storage
    let scheduleData = {
      requirements: [],
      staff: [],
      assignments: [],
      generatedSchedule: null,
      currentWeek: 0,
      totalWeeks: 1,
      optimizationResults: null,
      agentSchedules: []
    };

    // Available skills and queues
    const allSkills = [
      'Chat Support', 'Email Support', 'Phone Support', 'Social Media',
      'Technical Troubleshooting', 'Billing Support', 'Sales', 'Retention',
      'Escalation Handling', 'Multilingual', 'Training', 'Quality Assurance'
    ];

    const allQueues = [
      'General Inquiries', 'Technical Support', 'Sales', 'Billing', 'Retention',
      'Escalations', 'Social Media', 'VIP Support', 'Back Office', 'Chat Only'
    ];

    // Initialize with hardcoded agents
    function initializeAgents() {
      const today = new Date();
      const oneYearAgo = new Date();
      oneYearAgo.setFullYear(today.getFullYear() - 1);
      
      const sixMonthsFromNow = new Date();
      sixMonthsFromNow.setMonth(today.getMonth() + 6);
      
      agents = [
        {
          id: 1,
          name: 'John Thompson',
          department: 'Customer Service',
          skills: ['Phone Support', 'Email Support', 'Chat Support', 'Multilingual'],
          queues: ['General Inquiries', 'Technical Support', 'Escalations'],
          employmentType: 'Full Time',
          contractedHours: 40,
          startDate: formatDate(oneYearAgo),
          endDate: '',
          status: 'active'
        },
        {
          id: 2,
          name: 'Sasha Smith',
          department: 'Technical Support',
          skills: ['Technical Troubleshooting', 'Chat Support', 'Email Support', 'Escalation Handling'],
          queues: ['Technical Support', 'Escalations', 'VIP Support'],
          employmentType: 'Full Time',
          contractedHours: 40,
          startDate: formatDate(new Date(oneYearAgo.getFullYear(), oneYearAgo.getMonth() - 3, 15)),
          endDate: '',
          status: 'active'
        },
        {
          id: 3,
          name: 'Liam Cooper',
          department: 'Sales',
          skills: ['Sales', 'Phone Support', 'Retention', 'Chat Support'],
          queues: ['Sales', 'Retention', 'VIP Support'],
          employmentType: 'Full Time',
          contractedHours: 37.5,
          startDate: formatDate(new Date(oneYearAgo.getFullYear(), oneYearAgo.getMonth() - 8, 1)),
          endDate: '',
          status: 'active'
        },
        {
          id: 4,
          name: 'Ethan Reynolds',
          department: 'Billing',
          skills: ['Billing Support', 'Email Support', 'Phone Support', 'Technical Troubleshooting'],
          queues: ['Billing', 'Technical Support', 'General Inquiries'],
          employmentType: 'Part Time',
          contractedHours: 25,
          startDate: formatDate(new Date(oneYearAgo.getFullYear(), oneYearAgo.getMonth() - 5, 20)),
          endDate: formatDate(sixMonthsFromNow),
          status: 'active'
        },
        {
          id: 5,
          name: 'Ava Mitchell',
          department: 'Social Media',
          skills: ['Social Media', 'Chat Support', 'Email Support', 'Multilingual'],
          queues: ['Social Media', 'Chat Only', 'General Inquiries'],
          employmentType: 'Full Time',
          contractedHours: 40,
          startDate: formatDate(new Date(today.getFullYear(), today.getMonth() - 2, 10)),
          endDate: '',
          status: 'active'
        }
      ];
      
      updateAgentDisplay();
      updateSummaryCards();
      updateStatus('Agent profiles loaded successfully');
    }

    // Format date as YYYY-MM-DD
    function formatDate(date) {
      if (!date) return '';
      return date.toISOString().split('T')[0];
    }

    // Format date for display (DD/MM/YYYY)
    function formatDisplayDate(dateString) {
      if (!dateString) return 'â€”';
      const date = new Date(dateString);
      return date.toLocaleDateString('en-GB');
    }

    // Update agent display
    function updateAgentDisplay() {
      const searchTerm = searchInput.value.toLowerCase();
      const department = departmentFilter.value;
      const status = statusFilter.value;
      
      let filteredAgents = agents.filter(agent => {
        const matchesSearch = 
          agent.name.toLowerCase().includes(searchTerm) ||
          agent.department.toLowerCase().includes(searchTerm) ||
          agent.skills.some(skill => skill.toLowerCase().includes(searchTerm)) ||
          agent.queues.some(queue => queue.toLowerCase().includes(searchTerm));
        
        const matchesDepartment = department === 'all' || agent.department === department;
        const matchesStatus = status === 'all' || agent.status === status;
        
        return matchesSearch && matchesDepartment && matchesStatus;
      });
      
      agentsTableBody.innerHTML = '';
      
      filteredAgents.forEach(agent => {
        const row = document.createElement('tr');
        const isActive = agent.status === 'active' && (!agent.endDate || new Date(agent.endDate) > new Date());
        const statusText = isActive ? 'Active' : 'Inactive';
        const statusClass = isActive ? 'status-active' : 'status-inactive';
        
        row.innerHTML = `
          <td><strong>${agent.name}</strong></td>
          <td>${agent.department}</td>
          <td>
            <div class="badge-list">
              ${agent.skills.map(skill => `<span class="badge-item">${skill}</span>`).join('')}
            </div>
          </td>
          <td>
            <div class="badge-list">
              ${agent.queues.map(queue => `<span class="badge-item">${queue}</span>`).join('')}
            </div>
          </td>
          <td>${agent.employmentType}</td>
          <td class="right">${agent.contractedHours.toFixed(1)}</td>
          <td>${formatDisplayDate(agent.startDate)}</td>
          <td>${formatDisplayDate(agent.endDate)}</td>
          <td class="${statusClass}">${statusText}</td>
          <td class="center">
            <button class="action-btn edit" data-id="${agent.id}" title="Edit agent" style="background: none; border: none; cursor: pointer; padding: 4px 8px; border-radius: 4px; color: var(--text-light);">
              <i class="fas fa-edit"></i>
            </button>
            <button class="action-btn delete" data-id="${agent.id}" title="Delete agent" style="background: none; border: none; cursor: pointer; padding: 4px 8px; border-radius: 4px; color: var(--text-light);">
              <i class="fas fa-trash"></i>
            </button>
          </td>
        `;
        agentsTableBody.appendChild(row);
      });
    }

    // Update summary cards
    function updateSummaryCards() {
      totalAgentsCount.textContent = agents.length;
      fullTimeCount.textContent = agents.filter(a => a.employmentType === 'Full Time').length;
      partTimeCount.textContent = agents.filter(a => a.employmentType === 'Part Time' || a.employmentType === 'Contractor').length;
      activeCount.textContent = agents.filter(a => a.status === 'active' && (!a.endDate || new Date(a.endDate) > new Date())).length;
    }

    // Show modal for adding/editing agent
    function showAgentModal(agentId = null) {
      currentEditId = agentId;
      
      if (agentId) {
        modalTitle.textContent = 'Edit Agent Profile';
        const agent = agents.find(a => a.id === agentId);
        
        if (agent) {
          document.getElementById('agentName').value = agent.name;
          document.getElementById('agentDepartment').value = agent.department;
          document.getElementById('agentEmployment').value = agent.employmentType;
          document.getElementById('agentHours').value = agent.contractedHours;
          document.getElementById('agentStartDate').value = agent.startDate;
          document.getElementById('agentEndDate').value = agent.endDate;
          
          allSkills.forEach(skill => {
            const checkbox = document.querySelector(`input[value="${skill}"]`);
            if (checkbox) checkbox.checked = agent.skills.includes(skill);
          });
          
          allQueues.forEach(queue => {
            const checkbox = document.querySelector(`input[value="${queue}"]`);
            if (checkbox) checkbox.checked = agent.queues.includes(queue);
          });
        }
      } else {
        modalTitle.textContent = 'Add New Agent';
        agentForm.reset();
        document.getElementById('agentStartDate').value = formatDate(new Date());
      }
      
      agentModal.style.display = 'flex';
    }

    // Hide modal
    function hideAgentModal() {
      agentModal.style.display = 'none';
      currentEditId = null;
    }

    // Save agent
    function saveAgent(event) {
      event.preventDefault();
      
      const name = document.getElementById('agentName').value.trim();
      const department = document.getElementById('agentDepartment').value;
      const employmentType = document.getElementById('agentEmployment').value;
      const contractedHours = parseFloat(document.getElementById('agentHours').value);
      const startDate = document.getElementById('agentStartDate').value;
      const endDate = document.getElementById('agentEndDate').value;
      
      const selectedSkills = [];
      allSkills.forEach(skill => {
        const checkbox = document.querySelector(`input[value="${skill}"]`);
        if (checkbox && checkbox.checked) selectedSkills.push(skill);
      });
      
      const selectedQueues = [];
      allQueues.forEach(queue => {
        const checkbox = document.querySelector(`input[value="${queue}"]`);
        if (checkbox && checkbox.checked) selectedQueues.push(queue);
      });
      
      if (!name || !department || !employmentType || !contractedHours || !startDate) {
        updateStatus('Please fill in all required fields', true);
        return;
      }
      
      if (selectedSkills.length === 0 || selectedQueues.length === 0) {
        updateStatus('Please select at least one skill and one queue', true);
        return;
      }
      
      if (currentEditId) {
        const agentIndex = agents.findIndex(a => a.id === currentEditId);
        if (agentIndex !== -1) {
          agents[agentIndex] = {
            ...agents[agentIndex],
            name,
            department,
            skills: selectedSkills,
            queues: selectedQueues,
            employmentType,
            contractedHours,
            startDate,
            endDate
          };
          updateStatus(`Agent "${name}" updated successfully`);
        }
      } else {
        const newId = agents.length > 0 ? Math.max(...agents.map(a => a.id)) + 1 : 1;
        const newAgent = {
          id: newId,
          name,
          department,
          skills: selectedSkills,
          queues: selectedQueues,
          employmentType,
          contractedHours,
          startDate,
          endDate,
          status: 'active'
        };
        agents.push(newAgent);
        updateStatus(`Agent "${name}" added successfully`);
      }
      
      updateAgentDisplay();
      updateSummaryCards();
      hideAgentModal();
    }

    // Delete agent
    function deleteAgent(agentId) {
      if (confirm('Are you sure you want to delete this agent?')) {
        const agentIndex = agents.findIndex(a => a.id === agentId);
        if (agentIndex !== -1) {
          const agentName = agents[agentIndex].name;
          agents.splice(agentIndex, 1);
          updateAgentDisplay();
          updateSummaryCards();
          updateStatus(`Agent "${agentName}" deleted successfully`);
        }
      }
    }

    // Initialize date picker
    function initializeDatePicker() {
      const today = new Date();
      const nextMonday = new Date(today);
      const daysUntilMonday = (1 - today.getDay() + 7) % 7;
      nextMonday.setDate(today.getDate() + daysUntilMonday);
      
      document.getElementById('startDate').value = formatDate(nextMonday);
    }

    // Tab switching
    tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        const tabId = tab.dataset.tab;
        
        tabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        
        tabContents.forEach(content => {
          content.classList.remove('active');
          if (content.id === `${tabId}Tab`) {
            content.classList.add('active');
          }
        });
        
        if (tabId === 'scheduleView' && scheduleData.generatedSchedule) {
          generateScheduleGrid(scheduleData.generatedSchedule);
          generateStaffScheduleGrid();
        }
      });
    });

    // Enhanced Scheduling Engine
    class SchedulingEngine {
      constructor() {
        this.rules = {};
        this.staffPool = [];
        this.requirements = [];
      }

      generateSchedule(requirements, staffPool, rules) {
        this.requirements = requirements;
        this.staffPool = staffPool;
        this.rules = rules;
        
        const schedule = this.createInitialSchedule();
        const agentSchedules = this.generateAgentSchedules(staffPool, schedule);
        
        // Apply rules
        if (rules.bestFit) {
          this.applyBestFit(schedule, agentSchedules);
        }
        
        if (rules.evenSpread) {
          this.applyEvenSpread(schedule, agentSchedules);
        }
        
        if (rules.respectPreferences) {
          this.applyStaffPreferences(agentSchedules);
        }
        
        if (rules.avoidOvertime) {
          this.minimizeOvertime(agentSchedules);
        }
        
        this.applyConstraints(agentSchedules);
        
        schedule.agentSchedules = agentSchedules;
        schedule.metrics = this.calculateMetrics(schedule, agentSchedules);
        
        return schedule;
      }

      createInitialSchedule() {
        const schedule = {
          days: [],
          assignments: [],
          metrics: {
            totalHours: 0,
            utilization: 0,
            coverageGaps: 0,
            overtime: 0,
            satisfaction: 0
          }
        };

        const period = parseInt(document.getElementById('schedulePeriod').value);
        for (let i = 0; i < period; i++) {
          schedule.days.push({
            date: new Date(),
            assignments: []
          });
        }

        return schedule;
      }

      generateAgentSchedules(staffPool, schedule) {
        const agentSchedules = [];
        const lunchDuration = parseInt(document.getElementById('lunchDuration').value) / 60; // in hours
        const breakFrequency = parseFloat(document.getElementById('breakFrequency').value);
        
        staffPool.forEach(agent => {
          const agentSchedule = {
            agentId: agent.id,
            agentName: agent.name,
            schedule: [],
            totalHours: 0,
            daysWorking: 0
          };
          
          const period = parseInt(document.getElementById('schedulePeriod').value);
          const shiftPattern = document.getElementById('shiftPattern').value;
          const isFullTime = agent.employmentType === 'Full Time';
          
          // Determine shift hours based on pattern
          let shiftHours = 8;
          let daysPerWeek = 5;
          
          if (shiftPattern === '9x5') {
            shiftHours = 9;
            daysPerWeek = 5;
          } else if (shiftPattern === '10x4') {
            shiftHours = 10;
            daysPerWeek = 4;
          } else if (shiftPattern === '12x3') {
            shiftHours = 12;
            daysPerWeek = 3;
          }
          
          // Adjust for part-time
          if (!isFullTime) {
            shiftHours = Math.min(shiftHours, 6);
            daysPerWeek = Math.min(daysPerWeek, 4);
          }
          
          // Generate schedule for each day
          for (let day = 0; day < period; day++) {
            const daySchedule = {
              dayIndex: day,
              activities: [],
              working: false
            };
            
            // Determine if agent works this day
            const dayOfWeek = day % 7;
            const shouldWork = day % Math.ceil(7 / daysPerWeek) < daysPerWeek;
            
            if (shouldWork) {
              daySchedule.working = true;
              agentSchedule.daysWorking++;
              
              // Generate shift with breaks and lunch
              const startHour = 8; // Default start time
              const endHour = startHour + shiftHours;
              
              // Add Inbound activities with breaks
              let currentHour = startHour;
              let hoursSinceBreak = 0;
              
              while (currentHour < endHour) {
                if (hoursSinceBreak >= breakFrequency && currentHour < endHour - lunchDuration) {
                  // Add break
                  daySchedule.activities.push({
                    start: currentHour,
                    end: currentHour + 0.25, // 15 minute break
                    type: 'break',
                    activity: 'Break'
                  });
                  currentHour += 0.25;
                  hoursSinceBreak = 0;
                } else if (currentHour >= startHour + shiftHours/2 - lunchDuration/2 && 
                          currentHour < startHour + shiftHours/2 + lunchDuration/2) {
                  // Add lunch
                  daySchedule.activities.push({
                    start: currentHour,
                    end: currentHour + lunchDuration,
                    type: 'lunch',
                    activity: 'Lunch'
                  });
                  currentHour += lunchDuration;
                  hoursSinceBreak = 0;
                } else {
                  // Add Inbound work
                  const activityDuration = Math.min(1, endHour - currentHour);
                  daySchedule.activities.push({
                    start: currentHour,
                    end: currentHour + activityDuration,
                    type: 'inbound',
                    activity: 'Inbound'
                  });
                  currentHour += activityDuration;
                  hoursSinceBreak += activityDuration;
                  agentSchedule.totalHours += activityDuration;
                }
              }
            }
            
            agentSchedule.schedule.push(daySchedule);
          }
          
          agentSchedules.push(agentSchedule);
        });
        
        return agentSchedules;
      }

      applyBestFit(schedule, agentSchedules) {
        schedule.days.forEach((day, dayIndex) => {
          const dayRequirements = this.requirements[dayIndex] || [];
          
          dayRequirements.forEach((requirement, hourIndex) => {
            const required = requirement;
            const availableAgents = this.getAvailableAgentsAtHour(agentSchedules, dayIndex, hourIndex);
            const assigned = Math.min(availableAgents.length, required);
            
            if (!day.assignments[hourIndex]) {
              day.assignments[hourIndex] = [];
            }
            
            for (let i = 0; i < assigned; i++) {
              day.assignments[hourIndex].push(availableAgents[i].agentId);
            }
            
            if (assigned < required) {
              schedule.metrics.coverageGaps += (required - assigned);
            }
            
            schedule.metrics.totalHours += assigned;
          });
        });
      }

      applyEvenSpread(schedule, agentSchedules) {
        // Balance workload across agents
        const agentWorkload = {};
        agentSchedules.forEach(agent => {
          agentWorkload[agent.agentId] = agent.totalHours;
        });
        
        // Simple balancing: redistribute some activities
        schedule.days.forEach((day, dayIndex) => {
          day.assignments.forEach((hourAssignments, hourIndex) => {
            if (hourAssignments && hourAssignments.length > 0) {
              // Find agent with least workload
              let minWorkload = Infinity;
              let bestAgent = null;
              
              hourAssignments.forEach(agentId => {
                if (agentWorkload[agentId] < minWorkload) {
                  minWorkload = agentWorkload[agentId];
                  bestAgent = agentId;
                }
              });
              
              // Reassign to balance
              if (bestAgent) {
                hourAssignments.forEach((agentId, idx) => {
                  if (agentId !== bestAgent) {
                    hourAssignments[idx] = bestAgent;
                    agentWorkload[bestAgent]++;
                    agentWorkload[agentId]--;
                  }
                });
              }
            }
          });
        });
      }

      applyStaffPreferences(agentSchedules) {
        // This would consider agent preferences from the agent profiles
        // For now, we'll respect contracted hours
        agentSchedules.forEach(agentSchedule => {
          const agent = this.staffPool.find(a => a.id === agentSchedule.agentId);
          if (agent && agentSchedule.totalHours > agent.contractedHours * (parseInt(document.getElementById('schedulePeriod').value) / 7)) {
            // Reduce hours to contracted limit
            this.reduceAgentHours(agentSchedule, agent.contractedHours);
          }
        });
      }

      minimizeOvertime(agentSchedules) {
        const maxWeeklyHours = parseInt(document.getElementById('maxWeeklyHours').value);
        const periodWeeks = parseInt(document.getElementById('schedulePeriod').value) / 7;
        
        agentSchedules.forEach(agentSchedule => {
          const weeklyHours = agentSchedule.totalHours / periodWeeks;
          if (weeklyHours > maxWeeklyHours) {
            const excess = weeklyHours - maxWeeklyHours;
            schedule.metrics.overtime += excess * periodWeeks;
            this.reduceAgentHours(agentSchedule, maxWeeklyHours * periodWeeks);
          }
        });
      }

      applyConstraints(agentSchedules) {
        const maxConsecutiveDays = parseInt(document.getElementById('maxConsecutiveDays').value);
        
        agentSchedules.forEach(agentSchedule => {
          let consecutiveDays = 0;
          let maxConsecutive = 0;
          
          agentSchedule.schedule.forEach(day => {
            if (day.working) {
              consecutiveDays++;
              maxConsecutive = Math.max(maxConsecutive, consecutiveDays);
            } else {
              consecutiveDays = 0;
            }
          });
          
          if (maxConsecutive > maxConsecutiveDays) {
            this.adjustForConsecutiveDays(agentSchedule, maxConsecutiveDays);
          }
        });
      }

      // Helper methods
      getAvailableAgentsAtHour(agentSchedules, dayIndex, hourIndex) {
        return agentSchedules
          .filter(agentSchedule => {
            const daySchedule = agentSchedule.schedule[dayIndex];
            if (!daySchedule || !daySchedule.working) return false;
            
            return daySchedule.activities.some(activity => 
              activity.start <= hourIndex && activity.end > hourIndex && activity.type === 'inbound'
            );
          })
          .sort((a, b) => a.totalHours - b.totalHours); // Prefer agents with fewer hours
      }

      reduceAgentHours(agentSchedule, targetHours) {
        // Simple reduction: remove some Inbound activities
        let currentHours = agentSchedule.totalHours;
        
        for (let day = agentSchedule.schedule.length - 1; day >= 0 && currentHours > targetHours; day--) {
          const daySchedule = agentSchedule.schedule[day];
          if (daySchedule.working) {
            // Remove last Inbound activity of the day
            for (let i = daySchedule.activities.length - 1; i >= 0; i--) {
              if (daySchedule.activities[i].type === 'inbound') {
                const duration = daySchedule.activities[i].end - daySchedule.activities[i].start;
                daySchedule.activities.splice(i, 1);
                currentHours -= duration;
                agentSchedule.totalHours -= duration;
                break;
              }
            }
          }
        }
      }

      adjustForConsecutiveDays(agentSchedule, maxDays) {
        // Add days off to break up long stretches
        let consecutiveDays = 0;
        
        for (let i = 0; i < agentSchedule.schedule.length; i++) {
          if (agentSchedule.schedule[i].working) {
            consecutiveDays++;
            if (consecutiveDays > maxDays) {
              // Make this day a day off
              agentSchedule.schedule[i].working = false;
              agentSchedule.schedule[i].activities = [];
              agentSchedule.daysWorking--;
              
              // Update hours
              const dayHours = agentSchedule.schedule[i].activities.reduce((sum, act) => 
                sum + (act.end - act.start), 0
              );
              agentSchedule.totalHours -= dayHours;
              
              consecutiveDays = 0;
            }
          } else {
            consecutiveDays = 0;
          }
        }
      }

      calculateMetrics(schedule, agentSchedules) {
        const totalPossibleHours = this.requirements.reduce((sum, day) => 
          sum + day.reduce((daySum, hour) => daySum + hour, 0), 0
        );
        
        const utilization = schedule.metrics.totalHours > 0 ? 
          (schedule.metrics.totalHours / totalPossibleHours) * 100 : 0;
        
        return {
          totalHours: Math.round(schedule.metrics.totalHours),
          utilization: Math.min(100, Math.round(utilization)),
          coverageGaps: Math.round(schedule.metrics.coverageGaps),
          overtime: Math.round(schedule.metrics.overtime),
          satisfaction: Math.round(schedule.metrics.satisfaction)
        };
      }
    }

    const schedulingEngine = new SchedulingEngine();

    // Generate schedule
    async function generateSchedule() {
      const activeAgents = agents.filter(agent => 
        agent.status === 'active' && (!agent.endDate || new Date(agent.endDate) > new Date())
      );
      
      if (activeAgents.length === 0) {
        alert('No active agents found. Please add agents in the Agent Management tab.');
        return;
      }

      progressBar.style.display = 'block';
      updateProgress(10);
      updateStatus('Generating schedule...');

      try {
        const config = collectConfiguration();
        const staffPool = activeAgents.map(agent => ({
          id: agent.id,
          name: agent.name,
          department: agent.department,
          skills: agent.skills,
          queues: agent.queues,
          employmentType: agent.employmentType,
          contractedHours: agent.contractedHours,
          startDate: agent.startDate,
          endDate: agent.endDate,
          status: agent.status
        }));
        
        scheduleData.staff = staffPool;
        
        const requirements = await generateRequirements(config);
        scheduleData.requirements = requirements;
        
        updateProgress(40);
        
        const rules = collectRules();
        const schedule = schedulingEngine.generateSchedule(requirements, staffPool, rules);
        scheduleData.generatedSchedule = schedule;
        scheduleData.agentSchedules = schedule.agentSchedules;
        
        updateProgress(70);
        
        displayScheduleResults(schedule, schedule.metrics);
        displayAssignments(staffPool, schedule);
        generateStaffScheduleGrid();
        
        updateProgress(100);
        
        setTimeout(() => {
          progressBar.style.display = 'none';
          progressFill.style.width = '0%';
        }, 1000);
        
        updateStatus('Schedule generated successfully');
        document.querySelector('[data-tab="scheduleView"]').click();
        
      } catch (error) {
        console.error('Schedule generation error:', error);
        updateStatus('Error generating schedule: ' + error.message, true);
        progressBar.style.display = 'none';
      }
    }

    // Generate staff schedule grid
    function generateStaffScheduleGrid() {
      if (!scheduleData.agentSchedules || scheduleData.agentSchedules.length === 0) {
        staffScheduleGrid.innerHTML = '<div class="note" style="margin: 20px; text-align: center;">No agent schedules generated yet.</div>';
        return;
      }

      staffScheduleGrid.innerHTML = '';
      
      // Create header row
      const headerRow = document.createElement('div');
      headerRow.className = 'staff-schedule-row';
      
      const timeHeader = document.createElement('div');
      timeHeader.className = 'time-header';
      timeHeader.textContent = 'Agent / Time';
      headerRow.appendChild(timeHeader);
      
      for (let hour = 0; hour < 24; hour++) {
        const hourHeader = document.createElement('div');
        hourHeader.className = 'hour-header';
        hourHeader.textContent = `${hour}:00`;
        headerRow.appendChild(hourHeader);
      }
      
      staffScheduleGrid.appendChild(headerRow);
      
      // Create rows for first 5 agents (for performance)
      const agentsToShow = scheduleData.agentSchedules.slice(0, 5);
      const startDay = scheduleData.currentWeek * 7;
      
      agentsToShow.forEach(agentSchedule => {
        const dayIndex = startDay; // Show first day of current week
        if (dayIndex >= agentSchedule.schedule.length) return;
        
        const daySchedule = agentSchedule.schedule[dayIndex];
        const row = document.createElement('div');
        row.className = 'staff-schedule-row';
        
        const agentHeader = document.createElement('div');
        agentHeader.className = 'time-header';
        agentHeader.textContent = agentSchedule.agentName.substring(0, 15);
        row.appendChild(agentHeader);
        
        for (let hour = 0; hour < 24; hour++) {
          const cell = document.createElement('div');
          cell.className = 'staff-schedule-cell';
          
          // Check if agent has activity at this hour
          const activity = daySchedule.activities.find(act => 
            Math.floor(act.start) <= hour && Math.ceil(act.end) > hour
          );
          
          if (activity) {
            let activityClass = 'activity-inbound';
            if (activity.type === 'break') activityClass = 'activity-break';
            if (activity.type === 'lunch') activityClass = 'activity-lunch';
            
            cell.innerHTML = `<div class="activity-block ${activityClass}">${activity.activity}</div>`;
          } else if (daySchedule.working) {
            cell.style.background = 'rgba(99, 171, 143, 0.05)';
          }
          
          row.appendChild(cell);
        }
        
        staffScheduleGrid.appendChild(row);
      });
    }

    // Update existing functions to use agents data
    function collectConfiguration() {
      const period = parseInt(document.getElementById('schedulePeriod').value);
      const startDate = new Date(document.getElementById('startDate').value);
      const intervalLength = parseInt(document.getElementById('intervalLength').value);
      const businessHours = document.getElementById('businessHours').value;
      
      let customHours = { start: 8, end: 18 };
      if (businessHours === 'custom') {
        const start = document.getElementById('customStart').value;
        const end = document.getElementById('customEnd').value;
        customHours.start = parseInt(start.split(':')[0]);
        customHours.end = parseInt(end.split(':')[0]);
      } else if (businessHours !== '24') {
        const [start, end] = businessHours.split('_');
        customHours.start = parseInt(start);
        customHours.end = parseInt(end);
      } else {
        customHours = { start: 0, end: 24 };
      }
      
      return {
        period,
        startDate,
        intervalLength,
        businessHours: customHours
      };
    }

    // Display schedule results
    function displayScheduleResults(schedule, metrics) {
      updateResultsDisplay(metrics);
      generateScheduleGrid(schedule);
      
      scheduleData.currentWeek = 0;
      scheduleData.totalWeeks = Math.ceil(schedule.days.length / 7);
      updateWeekDisplay();
    }

    // Display assignments
    function displayAssignments(staffPool, schedule) {
      assignmentsTableBody.innerHTML = '';
      
      const staffHours = {};
      const staffDays = {};
      
      schedule.agentSchedules.forEach(agentSchedule => {
        staffHours[agentSchedule.agentId] = Math.round(agentSchedule.totalHours);
        staffDays[agentSchedule.agentId] = agentSchedule.daysWorking;
      });
      
      staffPool.forEach(agent => {
        const row = document.createElement('tr');
        const hours = staffHours[agent.id] || 0;
        const days = staffDays[agent.id] || 0;
        
        let status = 'âœ…';
        if (hours > agent.contractedHours * (parseInt(document.getElementById('schedulePeriod').value) / 7)) {
          status = 'âš ï¸ Overtime';
        } else if (hours < agent.contractedHours * (parseInt(document.getElementById('schedulePeriod').value) / 7) * 0.5) {
          status = 'ðŸ“‰ Underutilized';
        }
        
        row.innerHTML = `
          <td>${agent.id}</td>
          <td>${agent.name}</td>
          <td class="center">${agent.department}</td>
          <td class="center">
            <div class="badge-list">
              ${agent.skills.slice(0, 2).map(skill => `<span class="badge-item">${skill}</span>`).join('')}
            </div>
          </td>
          <td class="center">${hours}</td>
          <td class="center">${agent.employmentType}</td>
          <td class="center">${days}</td>
          <td class="center">${status}</td>
        `;
        
        assignmentsTableBody.appendChild(row);
      });
    }

    // Update the rest of the existing functions...
    function updateProgress(percent) {
      progressFill.style.width = `${percent}%`;
    }
    
    function updateStatus(message, isError = false) {
      scheduleStatus.textContent = message;
      scheduleStatus.style.color = isError ? 'var(--bad)' : 'var(--text-color)';
    }

    // Event Listeners
    initializeDatePicker();
    initializeAgents();
    
    // Business hours toggle
    businessHoursSelect.addEventListener('change', function() {
      customHoursSection.style.display = this.value === 'custom' ? 'block' : 'none';
    });

    // Forecast source toggle
    forecastSourceSelect.addEventListener('change', function() {
      manualForecastSection.style.display = this.value === 'manual' ? 'block' : 'none';
      importForecastSection.style.display = this.value === 'import' ? 'block' : 'none';
    });

    // Rule toggles
    document.querySelectorAll('.rule-item input[type="checkbox"]').forEach(checkbox => {
      checkbox.addEventListener('change', function() {
        const ruleItem = this.closest('.rule-item');
        if (this.checked) {
          ruleItem.classList.add('active');
        } else {
          ruleItem.classList.remove('active');
        }
      });
    });

    // Main button event listeners
    generateScheduleBtn.addEventListener('click', generateSchedule);
    manageStaffBtn.addEventListener('click', () => {
      document.querySelector('[data-tab="agents"]').click();
    });

    // Agent management event listeners
    searchInput.addEventListener('input', updateAgentDisplay);
    departmentFilter.addEventListener('change', updateAgentDisplay);
    statusFilter.addEventListener('change', updateAgentDisplay);
    addAgentBtn.addEventListener('click', () => showAgentModal());
    modalCloseBtn.addEventListener('click', hideAgentModal);
    cancelModalBtn.addEventListener('click', hideAgentModal);
    agentForm.addEventListener('submit', saveAgent);

    // Handle edit/delete clicks
    agentsTableBody.addEventListener('click', (event) => {
      const target = event.target;
      const button = target.closest('button');
      
      if (!button) return;
      
      const agentId = parseInt(button.getAttribute('data-id'));
      
      if (button.classList.contains('edit')) {
        showAgentModal(agentId);
      } else if (button.classList.contains('delete')) {
        deleteAgent(agentId);
      }
    });

    // Close modal when clicking outside
    agentModal.addEventListener('click', (e) => {
      if (e.target === agentModal) {
        hideAgentModal();
      }
    });

    // Initialize with default status
    updateStatus('Ready to create schedule');
  </script>
</body>
</html>
